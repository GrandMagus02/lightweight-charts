/*!
 * @license
 * TradingView Lightweight Charts™ v4.1.7
 * Copyright (c) 2024 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
"use strict";var t=require("fancy-canvas");const i={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},s={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},n={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},e={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",invertFilledArea:!1,lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},r={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},h={color:"#26a69a",base:0},l={color:"#2196f3"},a={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};var o,_;function u(t,i){const s={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[i];t.setLineDash(s)}function c(t,i,s,n){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(s,i+e),t.lineTo(n,i+e),t.stroke()}function d(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function f(t){if(void 0===t)throw new Error("Value is undefined");return t}function v(t){if(null===t)throw new Error("Value is null");return t}function p(t){return v(f(t))}exports.LineType=void 0,(o=exports.LineType||(exports.LineType={}))[o.Simple=0]="Simple",o[o.WithSteps=1]="WithSteps",o[o.Curved=2]="Curved",exports.LineStyle=void 0,(_=exports.LineStyle||(exports.LineStyle={}))[_.Solid=0]="Solid",_[_.Dotted=1]="Dotted",_[_.Dashed=2]="Dashed",_[_.LargeDashed=3]="LargeDashed",_[_.SparseDotted=4]="SparseDotted";const m={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function b(t){return t<0?0:t>255?255:Math.round(t)||0}function w(t){return t<=0||t>1?Math.min(Math.max(t,0),1):Math.round(1e4*t)/1e4}const g=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,M=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,x=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,S=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d*\.?\d+)\s*\)$/;function k(t){(t=t.toLowerCase())in m&&(t=m[t]);{const i=S.exec(t)||x.exec(t);if(i)return[b(parseInt(i[1],10)),b(parseInt(i[2],10)),b(parseInt(i[3],10)),w(i.length<5?1:parseFloat(i[4]))]}{const i=M.exec(t);if(i)return[b(parseInt(i[1],16)),b(parseInt(i[2],16)),b(parseInt(i[3],16)),1]}{const i=g.exec(t);if(i)return[b(17*parseInt(i[1],16)),b(17*parseInt(i[2],16)),b(17*parseInt(i[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function y(t){const i=k(t);return{t:`rgb(${i[0]}, ${i[1]}, ${i[2]})`,i:(s=i,.199*s[0]+.687*s[1]+.114*s[2]>160?"black":"white")};var s}class C{constructor(){this.h=[]}l(t,i,s){const n={o:t,_:i,u:!0===s};this.h.push(n)}v(t){const i=this.h.findIndex((i=>t===i.o));i>-1&&this.h.splice(i,1)}p(t){this.h=this.h.filter((i=>i._!==t))}m(t,i,s){const n=[...this.h];this.h=this.h.filter((t=>!t.u)),n.forEach((n=>n.o(t,i,s)))}M(){return this.h.length>0}S(){this.h=[]}}function P(t,...i){for(const s of i)for(const i in s)void 0!==s[i]&&("object"!=typeof s[i]||void 0===t[i]||Array.isArray(s[i])?t[i]=s[i]:P(t[i],s[i]));return t}function T(t){return"number"==typeof t&&isFinite(t)}function R(t){return"number"==typeof t&&t%1==0}function D(t){return"string"==typeof t}function O(t){return"boolean"==typeof t}function B(t){const i=t;if(!i||"object"!=typeof i)return i;let s,n,e;for(n in s=Array.isArray(i)?[]:{},i)i.hasOwnProperty(n)&&(e=i[n],s[n]=e&&"object"==typeof e?B(e):e);return s}function A(t){return null!==t}function E(t){return null===t?void 0:t}const V="-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif";function I(t,i,s){return void 0===i&&(i=V),`${s=void 0!==s?`${s} `:""}${t}px ${i}`}class z{constructor(t){this.k={C:1,P:5,T:NaN,R:"",D:"",O:"",B:"",A:0,V:0,I:0,L:0,N:0},this.F=t}W(){const t=this.k,i=this.j(),s=this.H();return t.T===i&&t.D===s||(t.T=i,t.D=s,t.R=I(i,s),t.L=2.5/12*i,t.A=t.L,t.V=i/12*t.P,t.I=i/12*t.P,t.N=0),t.O=this.$(),t.B=this.U(),this.k}$(){return this.F.W().layout.textColor}U(){return this.F.q()}j(){return this.F.W().layout.fontSize}H(){return this.F.W().layout.fontFamily}}class L{constructor(){this.Y=[]}X(t){this.Y=t}K(t,i,s){this.Y.forEach((n=>{n.K(t,i,s)}))}}class N{K(t,i,s){t.useBitmapCoordinateSpace((t=>this.Z(t,i,s)))}}class F extends N{constructor(){super(...arguments),this.G=null}J(t){this.G=t}Z({context:t,horizontalPixelRatio:i,verticalPixelRatio:s}){if(null===this.G||null===this.G.tt)return;const n=this.G.tt,e=this.G,r=Math.max(1,Math.floor(i))%2/2,h=h=>{t.beginPath();for(let l=n.to-1;l>=n.from;--l){const n=e.it[l],a=Math.round(n.st*i)+r,o=n.nt*s,_=h*s+r;t.moveTo(a,o),t.arc(a,o,_,0,2*Math.PI)}t.fill()};e.et>0&&(t.fillStyle=e.rt,h(e.ht+e.et)),t.fillStyle=e.lt,h(e.ht)}}function W(){return{it:[{st:0,nt:0,ot:0,_t:0}],lt:"",rt:"",ht:0,et:0,tt:null}}const j={from:0,to:1};class H{constructor(t,i){this.ut=new L,this.ct=[],this.dt=[],this.ft=new Map,this.F=t,this.vt=i,this.ut.X(this.ct),this.ft.clear()}bt(t){const i=this.F.wt();i.length!==this.ct.length&&(this.dt=i.map(W),this.ct=this.dt.map((t=>{const i=new F;return i.J(t),i})),this.ut.X(this.ct)),this.ft.clear()}gt(t){let i=this.ft.get(t);if(!i){i=this.Mt(t),this.ft.set(t,i);const s=new L;return s.X(i),s}const s=new L;return s.X(i),s}Mt(t){const i=2===this.vt.W().mode,s=this.F.wt().map(((t,i)=>[t,i])).filter((i=>t.xt().includes(i[0]))),n=this.vt.St(),e=this.F.kt();return s.map((([t,s])=>{var r;const h=this.dt[s],l=t.yt(n);if(i||null===l||!t.Ct())h.tt=null;else{const i=v(t.Pt());h.lt=l.Tt,h.ht=l.ht,h.et=l.Rt,h.it[0]._t=l._t,h.it[0].nt=t.Ot().Dt(l._t,i.Bt),h.rt=null!==(r=l.At)&&void 0!==r?r:this.F.Et(h.it[0].nt/t.Ot().Vt()),h.it[0].ot=n,h.it[0].st=e.It(n),h.tt=j}return this.ct[s]}))}}class $ extends N{constructor(t){super(),this.zt=t}Z({context:t,bitmapSize:i,horizontalPixelRatio:s,verticalPixelRatio:n}){if(null===this.zt)return;const e=this.zt.Lt.Ct,r=this.zt.Nt.Ct;if(!e&&!r)return;const h=Math.round(this.zt.st*s),l=Math.round(this.zt.nt*n);t.lineCap="butt",e&&h>=0&&(t.lineWidth=Math.floor(this.zt.Lt.et*s),t.strokeStyle=this.zt.Lt.O,t.fillStyle=this.zt.Lt.O,u(t,this.zt.Lt.Ft),function(t,i,s,n){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(i+e,s),t.lineTo(i+e,n),t.stroke()}(t,h,0,i.height)),r&&l>=0&&(t.lineWidth=Math.floor(this.zt.Nt.et*n),t.strokeStyle=this.zt.Nt.O,t.fillStyle=this.zt.Nt.O,u(t,this.zt.Nt.Ft),c(t,l,0,i.width))}}class U{constructor(t){this.ft=new Map,this.Wt={Lt:{et:1,Ft:0,O:"",Ct:!1},Nt:{et:1,Ft:0,O:"",Ct:!1},st:0,nt:0},this.jt=new $(this.Wt),this.Ht=t}bt(){this.ft.clear()}gt(t){return this.Mt(t),this.jt}Mt(t){const i=this.Ht.Ct(),s=v(this.Ht.Ut()).$t().W().crosshair,n=this.Wt;if(2===s.mode)return n.Nt.Ct=!1,void(n.Lt.Ct=!1);n.Nt.Ct=i&&this.Ht.qt(t),n.Lt.Ct=i&&this.Ht.Yt(),n.Nt.et=s.horzLine.width,n.Nt.Ft=s.horzLine.style,n.Nt.O=s.horzLine.color,n.Lt.et=s.vertLine.width,n.Lt.Ft=s.vertLine.style,n.Lt.O=s.vertLine.color,n.st=this.Ht.Xt(),n.nt=this.Ht.Kt()}}function q(t,i,s,n,e,r){t.fillRect(i+r,s,n-2*r,r),t.fillRect(i+r,s+e-r,n-2*r,r),t.fillRect(i,s,r,e),t.fillRect(i+n-r,s,r,e)}function Y(t,i,s,n,e,r){t.save(),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,s,n,e),t.restore()}function X(t,i,s,n,e,r){t.beginPath(),t.roundRect?t.roundRect(i,s,n,e,r):(t.lineTo(i+n-r[1],s),0!==r[1]&&t.arcTo(i+n,s,i+n,s+r[1],r[1]),t.lineTo(i+n,s+e-r[2]),0!==r[2]&&t.arcTo(i+n,s+e,i+n-r[2],s+e,r[2]),t.lineTo(i+r[3],s+e),0!==r[3]&&t.arcTo(i,s+e,i,s+e-r[3],r[3]),t.lineTo(i,s+r[0]),0!==r[0]&&t.arcTo(i,s,i+r[0],s,r[0]))}function K(t,i,s,n,e,r,h=0,l=[0,0,0,0],a=""){if(t.save(),!h||!a||a===r)return X(t,i,s,n,e,l),t.fillStyle=r,t.fill(),void t.restore();const o=h/2;var _;X(t,i+o,s+o,n-h,e-h,(_=-o,l.map((t=>0===t?t:t+_)))),"transparent"!==r&&(t.fillStyle=r,t.fill()),"transparent"!==a&&(t.lineWidth=h,t.strokeStyle=a,t.closePath(),t.stroke()),t.restore()}function Z(t,i,s,n,e,r,h){t.save(),t.globalCompositeOperation="copy";const l=t.createLinearGradient(0,0,0,e);l.addColorStop(0,r),l.addColorStop(1,h),t.fillStyle=l,t.fillRect(i,s,n,e),t.restore()}class G{constructor(t,i){this.J(t,i)}J(t,i){this.zt=t,this.Zt=i}Vt(t,i){return this.zt.Ct?t.T+t.L+t.A:0}K(t,i,s,n){if(!this.zt.Ct||0===this.zt.Gt.length)return;const e=this.zt.O,r=this.Zt.t,h=t.useBitmapCoordinateSpace((t=>{const h=t.context;h.font=i.R;const l=this.Jt(t,i,s,n),a=l.Qt,o=(t,i)=>{l.ti?K(h,a.ii,a.si,a.ni,a.ei,t,a.ri,[a.ht,0,0,a.ht],i):K(h,a.hi,a.si,a.ni,a.ei,t,a.ri,[0,a.ht,a.ht,0],i)};return o(r,"transparent"),this.zt.li&&(h.fillStyle=e,h.fillRect(a.hi,a.ai,a.oi-a.hi,a._i)),o("transparent",r),this.zt.ui&&(h.fillStyle=i.B,h.fillRect(l.ti?a.ci-a.ri:0,a.si,a.ri,a.di-a.si)),l}));t.useMediaCoordinateSpace((({context:t})=>{const s=h.fi;t.font=i.R,t.textAlign=h.ti?"right":"left",t.textBaseline="middle",t.fillStyle=e,t.fillText(this.zt.Gt,s.pi,(s.si+s.di)/2+s.mi)}))}Jt(t,i,s,n){var e;const{context:r,bitmapSize:h,mediaSize:l,horizontalPixelRatio:a,verticalPixelRatio:o}=t,_=this.zt.li||!this.zt.bi?i.P:0,u=this.zt.wi?i.C:0,c=i.L+this.Zt.gi,d=i.A+this.Zt.Mi,f=i.V,v=i.I,p=this.zt.Gt,m=i.T,b=s.xi(r,p),w=Math.ceil(s.Si(r,p)),g=m+c+d,M=i.C+f+v+w+_,x=Math.max(1,Math.floor(o));let S=Math.round(g*o);S%2!=x%2&&(S+=1);const k=u>0?Math.max(1,Math.floor(u*a)):0,y=Math.round(M*a),C=Math.round(_*a),P=null!==(e=this.Zt.ki)&&void 0!==e?e:this.Zt.yi,T=Math.round(P*o)-Math.floor(.5*o),R=Math.floor(T+x/2-S/2),D=R+S,O="right"===n,B=O?l.width-u:u,A=O?h.width-k:k;let E,V,I;return O?(E=A-y,V=A-C,I=B-_-f-u):(E=A+y,V=A+C,I=B+_+f),{ti:O,Qt:{si:R,ai:T,di:D,ni:y,ei:S,ht:2*a,ri:k,ii:E,hi:A,oi:V,_i:x,ci:h.width},fi:{si:R/o,di:D/o,pi:I,mi:b}}}}class J{constructor(t){this.Ci={yi:0,t:"#000",Mi:0,gi:0},this.Pi={Gt:"",Ct:!1,li:!0,bi:!1,At:"",O:"#FFF",ui:!1,wi:!1},this.Ti={Gt:"",Ct:!1,li:!1,bi:!0,At:"",O:"#FFF",ui:!0,wi:!0},this.Ri=!0,this.Di=new(t||G)(this.Pi,this.Ci),this.Oi=new(t||G)(this.Ti,this.Ci)}Gt(){return this.Bi(),this.Pi.Gt}yi(){return this.Bi(),this.Ci.yi}bt(){this.Ri=!0}Vt(t,i=!1){return Math.max(this.Di.Vt(t,i),this.Oi.Vt(t,i))}Ai(){return this.Ci.ki||0}Ei(t){this.Ci.ki=t}Vi(){return this.Bi(),this.Pi.Ct||this.Ti.Ct}Ii(){return this.Bi(),this.Pi.Ct}gt(t){return this.Bi(),this.Pi.li=this.Pi.li&&t.W().ticksVisible,this.Ti.li=this.Ti.li&&t.W().ticksVisible,this.Di.J(this.Pi,this.Ci),this.Oi.J(this.Ti,this.Ci),this.Di}zi(){return this.Bi(),this.Di.J(this.Pi,this.Ci),this.Oi.J(this.Ti,this.Ci),this.Oi}Bi(){this.Ri&&(this.Pi.li=!0,this.Ti.li=!1,this.Li(this.Pi,this.Ti,this.Ci))}}class Q extends J{constructor(t,i,s){super(),this.Ht=t,this.Ni=i,this.Fi=s}Li(t,i,s){if(t.Ct=!1,2===this.Ht.W().mode)return;const n=this.Ht.W().horzLine;if(!n.labelVisible)return;const e=this.Ni.Pt();if(!this.Ht.Ct()||this.Ni.Wi()||null===e)return;const r=y(n.labelBackgroundColor);s.t=r.t,t.O=r.i;const h=2/12*this.Ni.T();s.gi=h,s.Mi=h;const l=this.Fi(this.Ni);s.yi=l.yi,t.Gt=this.Ni.ji(l._t,e),t.Ct=!0}}const tt=/[1-9]/g;class it{constructor(){this.zt=null}J(t){this.zt=t}K(t,i){if(null===this.zt||!1===this.zt.Ct||0===this.zt.Gt.length)return;const s=t.useMediaCoordinateSpace((({context:t})=>(t.font=i.R,Math.round(i.Hi.Si(t,v(this.zt).Gt,tt)))));if(s<=0)return;const n=i.$i,e=s+2*n,r=e/2,h=this.zt.Ui;let l=this.zt.yi,a=Math.floor(l-r)+.5;a<0?(l+=Math.abs(0-a),a=Math.floor(l-r)+.5):a+e>h&&(l-=Math.abs(h-(a+e)),a=Math.floor(l-r)+.5);const o=a+e,_=Math.ceil(0+i.C+i.P+i.L+i.T+i.A);t.useBitmapCoordinateSpace((({context:t,horizontalPixelRatio:s,verticalPixelRatio:n})=>{const e=v(this.zt);t.fillStyle=e.t;const r=Math.round(a*s),h=Math.round(0*n),l=Math.round(o*s),u=Math.round(_*n),c=Math.round(2*s);if(t.beginPath(),t.moveTo(r,h),t.lineTo(r,u-c),t.arcTo(r,u,r+c,u,c),t.lineTo(l-c,u),t.arcTo(l,u,l,u-c,c),t.lineTo(l,h),t.fill(),e.li){const r=Math.round(e.yi*s),l=h,a=Math.round((l+i.P)*n);t.fillStyle=e.O;const o=Math.max(1,Math.floor(s)),_=Math.floor(.5*s);t.fillRect(r-_,l,o,a-l)}})),t.useMediaCoordinateSpace((({context:t})=>{const s=v(this.zt),e=0+i.C+i.P+i.L+i.T/2;t.font=i.R,t.textAlign="left",t.textBaseline="middle",t.fillStyle=s.O;const r=i.Hi.xi(t,"Apr0");t.translate(a+n,e+r),t.fillText(s.Gt,0,0)}))}}class st{constructor(t,i,s){this.Ri=!0,this.jt=new it,this.Wt={Ct:!1,t:"#4c525e",O:"white",Gt:"",Ui:0,yi:NaN,li:!0},this.vt=t,this.qi=i,this.Fi=s}bt(){this.Ri=!0}gt(){return this.Ri&&(this.Mt(),this.Ri=!1),this.jt.J(this.Wt),this.jt}Mt(){const t=this.Wt;if(t.Ct=!1,2===this.vt.W().mode)return;const i=this.vt.W().vertLine;if(!i.labelVisible)return;const s=this.qi.kt();if(s.Wi())return;t.Ui=s.Ui();const n=this.Fi();if(null===n)return;t.yi=n.yi;const e=s.Yi(this.vt.St());t.Gt=s.Xi(v(e)),t.Ct=!0;const r=y(i.labelBackgroundColor);t.t=r.t,t.O=r.i,t.li=s.W().ticksVisible}}class nt{constructor(){this.Ki=null,this.Zi=0}Gi(){return this.Zi}Ji(t){this.Zi=t}Ot(){return this.Ki}Qi(t){this.Ki=t}ts(t){return[]}ss(){return[]}Ct(){return!0}}var et;exports.CrosshairMode=void 0,(et=exports.CrosshairMode||(exports.CrosshairMode={}))[et.Normal=0]="Normal",et[et.Magnet=1]="Magnet",et[et.Hidden=2]="Hidden";class rt extends nt{constructor(t,i){super(),this.ns=null,this.es=NaN,this.rs=0,this.hs=!0,this.ls=new Map,this.os=!1,this._s=NaN,this.us=NaN,this.cs=NaN,this.ds=NaN,this.qi=t,this.fs=i,this.vs=new H(t,this);this.ps=((t,i)=>s=>{const n=i(),e=t();if(s===v(this.ns).bs())return{_t:e,yi:n};{const t=v(s.Pt());return{_t:s.ws(n,t),yi:n}}})((()=>this.es),(()=>this.us));const s=((t,i)=>()=>{const s=this.qi.kt().gs(t()),n=i();return s&&Number.isFinite(n)?{ot:s,yi:n}:null})((()=>this.rs),(()=>this.Xt()));this.Ms=new st(this,t,s),this.xs=new U(this)}W(){return this.fs}Ss(t,i){this.cs=t,this.ds=i}ks(){this.cs=NaN,this.ds=NaN}ys(){return this.cs}Cs(){return this.ds}Ps(t,i,s){this.os||(this.os=!0),this.hs=!0,this.Ts(t,i,s)}St(){return this.rs}Xt(){return this._s}Kt(){return this.us}Ct(){return this.hs}Rs(){this.hs=!1,this.Ds(),this.es=NaN,this._s=NaN,this.us=NaN,this.ns=null,this.ks()}Os(t){return null!==this.ns?[this.xs,this.vs]:[]}qt(t){return t===this.ns&&this.fs.horzLine.visible}Yt(){return this.fs.vertLine.visible}Bs(t,i){this.hs&&this.ns===t||this.ls.clear();const s=[];return this.ns===t&&s.push(this.As(this.ls,i,this.ps)),s}ss(){return this.hs?[this.Ms]:[]}Ut(){return this.ns}Es(){this.xs.bt(),this.ls.forEach((t=>t.bt())),this.Ms.bt(),this.vs.bt()}Vs(t){return t&&!t.bs().Wi()?t.bs():null}Ts(t,i,s){this.Is(t,i,s)&&this.Es()}Is(t,i,s){const n=this._s,e=this.us,r=this.es,h=this.rs,l=this.ns,a=this.Vs(s);this.rs=t,this._s=isNaN(t)?NaN:this.qi.kt().It(t),this.ns=s;const o=null!==a?a.Pt():null;return null!==a&&null!==o?(this.es=i,this.us=a.Dt(i,o)):(this.es=NaN,this.us=NaN),n!==this._s||e!==this.us||h!==this.rs||r!==this.es||l!==this.ns}Ds(){const t=this.qi.wt().map((t=>t.Ls().zs())).filter(A),i=0===t.length?null:Math.max(...t);this.rs=null!==i?i:NaN}As(t,i,s){let n=t.get(i);return void 0===n&&(n=new Q(this,i,s),t.set(i,n)),n}}function ht(t){return"left"===t||"right"===t}class lt{constructor(t){this.Ns=new Map,this.Fs=[],this.Ws=t}js(t,i){const s=function(t,i){return void 0===t?i:{Hs:Math.max(t.Hs,i.Hs),$s:t.$s||i.$s}}(this.Ns.get(t),i);this.Ns.set(t,s)}Us(){return this.Ws}qs(t){const i=this.Ns.get(t);return void 0===i?{Hs:this.Ws}:{Hs:Math.max(this.Ws,i.Hs),$s:i.$s}}Ys(){this.Xs(),this.Fs=[{Ks:0}]}Zs(t){this.Xs(),this.Fs=[{Ks:1,Bt:t}]}Gs(t){this.Js(),this.Fs.push({Ks:5,Bt:t})}Xs(){this.Js(),this.Fs.push({Ks:6})}Qs(){this.Xs(),this.Fs=[{Ks:4}]}tn(t){this.Xs(),this.Fs.push({Ks:2,Bt:t})}sn(t){this.Xs(),this.Fs.push({Ks:3,Bt:t})}nn(){return this.Fs}en(t){for(const i of t.Fs)this.rn(i);this.Ws=Math.max(this.Ws,t.Ws),t.Ns.forEach(((t,i)=>{this.js(i,t)}))}static hn(){return new lt(2)}static ln(){return new lt(3)}rn(t){switch(t.Ks){case 0:this.Ys();break;case 1:this.Zs(t.Bt);break;case 2:this.tn(t.Bt);break;case 3:this.sn(t.Bt);break;case 4:this.Qs();break;case 5:this.Gs(t.Bt);break;case 6:this.Js()}}Js(){const t=this.Fs.findIndex((t=>5===t.Ks));-1!==t&&this.Fs.splice(t,1)}}const at=".";function ot(t,i){if(!T(t))return"n/a";if(!R(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}class _t{constructor(t,i){if(i||(i=1),T(t)&&R(t)||(t=100),t<0)throw new TypeError("invalid base");this.Ni=t,this.an=i,this._n()}format(t){const i=t<0?"−":"";return t=Math.abs(t),i+this.un(t)}_n(){if(this.cn=0,this.Ni>0&&this.an>0){let t=this.Ni;for(;t>1;)t/=10,this.cn++}}un(t){const i=this.Ni/this.an;let s=Math.floor(t),n="";const e=void 0!==this.cn?this.cn:NaN;if(i>1){let r=+(Math.round(t*i)-s*i).toFixed(this.cn);r>=i&&(r-=i,s+=1),n=at+ot(+r.toFixed(this.cn)*this.an,e)}else s=Math.round(s*i)/i,e>0&&(n=at+ot(0,e));return s.toFixed(0)+n}}class ut extends _t{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class ct{constructor(t){this.dn=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this.fn(t):t<999995?i+this.fn(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.fn(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.fn(t/1e9)+"B")}fn(t){let i;const s=Math.pow(10,this.dn);return i=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this.dn).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,((t,i)=>i))}}function dt(t,i,s,n,e,r,h){if(0===i.length||n.from>=i.length||n.to<=0)return;const{context:l,horizontalPixelRatio:a,verticalPixelRatio:o}=t,_=i[n.from];let u=r(t,_),c=_;if(n.to-n.from<2){const i=e/2;l.beginPath();const s={st:_.st-i,nt:_.nt},n={st:_.st+i,nt:_.nt};l.moveTo(s.st*a,s.nt*o),l.lineTo(n.st*a,n.nt*o),h(t,u,s,n)}else{const e=(i,s)=>{h(t,u,c,s),l.beginPath(),u=i,c=s};let d=c;l.beginPath(),l.moveTo(_.st*a,_.nt*o);for(let h=n.from+1;h<n.to;++h){d=i[h];const n=r(t,d);switch(s){case 0:l.lineTo(d.st*a,d.nt*o);break;case 1:l.lineTo(d.st*a,i[h-1].nt*o),n!==u&&(e(n,d),l.lineTo(d.st*a,i[h-1].nt*o)),l.lineTo(d.st*a,d.nt*o);break;case 2:{const[t,s]=mt(i,h-1,h);l.bezierCurveTo(t.st*a,t.nt*o,s.st*a,s.nt*o,d.st*a,d.nt*o);break}}1!==s&&n!==u&&(e(n,d),l.moveTo(d.st*a,d.nt*o))}(c!==d||c===d&&1===s)&&h(t,u,c,d)}}const ft=6;function vt(t,i){return{st:t.st-i.st,nt:t.nt-i.nt}}function pt(t,i){return{st:t.st/i,nt:t.nt/i}}function mt(t,i,s){const n=Math.max(0,i-1),e=Math.min(t.length-1,s+1);var r,h;return[(r=t[i],h=pt(vt(t[s],t[n]),ft),{st:r.st+h.st,nt:r.nt+h.nt}),vt(t[s],pt(vt(t[e],t[i]),ft))]}function bt(t,i,s,n,e){const{context:r,horizontalPixelRatio:h,verticalPixelRatio:l}=i;r.lineTo(e.st*h,t*l),r.lineTo(n.st*h,t*l),r.closePath(),r.fillStyle=s,r.fill()}class wt extends N{constructor(){super(...arguments),this.G=null}J(t){this.G=t}Z(t){var i;if(null===this.G)return;const{it:s,tt:n,vn:e,et:r,Ft:h,pn:l}=this.G,a=null!==(i=this.G.mn)&&void 0!==i?i:this.G.bn?0:t.mediaSize.height;if(null===n)return;const o=t.context;o.lineCap="butt",o.lineJoin="round",o.lineWidth=r,u(o,h),o.lineWidth=1,dt(t,s,l,n,e,this.wn.bind(this),bt.bind(null,a))}}function gt(t,i,s){return Math.min(Math.max(t,i),s)}function Mt(t,i,s){return i-t<=s}function xt(t){const i=Math.ceil(t);return i%2==0?i-1:i}class St{gn(t,i){const s=this.Mn,{xn:n,Sn:e,kn:r,yn:h,Cn:l,mn:a}=i;if(void 0===this.Pn||void 0===s||s.xn!==n||s.Sn!==e||s.kn!==r||s.yn!==h||s.mn!==a||s.Cn!==l){const s=t.context.createLinearGradient(0,0,0,l);if(s.addColorStop(0,n),null!=a){const i=gt(a*t.verticalPixelRatio/l,0,1);s.addColorStop(i,e),s.addColorStop(i,r)}s.addColorStop(1,h),this.Pn=s,this.Mn=i}return this.Pn}}class kt extends wt{constructor(){super(...arguments),this.Tn=new St}wn(t,i){return this.Tn.gn(t,{xn:i.Rn,Sn:"",kn:"",yn:i.Dn,Cn:t.bitmapSize.height})}}function yt(t,i){const s=t.context;s.strokeStyle=i,s.stroke()}class Ct extends N{constructor(){super(...arguments),this.G=null}J(t){this.G=t}Z(t){if(null===this.G)return;const{it:i,tt:s,vn:n,pn:e,et:r,Ft:h,On:l}=this.G;if(null===s)return;const a=t.context;a.lineCap="butt",a.lineWidth=r*t.verticalPixelRatio,u(a,h),a.lineJoin="round";const o=this.Bn.bind(this);void 0!==e&&dt(t,i,e,s,n,o,yt),l&&function(t,i,s,n,e){const{horizontalPixelRatio:r,verticalPixelRatio:h,context:l}=t;let a=null;const o=Math.max(1,Math.floor(r))%2/2,_=s*h+o;for(let s=n.to-1;s>=n.from;--s){const n=i[s];if(n){const i=e(t,n);i!==a&&(l.beginPath(),null!==a&&l.fill(),l.fillStyle=i,a=i);const s=Math.round(n.st*r)+o,u=n.nt*h;l.moveTo(s,u),l.arc(s,u,_,0,2*Math.PI)}}l.fill()}(t,i,l,s,o)}}class Pt extends Ct{Bn(t,i){return i.lt}}function Tt(t,i,s,n,e=0,r=i.length){let h=r-e;for(;0<h;){const r=h>>1,l=e+r;n(i[l],s)===t?(e=l+1,h-=r+1):h=r}return e}const Rt=Tt.bind(null,!0),Dt=Tt.bind(null,!1);function Ot(t,i){return t.ot<i}function Bt(t,i){return i<t.ot}function At(t,i,s){const n=i.An(),e=i.ci(),r=Rt(t,n,Ot),h=Dt(t,e,Bt);if(!s)return{from:r,to:h};let l=r,a=h;return r>0&&r<t.length&&t[r].ot>=n&&(l=r-1),h>0&&h<t.length&&t[h-1].ot<=e&&(a=h+1),{from:l,to:a}}class Et{constructor(t,i,s){this.En=!0,this.Vn=!0,this.In=!0,this.zn=[],this.Ln=null,this.Nn=t,this.Fn=i,this.Wn=s}bt(t){this.En=!0,"data"===t&&(this.Vn=!0),"options"===t&&(this.In=!0)}gt(){return this.Nn.Ct()?(this.jn(),null===this.Ln?null:this.Hn):null}$n(){this.zn=this.zn.map((t=>Object.assign(Object.assign({},t),this.Nn.qn().Un(t.ot))))}Yn(){this.Ln=null}jn(){this.Vn&&(this.Xn(),this.Vn=!1),this.In&&(this.$n(),this.In=!1),this.En&&(this.Kn(),this.En=!1)}Kn(){const t=this.Nn.Ot(),i=this.Fn.kt();if(this.Yn(),i.Wi()||t.Wi())return;const s=i.Zn();if(null===s)return;if(0===this.Nn.Ls().Gn())return;const n=this.Nn.Pt();null!==n&&(this.Ln=At(this.zn,s,this.Wn),this.Jn(t,i,n.Bt),this.Qn())}}class Vt extends Et{constructor(t,i){super(t,i,!0)}Jn(t,i,s){i.te(this.zn,E(this.Ln)),t.ie(this.zn,s,E(this.Ln))}se(t,i){return{ot:t,_t:i,st:NaN,nt:NaN}}Xn(){const t=this.Nn.qn();this.zn=this.Nn.Ls().ne().map((i=>{const s=i.Bt[3];return this.ee(i.re,s,t)}))}}class It extends Vt{constructor(t,i){super(t,i),this.Hn=new L,this.he=new kt,this.le=new Pt,this.Hn.X([this.he,this.le])}ee(t,i,s){return Object.assign(Object.assign({},this.se(t,i)),s.Un(t))}Qn(){const t=this.Nn.W();this.he.J({pn:t.lineType,it:this.zn,Ft:t.lineStyle,et:t.lineWidth,mn:null,bn:t.invertFilledArea,tt:this.Ln,vn:this.Fn.kt().ae()}),this.le.J({pn:t.lineVisible?t.lineType:void 0,it:this.zn,Ft:t.lineStyle,et:t.lineWidth,tt:this.Ln,vn:this.Fn.kt().ae(),On:t.pointMarkersVisible?t.pointMarkersRadius||t.lineWidth/2+2:void 0})}}class zt extends N{constructor(){super(...arguments),this.zt=null,this.oe=0,this._e=0}J(t){this.zt=t}Z({context:t,horizontalPixelRatio:i,verticalPixelRatio:s}){if(null===this.zt||0===this.zt.Ls.length||null===this.zt.tt)return;if(this.oe=this.ue(i),this.oe>=2){Math.max(1,Math.floor(i))%2!=this.oe%2&&this.oe--}this._e=this.zt.ce?Math.min(this.oe,Math.floor(i)):this.oe;let n=null;const e=this._e<=this.oe&&this.zt.ae>=Math.floor(1.5*i);for(let r=this.zt.tt.from;r<this.zt.tt.to;++r){const h=this.zt.Ls[r];n!==h.de&&(t.fillStyle=h.de,n=h.de);const l=Math.floor(.5*this._e),a=Math.round(h.st*i),o=a-l,_=this._e,u=o+_-1,c=Math.min(h.fe,h.ve),d=Math.max(h.fe,h.ve),f=Math.round(c*s)-l,v=Math.round(d*s)+l,p=Math.max(v-f,this._e);t.fillRect(o,f,_,p);const m=Math.ceil(1.5*this.oe);if(e){if(this.zt.pe){const i=a-m;let n=Math.max(f,Math.round(h.me*s)-l),e=n+_-1;e>f+p-1&&(e=f+p-1,n=e-_+1),t.fillRect(i,n,o-i,e-n+1)}const i=a+m;let n=Math.max(f,Math.round(h.be*s)-l),e=n+_-1;e>f+p-1&&(e=f+p-1,n=e-_+1),t.fillRect(u+1,n,i-u,e-n+1)}}}ue(t){const i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(v(this.zt).ae,t)))}}class Lt extends Et{constructor(t,i){super(t,i,!1)}Jn(t,i,s){i.te(this.zn,E(this.Ln)),t.we(this.zn,s,E(this.Ln))}ge(t,i,s){return{ot:t,Me:i.Bt[0],xe:i.Bt[1],Se:i.Bt[2],ke:i.Bt[3],st:NaN,me:NaN,fe:NaN,ve:NaN,be:NaN}}Xn(){const t=this.Nn.qn();this.zn=this.Nn.Ls().ne().map((i=>this.ee(i.re,i,t)))}}class Nt extends Lt{constructor(){super(...arguments),this.Hn=new zt}ee(t,i,s){return Object.assign(Object.assign({},this.ge(t,i,s)),s.Un(t))}Qn(){const t=this.Nn.W();this.Hn.J({Ls:this.zn,ae:this.Fn.kt().ae(),pe:t.openVisible,ce:t.thinBars,tt:this.Ln})}}class Ft extends wt{constructor(){super(...arguments),this.Tn=new St}wn(t,i){const s=this.G;return this.Tn.gn(t,{xn:i.ye,Sn:i.Ce,kn:i.Pe,yn:i.Te,Cn:t.bitmapSize.height,mn:s.mn})}}class Wt extends Ct{constructor(){super(...arguments),this.Re=new St}Bn(t,i){const s=this.G;return this.Re.gn(t,{xn:i.De,Sn:i.De,kn:i.Oe,yn:i.Oe,Cn:t.bitmapSize.height,mn:s.mn})}}class jt extends Vt{constructor(t,i){super(t,i),this.Hn=new L,this.Be=new Ft,this.Ae=new Wt,this.Hn.X([this.Be,this.Ae])}ee(t,i,s){return Object.assign(Object.assign({},this.se(t,i)),s.Un(t))}Qn(){const t=this.Nn.Pt();if(null===t)return;const i=this.Nn.W(),s=this.Nn.Ot().Dt(i.baseValue.price,t.Bt),n=this.Fn.kt().ae();this.Be.J({it:this.zn,et:i.lineWidth,Ft:i.lineStyle,pn:i.lineType,mn:s,bn:!1,tt:this.Ln,vn:n}),this.Ae.J({it:this.zn,et:i.lineWidth,Ft:i.lineStyle,pn:i.lineVisible?i.lineType:void 0,On:i.pointMarkersVisible?i.pointMarkersRadius||i.lineWidth/2+2:void 0,mn:s,tt:this.Ln,vn:n})}}class Ht extends N{constructor(){super(...arguments),this.zt=null,this.oe=0}J(t){this.zt=t}Z(t){if(null===this.zt||0===this.zt.Ls.length||null===this.zt.tt)return;const{horizontalPixelRatio:i}=t;if(this.oe=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);const s=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),n=Math.floor(t*s*i),e=Math.floor(t*i),r=Math.min(n,e);return Math.max(Math.floor(i),r)}(this.zt.ae,i),this.oe>=2){Math.floor(i)%2!=this.oe%2&&this.oe--}const s=this.zt.Ls;this.zt.Ee&&this.Ve(t,s,this.zt.tt),this.zt.ui&&this.Ie(t,s,this.zt.tt);const n=this.ze(i);(!this.zt.ui||this.oe>2*n)&&this.Le(t,s,this.zt.tt)}Ve(t,i,s){if(null===this.zt)return;const{context:n,horizontalPixelRatio:e,verticalPixelRatio:r}=t;let h="",l=Math.min(Math.floor(e),Math.floor(this.zt.ae*e));l=Math.max(Math.floor(e),Math.min(l,this.oe));const a=Math.floor(.5*l);let o=null;for(let t=s.from;t<s.to;t++){const s=i[t];s.Ne!==h&&(n.fillStyle=s.Ne,h=s.Ne);const _=Math.round(Math.min(s.me,s.be)*r),u=Math.round(Math.max(s.me,s.be)*r),c=Math.round(s.fe*r),d=Math.round(s.ve*r);let f=Math.round(e*s.st)-a;const v=f+l-1;null!==o&&(f=Math.max(o+1,f),f=Math.min(f,v));const p=v-f+1;n.fillRect(f,c,p,_-c),n.fillRect(f,u+1,p,d-u),o=v}}ze(t){let i=Math.floor(1*t);this.oe<=2*i&&(i=Math.floor(.5*(this.oe-1)));const s=Math.max(Math.floor(t),i);return this.oe<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}Ie(t,i,s){if(null===this.zt)return;const{context:n,horizontalPixelRatio:e,verticalPixelRatio:r}=t;let h="";const l=this.ze(e);let a=null;for(let t=s.from;t<s.to;t++){const s=i[t];s.Fe!==h&&(n.fillStyle=s.Fe,h=s.Fe);let o=Math.round(s.st*e)-Math.floor(.5*this.oe);const _=o+this.oe-1,u=Math.round(Math.min(s.me,s.be)*r),c=Math.round(Math.max(s.me,s.be)*r);if(null!==a&&(o=Math.max(a+1,o),o=Math.min(o,_)),this.zt.ae*e>2*l)q(n,o,u,_-o+1,c-u+1,l);else{const t=_-o+1;n.fillRect(o,u,t,c-u+1)}a=_}}Le(t,i,s){if(null===this.zt)return;const{context:n,horizontalPixelRatio:e,verticalPixelRatio:r}=t;let h="";const l=this.ze(e);for(let t=s.from;t<s.to;t++){const s=i[t];let a=Math.round(Math.min(s.me,s.be)*r),o=Math.round(Math.max(s.me,s.be)*r),_=Math.round(s.st*e)-Math.floor(.5*this.oe),u=_+this.oe-1;if(s.de!==h){const t=s.de;n.fillStyle=t,h=t}this.zt.ui&&(_+=l,a+=l,u-=l,o-=l),a>o||n.fillRect(_,a,u-_+1,o-a+1)}}}class $t extends Lt{constructor(){super(...arguments),this.Hn=new Ht}ee(t,i,s){return Object.assign(Object.assign({},this.ge(t,i,s)),s.Un(t))}Qn(){const t=this.Nn.W();this.Hn.J({Ls:this.zn,ae:this.Fn.kt().ae(),Ee:t.wickVisible,ui:t.borderVisible,tt:this.Ln})}}class Ut{constructor(t,i){this.We=t,this.Ni=i}K(t,i,s){this.We.draw(t,this.Ni,i,s)}}class qt extends Et{constructor(t,i,s){super(t,i,!0),this.xs=s,this.Hn=new Ut(this.xs.renderer(),(i=>{const s=t.Pt();return null===s?null:t.Ot().Dt(i,s.Bt)}))}je(t){return this.xs.priceValueBuilder(t)}He(t){return this.xs.isWhitespace(t)}Xn(){const t=this.Nn.qn();this.zn=this.Nn.Ls().ne().map((i=>Object.assign(Object.assign({ot:i.re,st:NaN},t.Un(i.re)),{$e:i.Ue})))}Jn(t,i){i.te(this.zn,E(this.Ln))}Qn(){this.xs.update({bars:this.zn.map(Yt),barSpacing:this.Fn.kt().ae(),visibleRange:this.Ln},this.Nn.W())}}function Yt(t){return{x:t.st,time:t.ot,originalData:t.$e,barColor:t.de}}class Xt extends N{constructor(){super(...arguments),this.zt=null,this.qe=[]}J(t){this.zt=t,this.qe=[]}Z({context:t,horizontalPixelRatio:i,verticalPixelRatio:s}){if(null===this.zt||0===this.zt.it.length||null===this.zt.tt)return;this.qe.length||this.Ye(i);const n=Math.max(1,Math.floor(s)),e=Math.round(this.zt.Xe*s)-Math.floor(n/2),r=e+n;for(let i=this.zt.tt.from;i<this.zt.tt.to;i++){const h=this.zt.it[i],l=this.qe[i-this.zt.tt.from],a=Math.round(h.nt*s);let o,_;t.fillStyle=h.de,a<=e?(o=a,_=r):(o=e,_=a-Math.floor(n/2)+n),t.fillRect(l.An,o,l.ci-l.An+1,_-o)}}Ye(t){if(null===this.zt||0===this.zt.it.length||null===this.zt.tt)return void(this.qe=[]);const i=Math.ceil(this.zt.ae*t)<=1?0:Math.max(1,Math.floor(t)),s=Math.round(this.zt.ae*t)-i;this.qe=new Array(this.zt.tt.to-this.zt.tt.from);for(let i=this.zt.tt.from;i<this.zt.tt.to;i++){const n=this.zt.it[i],e=Math.round(n.st*t);let r,h;if(s%2){const t=(s-1)/2;r=e-t,h=e+t}else{const t=s/2;r=e-t,h=e+t-1}this.qe[i-this.zt.tt.from]={An:r,ci:h,Ke:e,Ze:n.st*t,ot:n.ot}}for(let t=this.zt.tt.from+1;t<this.zt.tt.to;t++){const s=this.qe[t-this.zt.tt.from],n=this.qe[t-this.zt.tt.from-1];s.ot===n.ot+1&&(s.An-n.ci!==i+1&&(n.Ke>n.Ze?n.ci=s.An-i-1:s.An=n.ci+i+1))}let n=Math.ceil(this.zt.ae*t);for(let t=this.zt.tt.from;t<this.zt.tt.to;t++){const i=this.qe[t-this.zt.tt.from];i.ci<i.An&&(i.ci=i.An);const s=i.ci-i.An+1;n=Math.min(s,n)}if(i>0&&n<4)for(let t=this.zt.tt.from;t<this.zt.tt.to;t++){const i=this.qe[t-this.zt.tt.from];i.ci-i.An+1>n&&(i.Ke>i.Ze?i.ci-=1:i.An+=1)}}}class Kt extends Vt{constructor(){super(...arguments),this.Hn=new Xt}ee(t,i,s){return Object.assign(Object.assign({},this.se(t,i)),s.Un(t))}Qn(){const t={it:this.zn,ae:this.Fn.kt().ae(),tt:this.Ln,Xe:this.Nn.Ot().Dt(this.Nn.W().base,v(this.Nn.Pt()).Bt)};this.Hn.J(t)}}class Zt extends Vt{constructor(){super(...arguments),this.Hn=new Pt}ee(t,i,s){return Object.assign(Object.assign({},this.se(t,i)),s.Un(t))}Qn(){const t=this.Nn.W(),i={it:this.zn,Ft:t.lineStyle,pn:t.lineVisible?t.lineType:void 0,et:t.lineWidth,On:t.pointMarkersVisible?t.pointMarkersRadius||t.lineWidth/2+2:void 0,tt:this.Ln,vn:this.Fn.kt().ae()};this.Hn.J(i)}}const Gt=/[2-9]/g;class Jt{constructor(t=50){this.Ge=0,this.Je=1,this.Qe=1,this.tr={},this.ir=new Map,this.sr=t}nr(){this.Ge=0,this.ir.clear(),this.Je=1,this.Qe=1,this.tr={}}Si(t,i,s){return this.er(t,i,s).width}xi(t,i,s){const n=this.er(t,i,s);return((n.actualBoundingBoxAscent||0)-(n.actualBoundingBoxDescent||0))/2}er(t,i,s){const n=s||Gt,e=String(i).replace(n,"0");if(this.ir.has(e))return f(this.ir.get(e)).rr;if(this.Ge===this.sr){const t=this.tr[this.Qe];delete this.tr[this.Qe],this.ir.delete(t),this.Qe++,this.Ge--}t.save(),t.textBaseline="middle";const r=t.measureText(e);return t.restore(),0===r.width&&i.length||(this.ir.set(e,{rr:r,hr:this.Je}),this.tr[this.Je]=e,this.Ge++,this.Je++),r}}class Qt{constructor(t){this.lr=null,this.k=null,this.ar="right",this._r=t}ur(t,i,s){this.lr=t,this.k=i,this.ar=s}K(t){null!==this.k&&null!==this.lr&&this.lr.K(t,this.k,this._r,this.ar)}}class ti{constructor(t,i,s){this.cr=t,this._r=new Jt(50),this.dr=i,this.F=s,this.j=-1,this.jt=new Qt(this._r)}gt(){const t=this.F.vr(this.dr);if(null===t)return null;const i=t.pr(this.dr)?t.mr():this.dr.Ot();if(null===i)return null;const s=t.br(i);if("overlay"===s)return null;const n=this.F.wr();return n.T!==this.j&&(this.j=n.T,this._r.nr()),this.jt.ur(this.cr.zi(),n,s),this.jt}}class ii extends N{constructor(){super(...arguments),this.zt=null}J(t){this.zt=t}gr(t,i){var s;if(!(null===(s=this.zt)||void 0===s?void 0:s.Ct))return null;const{nt:n,et:e,Mr:r}=this.zt;return i>=n-e-7&&i<=n+e+7?{Sr:this.zt,Mr:r}:null}Z({context:t,bitmapSize:i,horizontalPixelRatio:s,verticalPixelRatio:n}){if(null===this.zt)return;if(!1===this.zt.Ct)return;const e=Math.round(this.zt.nt*n);e<0||e>i.height||(t.lineCap="butt",t.strokeStyle=this.zt.O,t.lineWidth=Math.floor(this.zt.et*s),u(t,this.zt.Ft),c(t,e,0,i.width))}}class si{constructor(t){this.kr={nt:0,O:"rgba(0, 0, 0, 0)",et:1,Ft:0,Ct:!1},this.yr=new ii,this.Ri=!0,this.Nn=t,this.Fn=t.$t(),this.yr.J(this.kr)}bt(){this.Ri=!0}gt(){return this.Nn.Ct()?(this.Ri&&(this.Cr(),this.Ri=!1),this.yr):null}}class ni extends si{constructor(t){super(t)}Cr(){this.kr.Ct=!1;const t=this.Nn.Ot(),i=t.Pr().Pr;if(2!==i&&3!==i)return;const s=this.Nn.W();if(!s.baseLineVisible||!this.Nn.Ct())return;const n=this.Nn.Pt();null!==n&&(this.kr.Ct=!0,this.kr.nt=t.Dt(n.Bt,n.Bt),this.kr.O=s.baseLineColor,this.kr.et=s.baseLineWidth,this.kr.Ft=s.baseLineStyle)}}class ei extends N{constructor(){super(...arguments),this.zt=null}J(t){this.zt=t}Ue(){return this.zt}Z({context:t,horizontalPixelRatio:i,verticalPixelRatio:s}){const n=this.zt;if(null===n)return;const e=Math.max(1,Math.floor(i)),r=e%2/2,h=Math.round(n.Ze.x*i)+r,l=n.Ze.y*s;t.fillStyle=n.Tr,t.beginPath();const a=Math.max(2,1.5*n.Rr)*i;t.arc(h,l,a,0,2*Math.PI,!1),t.fill(),t.fillStyle=n.Dr,t.beginPath(),t.arc(h,l,n.ht*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=e,t.strokeStyle=n.Or,t.beginPath(),t.arc(h,l,n.ht*i+e/2,0,2*Math.PI,!1),t.stroke()}}const ri=[{Br:0,Ar:.25,Er:4,Vr:10,Ir:.25,zr:0,Lr:.4,Nr:.8},{Br:.25,Ar:.525,Er:10,Vr:14,Ir:0,zr:0,Lr:.8,Nr:0},{Br:.525,Ar:1,Er:14,Vr:14,Ir:0,zr:0,Lr:0,Nr:0}];function hi(t,i,s,n){return function(t,i){if("transparent"===t)return t;const s=k(t),n=s[3];return`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${i*n})`}(t,s+(n-s)*i)}function li(t,i){const s=t%2600/2600;let n;for(const t of ri)if(s>=t.Br&&s<=t.Ar){n=t;break}d(void 0!==n,"Last price animation internal logic error");const e=(s-n.Br)/(n.Ar-n.Br);return{Dr:hi(i,e,n.Ir,n.zr),Or:hi(i,e,n.Lr,n.Nr),ht:(r=e,h=n.Er,l=n.Vr,h+(l-h)*r)};var r,h,l}class ai{constructor(t){this.jt=new ei,this.Ri=!0,this.Fr=!0,this.Wr=performance.now(),this.jr=this.Wr-1,this.Hr=t}$r(){this.jr=this.Wr-1,this.bt()}Ur(){if(this.bt(),2===this.Hr.W().lastPriceAnimation){const t=performance.now(),i=this.jr-t;if(i>0)return void(i<650&&(this.jr+=2600));this.Wr=t,this.jr=t+2600}}bt(){this.Ri=!0}qr(){this.Fr=!0}Ct(){return 0!==this.Hr.W().lastPriceAnimation}Yr(){switch(this.Hr.W().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.jr}}gt(){return this.Ri?(this.Mt(),this.Ri=!1,this.Fr=!1):this.Fr&&(this.Xr(),this.Fr=!1),this.jt}Mt(){this.jt.J(null);const t=this.Hr.$t().kt(),i=t.Zn(),s=this.Hr.Pt();if(null===i||null===s)return;const n=this.Hr.Kr(!0);if(n.Zr||!i.Gr(n.re))return;const e={x:t.It(n.re),y:this.Hr.Ot().Dt(n._t,s.Bt)},r=n.O,h=this.Hr.W().lineWidth,l=li(this.Jr(),r);this.jt.J({Tr:r,Rr:h,Dr:l.Dr,Or:l.Or,ht:l.ht,Ze:e})}Xr(){const t=this.jt.Ue();if(null!==t){const i=li(this.Jr(),t.Tr);t.Dr=i.Dr,t.Or=i.Or,t.ht=i.ht}}Jr(){return this.Yr()?performance.now()-this.Wr:2599}}function oi(t,i){return xt(Math.min(Math.max(t,12),30)*i)}function _i(t,i){switch(t){case"arrowDown":case"arrowUp":return oi(i,1);case"circle":return oi(i,.8);case"square":return oi(i,.7)}}function ui(t){return function(t){const i=Math.ceil(t);return i%2!=0?i-1:i}(oi(t,1))}function ci(t){return Math.max(oi(t,.1),3)}function di(t,i,s){return i?t:s?Math.ceil(t/2):0}function fi(t,i,s,n,e){const r=_i("square",s),h=(r-1)/2,l=t-h,a=i-h;return n>=l&&n<=l+r&&e>=a&&e<=a+r}function vi(t,i,s,n){const e=(_i("arrowUp",n)-1)/2*s.Qr,r=(xt(n/2)-1)/2*s.Qr;i.beginPath(),t?(i.moveTo(s.st-e,s.nt),i.lineTo(s.st,s.nt-e),i.lineTo(s.st+e,s.nt),i.lineTo(s.st+r,s.nt),i.lineTo(s.st+r,s.nt+e),i.lineTo(s.st-r,s.nt+e),i.lineTo(s.st-r,s.nt)):(i.moveTo(s.st-e,s.nt),i.lineTo(s.st,s.nt+e),i.lineTo(s.st+e,s.nt),i.lineTo(s.st+r,s.nt),i.lineTo(s.st+r,s.nt-e),i.lineTo(s.st-r,s.nt-e),i.lineTo(s.st-r,s.nt)),i.fill()}function pi(t,i,s,n,e,r){return fi(i,s,n,e,r)}class mi extends N{constructor(){super(...arguments),this.zt=null,this._r=new Jt,this.j=-1,this.H="",this.th=""}J(t){this.zt=t}ur(t,i){this.j===t&&this.H===i||(this.j=t,this.H=i,this.th=I(t,i),this._r.nr())}gr(t,i){if(null===this.zt||null===this.zt.tt)return null;for(let s=this.zt.tt.from;s<this.zt.tt.to;s++){const n=this.zt.it[s];if(wi(n,t,i))return{Sr:n.ih,Mr:n.Mr}}return null}Z({context:t,horizontalPixelRatio:i,verticalPixelRatio:s},n,e){if(null!==this.zt&&null!==this.zt.tt){t.textBaseline="middle",t.font=this.th;for(let n=this.zt.tt.from;n<this.zt.tt.to;n++){const e=this.zt.it[n];void 0!==e.Gt&&(e.Gt.Ui=this._r.Si(t,e.Gt.sh),e.Gt.Vt=this.j,e.Gt.st=e.st-e.Gt.Ui/2),bi(e,t,i,s)}}}}function bi(t,i,s,n){i.fillStyle=t.O,void 0!==t.Gt&&function(t,i,s,n,e,r){t.save(),t.scale(e,r),t.fillText(i,s,n),t.restore()}(i,t.Gt.sh,t.Gt.st,t.Gt.nt,s,n),function(t,i,s){if(0===t.Gn)return;switch(t.nh){case"arrowDown":return void vi(!1,i,s,t.Gn);case"arrowUp":return void vi(!0,i,s,t.Gn);case"circle":return void function(t,i,s){const n=(_i("circle",s)-1)/2;t.beginPath(),t.arc(i.st,i.nt,n*i.Qr,0,2*Math.PI,!1),t.fill()}(i,s,t.Gn);case"square":return void function(t,i,s){const n=_i("square",s),e=(n-1)*i.Qr/2,r=i.st-e,h=i.nt-e;t.fillRect(r,h,n*i.Qr,n*i.Qr)}(i,s,t.Gn)}t.nh}(t,i,function(t,i,s){const n=Math.max(1,Math.floor(i))%2/2;return{st:Math.round(t.st*i)+n,nt:t.nt*s,Qr:i}}(t,s,n))}function wi(t,i,s){return!(void 0===t.Gt||!function(t,i,s,n,e,r){const h=n/2;return e>=t&&e<=t+s&&r>=i-h&&r<=i+h}(t.Gt.st,t.Gt.nt,t.Gt.Ui,t.Gt.Vt,i,s))||function(t,i,s){if(0===t.Gn)return!1;switch(t.nh){case"arrowDown":case"arrowUp":return pi(0,t.st,t.nt,t.Gn,i,s);case"circle":return function(t,i,s,n,e){const r=2+_i("circle",s)/2,h=t-n,l=i-e;return Math.sqrt(h*h+l*l)<=r}(t.st,t.nt,t.Gn,i,s);case"square":return fi(t.st,t.nt,t.Gn,i,s)}}(t,i,s)}function gi(t,i,s,n,e,r,h,l,a){const o=T(s)?s:s.ke,_=T(s)?s:s.xe,u=T(s)?s:s.Se,c=T(i.size)?Math.max(i.size,0):1,d=ui(l.ae())*c,f=d/2;switch(t.Gn=d,i.position){case"inBar":return t.nt=h.Dt(o,a),void(void 0!==t.Gt&&(t.Gt.nt=t.nt+f+r+.6*e));case"aboveBar":return t.nt=h.Dt(_,a)-f-n.eh,void 0!==t.Gt&&(t.Gt.nt=t.nt-f-.6*e,n.eh+=1.2*e),void(n.eh+=d+r);case"belowBar":return t.nt=h.Dt(u,a)+f+n.rh,void 0!==t.Gt&&(t.Gt.nt=t.nt+f+r+.6*e,n.rh+=1.2*e),void(n.rh+=d+r)}i.position}class Mi{constructor(t,i){this.Ri=!0,this.hh=!0,this.ah=!0,this.oh=null,this._h=null,this.jt=new mi,this.Hr=t,this.qi=i,this.zt={it:[],tt:null}}bt(t){this.Ri=!0,this.ah=!0,"data"===t&&(this.hh=!0,this._h=null)}gt(t,i){if(!this.Hr.Ct())return null;this.Ri&&this.uh();const s=this.qi.W().layout;return this.jt.ur(s.fontSize,s.fontFamily),this.jt.J(this.zt),this.jt}dh(){if(this.ah){if(this.Hr.fh().length>0){const t=this.qi.kt().ae(),i=ci(t),s=1.5*ui(t)+2*i,n=this.ph();this.oh={above:di(s,n.aboveBar,n.inBar),below:di(s,n.belowBar,n.inBar)}}else this.oh=null;this.ah=!1}return this.oh}ph(){return null===this._h&&(this._h=this.Hr.fh().reduce(((t,i)=>(t[i.position]||(t[i.position]=!0),t)),{inBar:!1,aboveBar:!1,belowBar:!1})),this._h}uh(){const t=this.Hr.Ot(),i=this.qi.kt(),s=this.Hr.fh();this.hh&&(this.zt.it=s.map((t=>({ot:t.time,st:0,nt:0,Gn:0,nh:t.shape,O:t.color,ih:t.ih,Mr:t.id,Gt:void 0}))),this.hh=!1);const n=this.qi.W().layout;this.zt.tt=null;const e=i.Zn();if(null===e)return;const r=this.Hr.Pt();if(null===r)return;if(0===this.zt.it.length)return;let h=NaN;const l=ci(i.ae()),a={eh:l,rh:l};this.zt.tt=At(this.zt.it,e,!0);for(let e=this.zt.tt.from;e<this.zt.tt.to;e++){const o=s[e];o.time!==h&&(a.eh=l,a.rh=l,h=o.time);const _=this.zt.it[e];_.st=i.It(o.time),void 0!==o.text&&o.text.length>0&&(_.Gt={sh:o.text,st:0,nt:0,Ui:0,Vt:0});const u=this.Hr.mh(o.time);null!==u&&gi(_,o,u,a,n.fontSize,l,t,i,r.Bt)}this.Ri=!1}}class xi extends si{constructor(t){super(t)}Cr(){const t=this.kr;t.Ct=!1;const i=this.Nn.W();if(!i.priceLineVisible||!this.Nn.Ct())return;const s=this.Nn.Kr(0===i.priceLineSource);s.Zr||(t.Ct=!0,t.nt=s.yi,t.O=this.Nn.bh(s.O),t.et=i.priceLineWidth,t.Ft=i.priceLineStyle)}}class Si extends J{constructor(t){super(),this.Ht=t}Li(t,i,s){t.Ct=!1,i.Ct=!1;const n=this.Ht;if(!n.Ct())return;const e=n.W(),r=e.lastValueVisible,h=""!==n.wh(),l=0===e.seriesLastValueMode,a=n.Kr(!1);if(a.Zr)return;r&&(t.Gt=this.gh(a,r,l),t.Ct=0!==t.Gt.length),(h||l)&&(i.Gt=this.Mh(a,r,h,l),i.Ct=i.Gt.length>0);const o=n.bh(a.O),_=y(o);s.t=_.t,s.yi=a.yi,i.At=n.$t().Et(a.yi/n.Ot().Vt()),t.At=o,t.O=_.i,i.O=_.i}Mh(t,i,s,n){let e="";const r=this.Ht.wh();return s&&0!==r.length&&(e+=`${r} `),i&&n&&(e+=this.Ht.Ot().xh()?t.Sh:t.kh),e.trim()}gh(t,i,s){return i?s?this.Ht.Ot().xh()?t.kh:t.Sh:t.Gt:""}}function ki(t,i,s,n){const e=Number.isFinite(i),r=Number.isFinite(s);return e&&r?t(i,s):e||r?e?i:s:n}class yi{constructor(t,i){this.yh=t,this.Ch=i}Ph(t){return null!==t&&(this.yh===t.yh&&this.Ch===t.Ch)}Th(){return new yi(this.yh,this.Ch)}Rh(){return this.yh}Dh(){return this.Ch}Oh(){return this.Ch-this.yh}Wi(){return this.Ch===this.yh||Number.isNaN(this.Ch)||Number.isNaN(this.yh)}en(t){return null===t?this:new yi(ki(Math.min,this.Rh(),t.Rh(),-1/0),ki(Math.max,this.Dh(),t.Dh(),1/0))}Bh(t){if(!T(t))return;if(0===this.Ch-this.yh)return;const i=.5*(this.Ch+this.yh);let s=this.Ch-i,n=this.yh-i;s*=t,n*=t,this.Ch=i+s,this.yh=i+n}Ah(t){T(t)&&(this.Ch+=t,this.yh+=t)}Eh(){return{minValue:this.yh,maxValue:this.Ch}}static Vh(t){return null===t?null:new yi(t.minValue,t.maxValue)}}class Ci{constructor(t,i){this.Ih=t,this.zh=i||null}Lh(){return this.Ih}Nh(){return this.zh}Eh(){return null===this.Ih?null:{priceRange:this.Ih.Eh(),margins:this.zh||void 0}}static Vh(t){return null===t?null:new Ci(yi.Vh(t.priceRange),t.margins)}}class Pi extends si{constructor(t,i){super(t),this.Fh=i}Cr(){const t=this.kr;t.Ct=!1;const i=this.Fh.W();if(!this.Nn.Ct()||!i.lineVisible)return;const s=this.Fh.Wh();null!==s&&(t.Ct=!0,t.nt=s,t.O=i.color,t.et=i.lineWidth,t.Ft=i.lineStyle,t.Mr=this.Fh.W().id)}}class Ti extends J{constructor(t,i){super(),this.Hr=t,this.Fh=i}Li(t,i,s){t.Ct=!1,i.Ct=!1;const n=this.Fh.W(),e=n.axisLabelVisible,r=""!==n.title,h=this.Hr;if(!e||!h.Ct())return;const l=this.Fh.Wh();if(null===l)return;r&&(i.Gt=n.title,i.Ct=!0),i.At=h.$t().Et(l/h.Ot().Vt()),t.Gt=this.jh(n.price),t.Ct=!0;const a=y(n.axisLabelColor||n.color);s.t=a.t;const o=n.axisLabelTextColor||a.i;t.O=o,i.O=o,s.yi=l}jh(t){const i=this.Hr.Pt();return null===i?"":this.Hr.Ot().ji(t,i.Bt)}}class Ri{constructor(t,i){this.Hr=t,this.fs=i,this.Hh=new Pi(t,this),this.cr=new Ti(t,this),this.$h=new ti(this.cr,t,t.$t())}Uh(t){P(this.fs,t),this.bt(),this.Hr.$t().qh()}W(){return this.fs}Yh(){return this.Hh}Xh(){return this.$h}Kh(){return this.cr}bt(){this.Hh.bt(),this.cr.bt()}Wh(){const t=this.Hr,i=t.Ot();if(t.$t().kt().Wi()||i.Wi())return null;const s=t.Pt();return null===s?null:i.Dt(this.fs.price,s.Bt)}}class Di extends nt{constructor(t){super(),this.qi=t}$t(){return this.qi}}const Oi={Bar:(t,i,s,n)=>{var e;const r=i.upColor,h=i.downColor,l=v(t(s,n)),a=p(l.Bt[0])<=p(l.Bt[3]);return{de:null!==(e=l.O)&&void 0!==e?e:a?r:h}},Candlestick:(t,i,s,n)=>{var e,r,h;const l=i.upColor,a=i.downColor,o=i.borderUpColor,_=i.borderDownColor,u=i.wickUpColor,c=i.wickDownColor,d=v(t(s,n)),f=p(d.Bt[0])<=p(d.Bt[3]);return{de:null!==(e=d.O)&&void 0!==e?e:f?l:a,Fe:null!==(r=d.At)&&void 0!==r?r:f?o:_,Ne:null!==(h=d.Zh)&&void 0!==h?h:f?u:c}},Custom:(t,i,s,n)=>{var e;return{de:null!==(e=v(t(s,n)).O)&&void 0!==e?e:i.color}},Area:(t,i,s,n)=>{var e,r,h,l;const a=v(t(s,n));return{de:null!==(e=a.lt)&&void 0!==e?e:i.lineColor,lt:null!==(r=a.lt)&&void 0!==r?r:i.lineColor,Rn:null!==(h=a.Rn)&&void 0!==h?h:i.topColor,Dn:null!==(l=a.Dn)&&void 0!==l?l:i.bottomColor}},Baseline:(t,i,s,n)=>{var e,r,h,l,a,o;const _=v(t(s,n));return{de:_.Bt[3]>=i.baseValue.price?i.topLineColor:i.bottomLineColor,De:null!==(e=_.De)&&void 0!==e?e:i.topLineColor,Oe:null!==(r=_.Oe)&&void 0!==r?r:i.bottomLineColor,ye:null!==(h=_.ye)&&void 0!==h?h:i.topFillColor1,Ce:null!==(l=_.Ce)&&void 0!==l?l:i.topFillColor2,Pe:null!==(a=_.Pe)&&void 0!==a?a:i.bottomFillColor1,Te:null!==(o=_.Te)&&void 0!==o?o:i.bottomFillColor2}},Line:(t,i,s,n)=>{var e,r;const h=v(t(s,n));return{de:null!==(e=h.O)&&void 0!==e?e:i.color,lt:null!==(r=h.O)&&void 0!==r?r:i.color}},Histogram:(t,i,s,n)=>{var e;return{de:null!==(e=v(t(s,n)).O)&&void 0!==e?e:i.color}}};class Bi{constructor(t){this.Gh=(t,i)=>void 0!==i?i.Bt:this.Hr.Ls().Jh(t),this.Hr=t,this.Qh=Oi[t.tl()]}Un(t,i){return this.Qh(this.Gh,this.Hr.W(),t,i)}}var Ai;exports.MismatchDirection=void 0,(Ai=exports.MismatchDirection||(exports.MismatchDirection={}))[Ai.NearestLeft=-1]="NearestLeft",Ai[Ai.None=0]="None",Ai[Ai.NearestRight=1]="NearestRight";const Ei=30;class Vi{constructor(){this.il=[],this.sl=new Map,this.nl=new Map}el(){return this.Gn()>0?this.il[this.il.length-1]:null}rl(){return this.Gn()>0?this.hl(0):null}zs(){return this.Gn()>0?this.hl(this.il.length-1):null}Gn(){return this.il.length}Wi(){return 0===this.Gn()}Gr(t){return null!==this.ll(t,0)}Jh(t){return this.al(t)}al(t,i=0){const s=this.ll(t,i);return null===s?null:Object.assign(Object.assign({},this.ol(s)),{re:this.hl(s)})}ne(){return this.il}_l(t,i,s){if(this.Wi())return null;let n=null;for(const e of s){n=Ii(n,this.ul(t,i,e))}return n}J(t){this.nl.clear(),this.sl.clear(),this.il=t}hl(t){return this.il[t].re}ol(t){return this.il[t]}ll(t,i){const s=this.cl(t);if(null===s&&0!==i)switch(i){case-1:return this.dl(t);case 1:return this.fl(t);default:throw new TypeError("Unknown search mode")}return s}dl(t){let i=this.vl(t);return i>0&&(i-=1),i!==this.il.length&&this.hl(i)<t?i:null}fl(t){const i=this.pl(t);return i!==this.il.length&&t<this.hl(i)?i:null}cl(t){const i=this.vl(t);return i===this.il.length||t<this.il[i].re?null:i}vl(t){return Rt(this.il,t,((t,i)=>t.re<i))}pl(t){return Dt(this.il,t,((t,i)=>t.re>i))}ml(t,i,s){let n=null;for(let e=t;e<i;e++){const t=this.il[e].Bt[s];Number.isNaN(t)||(null===n?n={bl:t,wl:t}:(t<n.bl&&(n.bl=t),t>n.wl&&(n.wl=t)))}return n}ul(t,i,s){if(this.Wi())return null;let n=null;const e=v(this.rl()),r=v(this.zs()),h=Math.max(t,e),l=Math.min(i,r),a=Math.ceil(h/Ei)*Ei,o=Math.max(a,Math.floor(l/Ei)*Ei);{const t=this.vl(h),e=this.pl(Math.min(l,a,i));n=Ii(n,this.ml(t,e,s))}let _=this.sl.get(s);void 0===_&&(_=new Map,this.sl.set(s,_));for(let t=Math.max(a+1,h);t<o;t+=Ei){const i=Math.floor(t/Ei);let e=_.get(i);if(void 0===e){const t=this.vl(i*Ei),n=this.pl((i+1)*Ei-1);e=this.ml(t,n,s),_.set(i,e)}n=Ii(n,e)}{const t=this.vl(o),i=this.pl(l);n=Ii(n,this.ml(t,i,s))}return n}}function Ii(t,i){if(null===t)return i;if(null===i)return t;return{bl:Math.min(t.bl,i.bl),wl:Math.max(t.wl,i.wl)}}class zi{constructor(t){this.gl=t}K(t,i,s){this.gl.draw(t)}Ml(t,i,s){var n,e;null===(e=(n=this.gl).drawBackground)||void 0===e||e.call(n,t)}}class Li{constructor(t){this.ir=null,this.xs=t}gt(){var t;const i=this.xs.renderer();if(null===i)return null;if((null===(t=this.ir)||void 0===t?void 0:t.xl)===i)return this.ir.Sl;const s=new zi(i);return this.ir={xl:i,Sl:s},s}kl(){var t,i,s;return null!==(s=null===(i=(t=this.xs).zOrder)||void 0===i?void 0:i.call(t))&&void 0!==s?s:"normal"}}function Ni(t){var i,s,n,e,r;return{Gt:t.text(),yi:t.coordinate(),ki:null===(i=t.fixedCoordinate)||void 0===i?void 0:i.call(t),O:t.textColor(),t:t.backColor(),Ct:null===(n=null===(s=t.visible)||void 0===s?void 0:s.call(t))||void 0===n||n,li:null===(r=null===(e=t.tickVisible)||void 0===e?void 0:e.call(t))||void 0===r||r}}class Fi{constructor(t,i){this.jt=new it,this.yl=t,this.Cl=i}gt(){return this.jt.J(Object.assign({Ui:this.Cl.Ui()},Ni(this.yl))),this.jt}}class Wi extends J{constructor(t,i){super(),this.yl=t,this.Ni=i}Li(t,i,s){const n=Ni(this.yl);s.t=n.t,t.O=n.O;const e=2/12*this.Ni.T();s.gi=e,s.Mi=e,s.yi=n.yi,s.ki=n.ki,t.Gt=n.Gt,t.Ct=n.Ct,t.li=n.li}}class ji{constructor(t,i){this.Pl=null,this.Tl=null,this.Rl=null,this.Dl=null,this.Ol=null,this.Bl=t,this.Hr=i}Al(){return this.Bl}Es(){var t,i;null===(i=(t=this.Bl).updateAllViews)||void 0===i||i.call(t)}Os(){var t,i,s,n;const e=null!==(s=null===(i=(t=this.Bl).paneViews)||void 0===i?void 0:i.call(t))&&void 0!==s?s:[];if((null===(n=this.Pl)||void 0===n?void 0:n.xl)===e)return this.Pl.Sl;const r=e.map((t=>new Li(t)));return this.Pl={xl:e,Sl:r},r}ss(){var t,i,s,n;const e=null!==(s=null===(i=(t=this.Bl).timeAxisViews)||void 0===i?void 0:i.call(t))&&void 0!==s?s:[];if((null===(n=this.Tl)||void 0===n?void 0:n.xl)===e)return this.Tl.Sl;const r=this.Hr.$t().kt(),h=e.map((t=>new Fi(t,r)));return this.Tl={xl:e,Sl:h},h}Bs(){var t,i,s,n;const e=null!==(s=null===(i=(t=this.Bl).priceAxisViews)||void 0===i?void 0:i.call(t))&&void 0!==s?s:[];if((null===(n=this.Rl)||void 0===n?void 0:n.xl)===e)return this.Rl.Sl;const r=this.Hr.Ot(),h=e.map((t=>new Wi(t,r)));return this.Rl={xl:e,Sl:h},h}El(){var t,i,s,n;const e=null!==(s=null===(i=(t=this.Bl).priceAxisPaneViews)||void 0===i?void 0:i.call(t))&&void 0!==s?s:[];if((null===(n=this.Dl)||void 0===n?void 0:n.xl)===e)return this.Dl.Sl;const r=e.map((t=>new Li(t)));return this.Dl={xl:e,Sl:r},r}Vl(){var t,i,s,n;const e=null!==(s=null===(i=(t=this.Bl).timeAxisPaneViews)||void 0===i?void 0:i.call(t))&&void 0!==s?s:[];if((null===(n=this.Ol)||void 0===n?void 0:n.xl)===e)return this.Ol.Sl;const r=e.map((t=>new Li(t)));return this.Ol={xl:e,Sl:r},r}Il(t,i){var s,n,e;return null!==(e=null===(n=(s=this.Bl).autoscaleInfo)||void 0===n?void 0:n.call(s,t,i))&&void 0!==e?e:null}gr(t,i){var s,n,e;return null!==(e=null===(n=(s=this.Bl).hitTest)||void 0===n?void 0:n.call(s,t,i))&&void 0!==e?e:null}}function Hi(t,i,s,n){t.forEach((t=>{i(t).forEach((t=>{t.kl()===s&&n.push(t)}))}))}function $i(t){return t.Os()}function Ui(t){return t.El()}function qi(t){return t.Vl()}class Yi extends Di{constructor(t,i,s,n,e){super(t),this.zt=new Vi,this.Hh=new xi(this),this.zl=[],this.Ll=new ni(this),this.Nl=null,this.Fl=null,this.Wl=[],this.jl=[],this.Hl=null,this.$l=[],this.fs=i,this.Ul=s;const r=new Si(this);this.ls=[r],this.$h=new ti(r,this,t),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(this.Nl=new ai(this)),this.ql(),this.Yl(e)}S(){null!==this.Hl&&clearTimeout(this.Hl)}bh(t){return this.fs.priceLineColor||t}Kr(t){const i={Zr:!0},s=this.Ot();if(this.$t().kt().Wi()||s.Wi()||this.zt.Wi())return i;const n=this.$t().kt().Zn(),e=this.Pt();if(null===n||null===e)return i;let r,h;if(t){const t=this.zt.el();if(null===t)return i;r=t,h=t.re}else{const t=this.zt.al(n.ci(),-1);if(null===t)return i;if(r=this.zt.Jh(t.re),null===r)return i;h=t.re}const l=r.Bt[3],a=this.qn().Un(h,{Bt:r}),o=s.Dt(l,e.Bt);return{Zr:!1,_t:l,Gt:s.ji(l,e.Bt),Sh:s.Xl(l),kh:s.Kl(l,e.Bt),O:a.de,yi:o,re:h}}qn(){return null!==this.Fl||(this.Fl=new Bi(this)),this.Fl}W(){return this.fs}Uh(t){var i;const s=t.priceScaleId;void 0!==s&&s!==this.fs.priceScaleId&&this.$t().Zl(this,s);const n=null!==(i=this.fs.pane)&&void 0!==i?i:0;P(this.fs,t),void 0!==t.priceFormat&&(this.ql(),this.$t().Gl()),t.pane&&n!==t.pane&&this.$t().Jl(this,n,t.pane),this.$t().Ql(this),this.$t().ta(),this.xs.bt("options")}J(t,i){this.zt.J(t),this.ia(),this.xs.bt("data"),this.vs.bt("data"),null!==this.Nl&&(i&&i.sa?this.Nl.Ur():0===t.length&&this.Nl.$r());const s=this.$t().vr(this);this.$t().na(s),this.$t().Ql(this),this.$t().ta(),this.$t().qh()}ea(t){this.Wl=t,this.ia();const i=this.$t().vr(this);this.vs.bt("data"),this.$t().na(i),this.$t().Ql(this),this.$t().ta(),this.$t().qh()}ra(){return this.Wl}fh(){return this.jl}ha(t){const i=new Ri(this,t);return this.zl.push(i),this.$t().Ql(this),i}la(t){const i=this.zl.indexOf(t);-1!==i&&this.zl.splice(i,1),this.$t().Ql(this)}tl(){return this.Ul}Pt(){const t=this.aa();return null===t?null:{Bt:t.Bt[3],oa:t.ot}}aa(){const t=this.$t().kt().Zn();if(null===t)return null;const i=t.An();return this.zt.al(i,1)}Ls(){return this.zt}mh(t){const i=this.zt.Jh(t);return null===i?null:"Bar"===this.Ul||"Candlestick"===this.Ul||"Custom"===this.Ul?{Me:i.Bt[0],xe:i.Bt[1],Se:i.Bt[2],ke:i.Bt[3]}:i.Bt[3]}_a(t){const i=[];Hi(this.$l,$i,"top",i);const s=this.Nl;return null!==s&&s.Ct()?(null===this.Hl&&s.Yr()&&(this.Hl=setTimeout((()=>{this.Hl=null,this.$t().ua()}),0)),s.qr(),i.unshift(s),i):i}Os(){const t=[];this.ca()||t.push(this.Ll),t.push(this.xs,this.Hh,this.vs);const i=this.zl.map((t=>t.Yh()));return t.push(...i),Hi(this.$l,$i,"normal",t),t}da(){return this.fa($i,"bottom")}va(t){return this.fa(Ui,t)}pa(t){return this.fa(qi,t)}ma(t,i){return this.$l.map((s=>s.gr(t,i))).filter((t=>null!==t))}ts(t){return[this.$h,...this.zl.map((t=>t.Xh()))]}Bs(t,i){var s;if(i.ba()!==(null===(s=this.Ki)||void 0===s?void 0:s.ba())&&!this.ca())return[];const n=[...this.ls];for(const t of this.zl)n.push(t.Kh());return this.$l.forEach((t=>{n.push(...t.Bs())})),n}ss(){const t=[];return this.$l.forEach((i=>{t.push(...i.ss())})),t}Il(t,i){if(void 0!==this.fs.autoscaleInfoProvider){const s=this.fs.autoscaleInfoProvider((()=>{const s=this.wa(t,i);return null===s?null:s.Eh()}));return Ci.Vh(s)}return this.wa(t,i)}ga(){return this.fs.priceFormat.minMove}Ma(){return this.xa}Es(){var t;this.xs.bt(),this.vs.bt();for(const t of this.ls)t.bt();for(const t of this.zl)t.bt();this.Hh.bt(),this.Ll.bt(),null===(t=this.Nl)||void 0===t||t.bt(),this.$l.forEach((t=>t.Es()))}Ot(){return v(super.Ot())}yt(t){if(!(("Line"===this.Ul||"Area"===this.Ul||"Baseline"===this.Ul)&&this.fs.crosshairMarkerVisible))return null;const i=this.zt.Jh(t);if(null===i)return null;return{_t:i.Bt[3],ht:this.Sa(),At:this.ka(),Rt:this.ya(),Tt:this.Ca(t)}}wh(){return this.fs.title}Ct(){return this.fs.visible}Pa(t){this.$l.push(new ji(t,this))}Ta(t){this.$l=this.$l.filter((i=>i.Al()!==t))}Ra(){if(this.xs instanceof qt!=!1)return t=>this.xs.je(t)}Da(){if(this.xs instanceof qt!=!1)return t=>this.xs.He(t)}ca(){return!ht(this.Ot().ba())}wa(t,i){if(!R(t)||!R(i)||this.zt.Wi())return null;const s="Line"===this.Ul||"Area"===this.Ul||"Baseline"===this.Ul||"Histogram"===this.Ul?[3]:[2,1],n=this.zt._l(t,i,s);let e=null!==n?new yi(n.bl,n.wl):null;if("Histogram"===this.tl()){const t=this.fs.base,i=new yi(t,t);e=null!==e?e.en(i):i}let r=this.vs.dh();return this.$l.forEach((s=>{const n=s.Il(t,i);if(null==n?void 0:n.priceRange){const t=new yi(n.priceRange.minValue,n.priceRange.maxValue);e=null!==e?e.en(t):t}var h,l,a,o;(null==n?void 0:n.margins)&&(h=r,l=n.margins,r={above:Math.max(null!==(a=null==h?void 0:h.above)&&void 0!==a?a:0,l.above),below:Math.max(null!==(o=null==h?void 0:h.below)&&void 0!==o?o:0,l.below)})})),new Ci(e,r)}Sa(){switch(this.Ul){case"Line":case"Area":case"Baseline":return this.fs.crosshairMarkerRadius}return 0}ka(){switch(this.Ul){case"Line":case"Area":case"Baseline":{const t=this.fs.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}ya(){switch(this.Ul){case"Line":case"Area":case"Baseline":return this.fs.crosshairMarkerBorderWidth}return 0}Ca(t){switch(this.Ul){case"Line":case"Area":case"Baseline":{const t=this.fs.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this.qn().Un(t).de}ql(){switch(this.fs.priceFormat.type){case"custom":this.xa={format:this.fs.priceFormat.formatter};break;case"volume":this.xa=new ct(this.fs.priceFormat.precision);break;case"percent":this.xa=new ut(this.fs.priceFormat.precision);break;default:{const t=Math.pow(10,this.fs.priceFormat.precision);this.xa=new _t(t,this.fs.priceFormat.minMove*t)}}null!==this.Ki&&this.Ki.Oa()}ia(){const t=this.$t().kt();if(!t.Ba()||this.zt.Wi())return void(this.jl=[]);const i=v(this.zt.rl());this.jl=this.Wl.map(((s,n)=>{const e=v(t.Aa(s.time,!0)),r=e<i?1:-1;return{time:v(this.zt.al(e,r)).re,position:s.position,shape:s.shape,color:s.color,id:s.id,ih:n,text:s.text,size:s.size,originalTime:s.originalTime}}))}Yl(t){switch(this.vs=new Mi(this,this.$t()),this.Ul){case"Bar":this.xs=new Nt(this,this.$t());break;case"Candlestick":this.xs=new $t(this,this.$t());break;case"Line":this.xs=new Zt(this,this.$t());break;case"Custom":this.xs=new qt(this,this.$t(),f(t));break;case"Area":this.xs=new It(this,this.$t());break;case"Baseline":this.xs=new jt(this,this.$t());break;case"Histogram":this.xs=new Kt(this,this.$t());break;default:throw Error("Unknown chart style assigned: "+this.Ul)}}fa(t,i){const s=[];return Hi(this.$l,t,i,s),s}}class Xi{constructor(t){this.fs=t}Ea(t,i,s){let n=t;if(0===this.fs.mode)return n;const e=s.bs(),r=e.Pt();if(null===r)return n;const h=e.Dt(t,r),l=s.xt().filter((t=>t instanceof Yi)).reduce(((t,n)=>{if(s.pr(n)||!n.Ct())return t;const e=n.Ot(),r=n.Ls();if(e.Wi()||!r.Gr(i))return t;const h=r.Jh(i);if(null===h)return t;const l=p(n.Pt());return t.concat([e.Dt(h.Bt[3],l.Bt)])}),[]);if(0===l.length)return n;l.sort(((t,i)=>Math.abs(t-h)-Math.abs(i-h)));const a=l[0];return n=e.ws(a,r),n}}class Ki extends N{constructor(){super(...arguments),this.zt=null}J(t){this.zt=t}Z({context:t,bitmapSize:i,horizontalPixelRatio:s,verticalPixelRatio:n}){if(null===this.zt)return;const e=Math.max(1,Math.floor(s));t.lineWidth=e,function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(()=>{const r=v(this.zt);if(r.Va){t.strokeStyle=r.Ia,u(t,r.za),t.beginPath();for(const n of r.La){const r=Math.round(n.Na*s);t.moveTo(r,-e),t.lineTo(r,i.height+e)}t.stroke()}if(r.Fa){t.strokeStyle=r.Wa,u(t,r.ja),t.beginPath();for(const s of r.Ha){const r=Math.round(s.Na*n);t.moveTo(-e,r),t.lineTo(i.width+e,r)}t.stroke()}}))}}class Zi{constructor(t){this.jt=new Ki,this.Ri=!0,this.ns=t}bt(){this.Ri=!0}gt(){if(this.Ri){const t=this.ns.$t().W().grid,i={Fa:t.horzLines.visible,Va:t.vertLines.visible,Wa:t.horzLines.color,Ia:t.vertLines.color,ja:t.horzLines.style,za:t.vertLines.style,Ha:this.ns.bs().$a(),La:(this.ns.$t().kt().$a()||[]).map((t=>({Na:t.coord})))};this.jt.J(i),this.Ri=!1}return this.jt}}class Gi{constructor(t){this.xs=new Zi(t)}Yh(){return this.xs}}const Ji={Ua:4,qa:1e-4};function Qi(t,i){const s=100*(t-i)/i;return i<0?-s:s}function ts(t,i){const s=Qi(t.Rh(),i),n=Qi(t.Dh(),i);return new yi(s,n)}function is(t,i){const s=100*(t-i)/i+100;return i<0?-s:s}function ss(t,i){const s=is(t.Rh(),i),n=is(t.Dh(),i);return new yi(s,n)}function ns(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const n=Math.log10(s+i.qa)+i.Ua;return t<0?-n:n}function es(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const n=Math.pow(10,s-i.Ua)-i.qa;return t<0?-n:n}function rs(t,i){if(null===t)return null;const s=ns(t.Rh(),i),n=ns(t.Dh(),i);return new yi(s,n)}function hs(t,i){if(null===t)return null;const s=es(t.Rh(),i),n=es(t.Dh(),i);return new yi(s,n)}function ls(t){if(null===t)return Ji;const i=Math.abs(t.Dh()-t.Rh());if(i>=1||i<1e-15)return Ji;const s=Math.ceil(Math.abs(Math.log10(i))),n=Ji.Ua+s;return{Ua:n,qa:1/Math.pow(10,n)}}class as{constructor(t,i){if(this.Ya=t,this.Xa=i,function(t){if(t<0)return!1;for(let i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.Ya))this.Ka=[2,2.5,2];else{this.Ka=[];for(let t=this.Ya;1!==t;){if(t%2==0)this.Ka.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this.Ka.push(2,2.5),t/=5}if(this.Ka.length>100)throw new Error("something wrong with base")}}}Za(t,i,s){const n=0===this.Ya?0:1/this.Ya;let e=Math.pow(10,Math.max(0,Math.ceil(Math.log10(t-i)))),r=0,h=this.Xa[0];for(;;){const t=Mt(e,n,1e-14)&&e>n+1e-14,i=Mt(e,s*h,1e-14),l=Mt(e,1,1e-14);if(!(t&&i&&l))break;e/=h,h=this.Xa[++r%this.Xa.length]}if(e<=n+1e-14&&(e=n),e=Math.max(1,e),this.Ka.length>0&&(l=e,a=1,o=1e-14,Math.abs(l-a)<o))for(r=0,h=this.Ka[0];Mt(e,s*h,1e-14)&&e>n+1e-14;)e/=h,h=this.Ka[++r%this.Ka.length];var l,a,o;return e}}class os{constructor(t,i,s,n){this.Ga=[],this.Ni=t,this.Ya=i,this.Ja=s,this.Qa=n}Za(t,i){if(t<i)throw new Error("high < low");const s=this.Ni.Vt(),n=(t-i)*this.io()/s,e=new as(this.Ya,[2,2.5,2]),r=new as(this.Ya,[2,2,2.5]),h=new as(this.Ya,[2.5,2,2]),l=[];return l.push(e.Za(t,i,n),r.Za(t,i,n),h.Za(t,i,n)),function(t){if(t.length<1)throw Error("array is empty");let i=t[0];for(let s=1;s<t.length;++s)t[s]<i&&(i=t[s]);return i}(l)}so(){const t=this.Ni,i=t.Pt();if(null===i)return void(this.Ga=[]);const s=t.Vt(),n=this.Ja(s-1,i),e=this.Ja(0,i),r=this.Ni.W().entireTextOnly?this.no()/2:0,h=r,l=s-1-r,a=Math.max(n,e),o=Math.min(n,e);if(a===o)return void(this.Ga=[]);let _=this.Za(a,o),u=a%_;u+=u<0?_:0;const c=a>=o?1:-1;let d=null,f=0;for(let s=a-u;s>o;s-=_){const n=this.Qa(s,i,!0);null!==d&&Math.abs(n-d)<this.io()||(n<h||n>l||(f<this.Ga.length?(this.Ga[f].Na=n,this.Ga[f].eo=t.ro(s)):this.Ga.push({Na:n,eo:t.ro(s)}),f++,d=n,t.ho()&&(_=this.Za(s*c,o))))}this.Ga.length=f}$a(){return this.Ga}no(){return this.Ni.T()}io(){return Math.ceil(2.5*this.no())}}function _s(t){return t.slice().sort(((t,i)=>v(t.Gi())-v(i.Gi())))}var us;exports.PriceScaleMode=void 0,(us=exports.PriceScaleMode||(exports.PriceScaleMode={}))[us.Normal=0]="Normal",us[us.Logarithmic=1]="Logarithmic",us[us.Percentage=2]="Percentage",us[us.IndexedTo100=3]="IndexedTo100";const cs=new ut,ds=new _t(100,1);class fs{constructor(t,i,s,n){this.lo=0,this.ao=null,this.Ih=null,this.oo=null,this._o={uo:!1,co:null},this.do=0,this.fo=0,this.vo=new C,this.po=new C,this.mo=[],this.bo=null,this.wo=null,this.Mo=null,this.xo=null,this.xa=ds,this.So=ls(null),this.ko=t,this.fs=i,this.yo=s,this.Co=n,this.Po=new os(this,100,this.To.bind(this),this.Ro.bind(this))}ba(){return this.ko}W(){return this.fs}Uh(t){if(P(this.fs,t),this.Oa(),void 0!==t.mode&&this.Do({Pr:t.mode}),void 0!==t.scaleMargins){const i=f(t.scaleMargins.top),s=f(t.scaleMargins.bottom);if(i<0||i>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i}`);if(s<0||s>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${s}`);if(i+s>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i+s}`);this.Oo(),this.wo=null}}Bo(){return this.fs.autoScale}ho(){return 1===this.fs.mode}xh(){return 2===this.fs.mode}Ao(){return 3===this.fs.mode}Pr(){return{$s:this.fs.autoScale,Eo:this.fs.invertScale,Pr:this.fs.mode}}Do(t){const i=this.Pr();let s=null;void 0!==t.$s&&(this.fs.autoScale=t.$s),void 0!==t.Pr&&(this.fs.mode=t.Pr,2!==t.Pr&&3!==t.Pr||(this.fs.autoScale=!0),this._o.uo=!1),1===i.Pr&&t.Pr!==i.Pr&&(!function(t,i){if(null===t)return!1;const s=es(t.Rh(),i),n=es(t.Dh(),i);return isFinite(s)&&isFinite(n)}(this.Ih,this.So)?this.fs.autoScale=!0:(s=hs(this.Ih,this.So),null!==s&&this.Vo(s))),1===t.Pr&&t.Pr!==i.Pr&&(s=rs(this.Ih,this.So),null!==s&&this.Vo(s));const n=i.Pr!==this.fs.mode;n&&(2===i.Pr||this.xh())&&this.Oa(),n&&(3===i.Pr||this.Ao())&&this.Oa(),void 0!==t.Eo&&i.Eo!==t.Eo&&(this.fs.invertScale=t.Eo,this.Io()),this.po.m(i,this.Pr())}zo(){return this.po}T(){return this.yo.fontSize}Vt(){return this.lo}Lo(t){this.lo!==t&&(this.lo=t,this.Oo(),this.wo=null)}No(){if(this.ao)return this.ao;const t=this.Vt()-this.Fo()-this.Wo();return this.ao=t,t}Lh(){return this.jo(),this.Ih}Vo(t,i){const s=this.Ih;(i||null===s&&null!==t||null!==s&&!s.Ph(t))&&(this.wo=null,this.Ih=t)}Wi(){return this.jo(),0===this.lo||!this.Ih||this.Ih.Wi()}Ho(t){return this.Eo()?t:this.Vt()-1-t}Dt(t,i){return this.xh()?t=Qi(t,i):this.Ao()&&(t=is(t,i)),this.Ro(t,i)}ie(t,i,s){this.jo();const n=this.Wo(),e=v(this.Lh()),r=e.Rh(),h=e.Dh(),l=this.No()-1,a=this.Eo(),o=l/(h-r),_=void 0===s?0:s.from,u=void 0===s?t.length:s.to,c=this.$o();for(let s=_;s<u;s++){const e=t[s],h=e._t;if(isNaN(h))continue;let l=h;null!==c&&(l=c(e._t,i));const _=n+o*(l-r),u=a?_:this.lo-1-_;e.nt=u}}we(t,i,s){this.jo();const n=this.Wo(),e=v(this.Lh()),r=e.Rh(),h=e.Dh(),l=this.No()-1,a=this.Eo(),o=l/(h-r),_=void 0===s?0:s.from,u=void 0===s?t.length:s.to,c=this.$o();for(let s=_;s<u;s++){const e=t[s];let h=e.Me,l=e.xe,_=e.Se,u=e.ke;null!==c&&(h=c(e.Me,i),l=c(e.xe,i),_=c(e.Se,i),u=c(e.ke,i));let d=n+o*(h-r),f=a?d:this.lo-1-d;e.me=f,d=n+o*(l-r),f=a?d:this.lo-1-d,e.fe=f,d=n+o*(_-r),f=a?d:this.lo-1-d,e.ve=f,d=n+o*(u-r),f=a?d:this.lo-1-d,e.be=f}}ws(t,i){const s=this.To(t,i);return this.Uo(s,i)}Uo(t,i){let s=t;return this.xh()?s=function(t,i){return i<0&&(t=-t),t/100*i+i}(s,i):this.Ao()&&(s=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(s,i)),s}xt(){return this.mo}qo(){if(this.bo)return this.bo;let t=[];for(let i=0;i<this.mo.length;i++){const s=this.mo[i];null===s.Gi()&&s.Ji(i+1),t.push(s)}return t=_s(t),this.bo=t,this.bo}Yo(t){-1===this.mo.indexOf(t)&&(this.mo.push(t),this.Oa(),this.Xo())}Ko(t){const i=this.mo.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.mo.splice(i,1),0===this.mo.length&&(this.Do({$s:!0}),this.Vo(null)),this.Oa(),this.Xo()}Pt(){let t=null;for(const i of this.mo){const s=i.Pt();null!==s&&((null===t||s.oa<t.oa)&&(t=s))}return null===t?null:t.Bt}Eo(){return this.fs.invertScale}$a(){const t=null===this.Pt();if(null!==this.wo&&(t||this.wo.Zo===t))return this.wo.$a;this.Po.so();const i=this.Po.$a();return this.wo={$a:i,Zo:t},this.vo.m(),i}Go(){return this.vo}Jo(t){this.xh()||this.Ao()||null===this.Mo&&null===this.oo&&(this.Wi()||(this.Mo=this.lo-t,this.oo=v(this.Lh()).Th()))}Qo(t){if(this.xh()||this.Ao())return;if(null===this.Mo)return;this.Do({$s:!1}),(t=this.lo-t)<0&&(t=0);let i=(this.Mo+.2*(this.lo-1))/(t+.2*(this.lo-1));const s=v(this.oo).Th();i=Math.max(i,.1),s.Bh(i),this.Vo(s)}t_(){this.xh()||this.Ao()||(this.Mo=null,this.oo=null)}i_(t){this.Bo()||null===this.xo&&null===this.oo&&(this.Wi()||(this.xo=t,this.oo=v(this.Lh()).Th()))}s_(t){if(this.Bo())return;if(null===this.xo)return;const i=v(this.Lh()).Oh()/(this.No()-1);let s=t-this.xo;this.Eo()&&(s*=-1);const n=s*i,e=v(this.oo).Th();e.Ah(n),this.Vo(e,!0),this.wo=null}n_(){this.Bo()||null!==this.xo&&(this.xo=null,this.oo=null)}Ma(){return this.xa||this.Oa(),this.xa}ji(t,i){switch(this.fs.mode){case 2:return this.e_(Qi(t,i));case 3:return this.Ma().format(is(t,i));default:return this.jh(t)}}ro(t){switch(this.fs.mode){case 2:return this.e_(t);case 3:return this.Ma().format(t);default:return this.jh(t)}}Xl(t){return this.jh(t,v(this.r_()).Ma())}Kl(t,i){return t=Qi(t,i),this.e_(t,cs)}h_(){return this.mo}l_(t){this._o={co:t,uo:!1}}Es(){this.mo.forEach((t=>t.Es()))}Oa(){this.wo=null;const t=this.r_();let i=100;null!==t&&(i=Math.round(1/t.ga())),this.xa=ds,this.xh()?(this.xa=cs,i=100):this.Ao()?(this.xa=new _t(100,1),i=100):null!==t&&(this.xa=t.Ma()),this.Po=new os(this,i,this.To.bind(this),this.Ro.bind(this)),this.Po.so()}Xo(){this.bo=null}r_(){return this.mo[0]||null}Fo(){return this.Eo()?this.fs.scaleMargins.bottom*this.Vt()+this.fo:this.fs.scaleMargins.top*this.Vt()+this.do}Wo(){return this.Eo()?this.fs.scaleMargins.top*this.Vt()+this.do:this.fs.scaleMargins.bottom*this.Vt()+this.fo}jo(){this._o.uo||(this._o.uo=!0,this.a_())}Oo(){this.ao=null}Ro(t,i){if(this.jo(),this.Wi())return 0;t=this.ho()&&t?ns(t,this.So):t;const s=v(this.Lh()),n=this.Wo()+(this.No()-1)*(t-s.Rh())/s.Oh();return this.Ho(n)}To(t,i){if(this.jo(),this.Wi())return 0;const s=this.Ho(t),n=v(this.Lh()),e=n.Rh()+n.Oh()*((s-this.Wo())/(this.No()-1));return this.ho()?es(e,this.So):e}Io(){this.wo=null,this.Po.so()}a_(){const t=this._o.co;if(null===t)return;let i=null;const s=this.h_();let n=0,e=0;for(const r of s){if(!r.Ct())continue;const s=r.Pt();if(null===s)continue;const h=r.Il(t.An(),t.ci());let l=h&&h.Lh();if(null!==l){switch(this.fs.mode){case 1:l=rs(l,this.So);break;case 2:l=ts(l,s.Bt);break;case 3:l=ss(l,s.Bt)}if(i=null===i?l:i.en(v(l)),null!==h){const t=h.Nh();null!==t&&(n=Math.max(n,t.above),e=Math.max(e,t.below))}}}if(n===this.do&&e===this.fo||(this.do=n,this.fo=e,this.wo=null,this.Oo()),null!==i){if(i.Rh()===i.Dh()){const t=this.r_(),s=5*(null===t||this.xh()||this.Ao()?1:t.ga());this.ho()&&(i=hs(i,this.So)),i=new yi(i.Rh()-s,i.Dh()+s),this.ho()&&(i=rs(i,this.So))}if(this.ho()){const t=hs(i,this.So),s=ls(t);if(r=s,h=this.So,r.Ua!==h.Ua||r.qa!==h.qa){const n=null!==this.oo?hs(this.oo,this.So):null;this.So=s,i=rs(t,s),null!==n&&(this.oo=rs(n,s))}}this.Vo(i)}else null===this.Ih&&(this.Vo(new yi(-.5,.5)),this.So=ls(null));var r,h;this._o.uo=!0}$o(){return this.xh()?Qi:this.Ao()?is:this.ho()?t=>ns(t,this.So):null}o_(t,i,s){return void 0===i?(void 0===s&&(s=this.Ma()),s.format(t)):i(t)}jh(t,i){return this.o_(t,this.Co.priceFormatter,i)}e_(t,i){return this.o_(t,this.Co.percentageFormatter,i)}}const vs=1e3;class ps{constructor(t,i,s=0){var n,e;this.mo=[],this.__=new Map,this.lo=0,this.u_=30,this.c_=0,this.d_=vs,this.bo=null,this.f_=new C,this.Cl=t,this.qi=i,this.v_=new Gi(this);const r=i.W(),h=r.layout.panes[s]||{};this.p_=this.m_("left",r.leftPriceScale),this.p_.zo().l(this.b_.bind(this,this.p_),this),this.w_=this.m_("right",r.rightPriceScale),this.w_.zo().l(this.b_.bind(this,this.w_),this),this.d_=null!==(e=null===(n=r.layout.panes[s])||void 0===n?void 0:n.stretchFactor)&&void 0!==e?e:vs,this.g_(r),this.Uh(h)}Uh(t){var i,s;this.d_=null!==(i=t.stretchFactor)&&void 0!==i?i:this.d_,this.u_=null!==(s=t.minHeight)&&void 0!==s?s:30}g_(t){if(t.leftPriceScale&&this.p_.Uh(t.leftPriceScale),t.rightPriceScale&&this.w_.Uh(t.rightPriceScale),t.localization&&(this.p_.Oa(),this.w_.Oa()),t.overlayPriceScales){const i=Array.from(this.__.values());for(const s of i){const i=v(s[0].Ot());i.Uh(t.overlayPriceScales),t.localization&&i.Oa()}}}M_(t){switch(t){case"left":return this.p_;case"right":return this.w_}return this.__.has(t)?f(this.__.get(t))[0].Ot():null}S(){this.$t().x_().p(this),this.p_.zo().p(this),this.w_.zo().p(this),this.mo.forEach((t=>{t.S&&t.S()})),this.f_.m()}S_(){return this.d_}k_(t){this.d_=t}$t(){return this.qi}Ui(){return this.c_}Vt(){return this.lo}y_(){return this.u_}C_(t){this.c_=t,this.P_()}Lo(t){this.lo=t,this.p_.Lo(t),this.w_.Lo(t),this.mo.forEach((i=>{if(this.pr(i)){const s=i.Ot();null!==s&&s.Lo(t)}})),this.P_()}xt(){return this.mo}pr(t){const i=t.Ot();return null===i||this.p_!==i&&this.w_!==i}Yo(t,i,s){const n=void 0!==s?s:this.R_().T_+1;this.D_(t,i,n)}Ko(t){const i=this.mo.indexOf(t);d(-1!==i,"removeDataSource: invalid data source"),this.mo.splice(i,1);const s=v(t.Ot()).ba();if(this.__.has(s)){const i=f(this.__.get(s)),n=i.indexOf(t);-1!==n&&(i.splice(n,1),0===i.length&&this.__.delete(s))}const n=t.Ot();n&&n.xt().indexOf(t)>=0&&n.Ko(t),null!==n&&(n.Xo(),this.O_(n)),this.bo=null}br(t){return t===this.p_?"left":t===this.w_?"right":"overlay"}B_(){return this.p_}A_(){return this.w_}E_(t,i){t.Jo(i)}V_(t,i){t.Qo(i),this.P_()}I_(t){t.t_()}z_(t,i){t.i_(i)}L_(t,i){t.s_(i),this.P_()}N_(t){t.n_()}P_(){this.mo.forEach((t=>{t.Es()}))}bs(){let t=null;return this.qi.W().rightPriceScale.visible&&0!==this.w_.xt().length?t=this.w_:this.qi.W().leftPriceScale.visible&&0!==this.p_.xt().length?t=this.p_:0!==this.mo.length&&(t=this.mo[0].Ot()),null===t&&(t=this.w_),t}mr(){let t=null;return this.qi.W().rightPriceScale.visible?t=this.w_:this.qi.W().leftPriceScale.visible&&(t=this.p_),t}O_(t){null!==t&&t.Bo()&&this.F_(t)}W_(t){const i=this.Cl.Zn();t.Do({$s:!0}),null!==i&&t.l_(i),this.P_()}j_(){this.F_(this.p_),this.F_(this.w_)}H_(){this.O_(this.p_),this.O_(this.w_),this.mo.forEach((t=>{this.pr(t)&&this.O_(t.Ot())})),this.P_(),this.qi.qh()}qo(){return null===this.bo&&(this.bo=_s(this.mo)),this.bo}U_(){return this.f_}q_(){return this.v_}F_(t){const i=t.h_();if(i&&i.length>0&&!this.Cl.Wi()){const i=this.Cl.Zn();null!==i&&t.l_(i)}t.Es()}R_(){const t=this.qo();if(0===t.length)return{Y_:0,T_:0};let i=0,s=0;for(let n=0;n<t.length;n++){const e=t[n].Gi();null!==e&&(e<i&&(i=e),e>s&&(s=e))}return{Y_:i,T_:s}}D_(t,i,s){let n=this.M_(i);if(null===n&&(n=this.m_(i,this.qi.W().overlayPriceScales)),this.mo.push(t),!ht(i)){const s=this.__.get(i)||[];s.push(t),this.__.set(i,s)}n.Yo(t),t.Qi(n),t.Ji(s),this.O_(n),this.bo=null}b_(t,i,s){i.Pr!==s.Pr&&this.F_(t)}m_(t,i){const s=Object.assign({visible:!0,autoScale:!0},B(i)),n=new fs(t,s,this.qi.W().layout,this.qi.W().localization);return n.Lo(this.Vt()),n}}class ms{constructor(t,i,s=50){this.Ge=0,this.Je=1,this.Qe=1,this.ir=new Map,this.tr=new Map,this.X_=t,this.K_=i,this.sr=s}Z_(t){const i=t.time,s=this.K_.cacheKey(i),n=this.ir.get(s);if(void 0!==n)return n.G_;if(this.Ge===this.sr){const t=this.tr.get(this.Qe);this.tr.delete(this.Qe),this.ir.delete(f(t)),this.Qe++,this.Ge--}const e=this.X_(t);return this.ir.set(s,{G_:e,hr:this.Je}),this.tr.set(this.Je,s),this.Ge++,this.Je++,e}}class bs{constructor(t,i){d(t<=i,"right should be >= left"),this.J_=t,this.Q_=i}An(){return this.J_}ci(){return this.Q_}tu(){return this.Q_-this.J_+1}Gr(t){return this.J_<=t&&t<=this.Q_}Ph(t){return this.J_===t.An()&&this.Q_===t.ci()}}function ws(t,i){return null===t||null===i?t===i:t.Ph(i)}class gs{constructor(){this.iu=new Map,this.ir=null,this.su=!1}nu(t){this.su=t,this.ir=null}eu(t,i){this.ru(i),this.ir=null;for(let s=i;s<t.length;++s){const i=t[s];let n=this.iu.get(i.timeWeight);void 0===n&&(n=[],this.iu.set(i.timeWeight,n)),n.push({index:s,time:i.time,weight:i.timeWeight,originalTime:i.originalTime})}}hu(t,i){const s=Math.ceil(i/t);return null!==this.ir&&this.ir.lu===s||(this.ir={$a:this.au(s),lu:s}),this.ir.$a}ru(t){if(0===t)return void this.iu.clear();const i=[];this.iu.forEach(((s,n)=>{t<=s[0].index?i.push(n):s.splice(Rt(s,t,(i=>i.index<t)),1/0)}));for(const t of i)this.iu.delete(t)}au(t){let i=[];for(const s of Array.from(this.iu.keys()).sort(((t,i)=>i-t))){if(!this.iu.get(s))continue;const n=i;i=[];const e=n.length;let r=0;const h=f(this.iu.get(s)),l=h.length;let a=1/0,o=-1/0;for(let s=0;s<l;s++){const l=h[s],_=l.index;for(;r<e;){const t=n[r],s=t.index;if(!(s<_)){a=s;break}r++,i.push(t),o=s,a=1/0}if(a-_>=t&&_-o>=t)i.push(l),o=_;else if(this.su)return n}for(;r<e;r++)i.push(n[r])}return i}}class Ms{constructor(t){this.ou=t}_u(){return null===this.ou?null:new bs(Math.floor(this.ou.An()),Math.ceil(this.ou.ci()))}uu(){return this.ou}static cu(){return new Ms(null)}}function xs(t,i){return t.weight>i.weight?t:i}class Ss{constructor(t,i,s,n){this.c_=0,this.du=null,this.fu=[],this.xo=null,this.Mo=null,this.vu=new gs,this.pu=new Map,this.mu=Ms.cu(),this.bu=!0,this.wu=new C,this.gu=new C,this.Mu=new C,this.xu=null,this.Su=null,this.ku=[],this.fs=i,this.Co=s,this.yu=i.rightOffset,this.Cu=i.barSpacing,this.qi=t,this.K_=n,this.Pu(),this.vu.nu(i.uniformDistribution)}W(){return this.fs}Tu(t){P(this.Co,t),this.Ru(),this.Pu()}Uh(t,i){var s;P(this.fs,t),this.fs.fixLeftEdge&&this.Du(),this.fs.fixRightEdge&&this.Ou(),void 0!==t.barSpacing&&this.qi.tn(t.barSpacing),void 0!==t.rightOffset&&this.qi.sn(t.rightOffset),void 0!==t.minBarSpacing&&this.qi.tn(null!==(s=t.barSpacing)&&void 0!==s?s:this.Cu),this.Ru(),this.Pu(),this.Mu.m()}gs(t){var i,s;return null!==(s=null===(i=this.fu[t])||void 0===i?void 0:i.time)&&void 0!==s?s:null}Yi(t){var i;return null!==(i=this.fu[t])&&void 0!==i?i:null}Aa(t,i){if(this.fu.length<1)return null;if(this.K_.key(t)>this.K_.key(this.fu[this.fu.length-1].time))return i?this.fu.length-1:null;const s=Rt(this.fu,this.K_.key(t),((t,i)=>this.K_.key(t.time)<i));return this.K_.key(t)<this.K_.key(this.fu[s].time)?i?s:null:s}Wi(){return 0===this.c_||0===this.fu.length||null===this.du}Ba(){return this.fu.length>0}Zn(){return this.Bu(),this.mu._u()}Au(){return this.Bu(),this.mu.uu()}Eu(){const t=this.Zn();if(null===t)return null;const i={from:t.An(),to:t.ci()};return this.Vu(i)}Vu(t){const i=Math.round(t.from),s=Math.round(t.to),n=v(this.Iu()),e=v(this.zu());return{from:v(this.Yi(Math.max(n,i))),to:v(this.Yi(Math.min(e,s)))}}Lu(t){return{from:v(this.Aa(t.from,!0)),to:v(this.Aa(t.to,!0))}}Ui(){return this.c_}C_(t){if(!isFinite(t)||t<=0)return;if(this.c_===t)return;const i=this.Au(),s=this.c_;if(this.c_=t,this.bu=!0,this.fs.lockVisibleTimeRangeOnResize&&0!==s){const i=this.Cu*t/s;this.Cu=i}if(this.fs.fixLeftEdge&&null!==i&&i.An()<=0){const i=s-t;this.yu-=Math.round(i/this.Cu)+1,this.bu=!0}this.Nu(),this.Fu()}It(t){if(this.Wi()||!R(t))return 0;const i=this.Wu()+this.yu-t;return this.c_-(i+.5)*this.Cu-1}te(t,i){const s=this.Wu(),n=void 0===i?0:i.from,e=void 0===i?t.length:i.to;for(let i=n;i<e;i++){const n=t[i].ot,e=s+this.yu-n,r=this.c_-(e+.5)*this.Cu-1;t[i].st=r}}ju(t){return Math.ceil(this.Hu(t))}sn(t){this.bu=!0,this.yu=t,this.Fu(),this.qi.$u(),this.qi.qh()}ae(){return this.Cu}tn(t){this.Uu(t),this.Fu(),this.qi.$u(),this.qi.qh()}qu(){return this.yu}$a(){if(this.Wi())return null;if(null!==this.Su)return this.Su;const t=this.Cu,i=5*(this.qi.W().layout.fontSize+4)/8*(this.fs.tickMarkMaxCharacterLength||8),s=Math.round(i/t),n=v(this.Zn()),e=Math.max(n.An(),n.An()-s),r=Math.max(n.ci(),n.ci()-s),h=this.vu.hu(t,i),l=this.Iu()+s,a=this.zu()-s,o=this.Yu(),_=this.fs.fixLeftEdge||o,u=this.fs.fixRightEdge||o;let c=0;for(const t of h){if(!(e<=t.index&&t.index<=r))continue;let s;c<this.ku.length?(s=this.ku[c],s.coord=this.It(t.index),s.label=this.Xu(t),s.weight=t.weight):(s={needAlignCoordinate:!1,coord:this.It(t.index),label:this.Xu(t),weight:t.weight},this.ku.push(s)),this.Cu>i/2&&!o?s.needAlignCoordinate=!1:s.needAlignCoordinate=_&&t.index<=l||u&&t.index>=a,c++}return this.ku.length=c,this.Su=this.ku,this.ku}Ku(){this.bu=!0,this.tn(this.fs.barSpacing),this.sn(this.fs.rightOffset)}Zu(t){this.bu=!0,this.du=t,this.Fu(),this.Du()}Gu(t,i){const s=this.Hu(t),n=this.ae(),e=n+i*(n/10);this.tn(e),this.fs.rightBarStaysOnScroll||this.sn(this.qu()+(s-this.Hu(t)))}Jo(t){this.xo&&this.n_(),null===this.Mo&&null===this.xu&&(this.Wi()||(this.Mo=t,this.Ju()))}Qo(t){if(null===this.xu)return;const i=gt(this.c_-t,0,this.c_),s=gt(this.c_-v(this.Mo),0,this.c_);0!==i&&0!==s&&this.tn(this.xu.ae*i/s)}t_(){null!==this.Mo&&(this.Mo=null,this.Qu())}i_(t){null===this.xo&&null===this.xu&&(this.Wi()||(this.xo=t,this.Ju()))}s_(t){if(null===this.xo)return;const i=(this.xo-t)/this.ae();this.yu=v(this.xu).qu+i,this.bu=!0,this.Fu()}n_(){null!==this.xo&&(this.xo=null,this.Qu())}tc(){this.sc(this.fs.rightOffset)}sc(t,i=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.yu,n=performance.now();this.qi.Gs({nc:t=>(t-n)/i>=1,ec:e=>{const r=(e-n)/i;return r>=1?t:s+(t-s)*r}})}bt(t,i){this.bu=!0,this.fu=t,this.vu.eu(t,i),this.Fu()}rc(){return this.wu}hc(){return this.gu}lc(){return this.Mu}Wu(){return this.du||0}ac(t){const i=t.tu();this.Uu(this.c_/i),this.yu=t.ci()-this.Wu(),this.Fu(),this.bu=!0,this.qi.$u(),this.qi.qh()}oc(){const t=this.Iu(),i=this.zu();null!==t&&null!==i&&this.ac(new bs(t,i+this.fs.rightOffset))}_c(t){const i=new bs(t.from,t.to);this.ac(i)}Xi(t){return void 0!==this.Co.timeFormatter?this.Co.timeFormatter(t.originalTime):this.K_.formatHorzItem(t.time)}Yu(){const{handleScroll:t,handleScale:i}=this.qi.W();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset.time||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}Iu(){return 0===this.fu.length?null:0}zu(){return 0===this.fu.length?null:this.fu.length-1}uc(t){return(this.c_-1-t)/this.Cu}Hu(t){const i=this.uc(t),s=this.Wu()+this.yu-i;return Math.round(1e6*s)/1e6}Uu(t){const i=this.Cu;this.Cu=t,this.Nu(),i!==this.Cu&&(this.bu=!0,this.cc())}Bu(){if(!this.bu)return;if(this.bu=!1,this.Wi())return void this.dc(Ms.cu());const t=this.Wu(),i=this.c_/this.Cu,s=this.yu+t,n=new bs(s-i+1,s);this.dc(new Ms(n))}Nu(){const t=this.fc();if(this.Cu<t&&(this.Cu=t,this.bu=!0),0!==this.c_){const t=.5*this.c_;this.Cu>t&&(this.Cu=t,this.bu=!0)}}fc(){return this.fs.fixLeftEdge&&this.fs.fixRightEdge&&0!==this.fu.length?this.c_/this.fu.length:this.fs.minBarSpacing}Fu(){const t=this.vc();this.yu>t&&(this.yu=t,this.bu=!0);const i=this.mc();null!==i&&this.yu<i&&(this.yu=i,this.bu=!0)}mc(){const t=this.Iu(),i=this.du;if(null===t||null===i)return null;return t-i-1+(this.fs.fixLeftEdge?this.c_/this.Cu:Math.min(2,this.fu.length))}vc(){return this.fs.fixRightEdge?0:this.c_/this.Cu-Math.min(2,this.fu.length)}Ju(){this.xu={ae:this.ae(),qu:this.qu()}}Qu(){this.xu=null}Xu(t){let i=this.pu.get(t.weight);return void 0===i&&(i=new ms((t=>this.bc(t)),this.K_),this.pu.set(t.weight,i)),i.Z_(t)}bc(t){return this.K_.formatTickmark(t,this.Co)}dc(t){const i=this.mu;this.mu=t,ws(i._u(),this.mu._u())||this.wu.m(),ws(i.uu(),this.mu.uu())||this.gu.m(),this.cc()}cc(){this.Su=null}Ru(){this.cc(),this.pu.clear()}Pu(){this.K_.updateFormatter(this.Co)}Du(){if(!this.fs.fixLeftEdge)return;const t=this.Iu();if(null===t)return;const i=this.Zn();if(null===i)return;const s=i.An()-t;if(s<0){const t=this.yu-s-1;this.sn(t)}this.Nu()}Ou(){this.Fu(),this.Nu()}}class ks{K(t,i,s){t.useMediaCoordinateSpace((t=>this.Z(t,i,s)))}Ml(t,i,s){t.useMediaCoordinateSpace((t=>this.wc(t,i,s)))}wc(t,i,s){}}class ys extends ks{constructor(t){super(),this.gc=new Map,this.zt=t}Z(t){}wc(t){if(!this.zt.Ct)return;const{context:i,mediaSize:s}=t;let n=0;for(const t of this.zt.Mc){if(0===t.Gt.length)continue;i.font=t.R;const e=this.xc(i,t.Gt);e>s.width?t.Gu=s.width/e:t.Gu=1,n+=t.Sc*t.Gu}let e=0;switch(this.zt.kc){case"top":e=0;break;case"center":e=Math.max((s.height-n)/2,0);break;case"bottom":e=Math.max(s.height-n,0)}i.fillStyle=this.zt.O;for(const t of this.zt.Mc){i.save();let n=0;switch(this.zt.yc){case"left":i.textAlign="left",n=t.Sc/2;break;case"center":i.textAlign="center",n=s.width/2;break;case"right":i.textAlign="right",n=s.width-1-t.Sc/2}i.translate(n,e),i.textBaseline="top",i.font=t.R,i.scale(t.Gu,t.Gu),i.fillText(t.Gt,0,t.Cc),i.restore(),e+=t.Sc*t.Gu}}xc(t,i){const s=this.Pc(t.font);let n=s.get(i);return void 0===n&&(n=t.measureText(i).width,s.set(i,n)),n}Pc(t){let i=this.gc.get(t);return void 0===i&&(i=new Map,this.gc.set(t,i)),i}}class Cs{constructor(t){this.Ri=!0,this.Wt={Ct:!1,O:"",Mc:[],kc:"center",yc:"center"},this.jt=new ys(this.Wt),this.Ht=t}bt(){this.Ri=!0}gt(){return this.Ri&&(this.Mt(),this.Ri=!1),this.jt}Mt(){const t=this.Ht.W(),i=this.Wt;i.Ct=t.visible,i.Ct&&(i.O=t.color,i.yc=t.horzAlign,i.kc=t.vertAlign,i.Mc=[{Gt:t.text,R:I(t.fontSize,t.fontFamily,t.fontStyle),Sc:1.2*t.fontSize,Cc:0,Gu:0}])}}class Ps extends nt{constructor(t,i){super(),this.fs=i,this.xs=new Cs(this)}Bs(){return[]}Os(){return[this.xs]}W(){return this.fs}Es(){this.xs.bt()}}var Ts,Rs,Ds,Os,Bs;exports.TrackingModeExitMode=void 0,(Ts=exports.TrackingModeExitMode||(exports.TrackingModeExitMode={}))[Ts.OnTouchEnd=0]="OnTouchEnd",Ts[Ts.OnNextTap=1]="OnNextTap";class As{constructor(t,i,s){this.Tc=[],this.Rc=new Map,this.Dc=[],this.c_=0,this.Oc=null,this.Bc=new C,this.Ac=new C,this.Ec=!1,this.Vc=null,this.Ic=t,this.fs=i,this.K_=s,this.zc=new z(this),this.Cl=new Ss(this,i.timeScale,this.fs.localization,s),this.vt=new rt(this,i.crosshair),this.Lc=new Xi(i.crosshair),this.Nc=new Ps(this,i.watermark),this.Fc(),this.Tc[0].k_(2e3),this.Wc=this.jc(0),this.Hc=this.jc(1)}Gl(){this.$c(lt.ln())}qh(){this.$c(lt.hn())}ua(){this.$c(new lt(1))}Ql(t){const i=this.Uc(t);this.$c(i)}qc(){return this.Oc}Yc(t){const i=this.Oc;this.Oc=t,null!==i&&this.Ql(i.Xc),null!==t&&this.Ql(t.Xc)}W(){return this.fs}Uh(t){P(this.fs,t),this.Tc.forEach(((i,s)=>{var n,e;const r=null===(e=null===(n=t.layout)||void 0===n?void 0:n.panes)||void 0===e?void 0:e[s];void 0!==r&&i.Uh(r),i.g_(t)})),void 0!==t.timeScale&&this.Cl.Uh(t.timeScale),void 0!==t.localization&&this.Cl.Tu(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Bc.m(),this.Wc=this.jc(0),this.Hc=this.jc(1),this.Gl()}Kc(t){var i;return null!==(i=this.Rc.get(t))&&void 0!==i?i:0}Zc(t,i){if("left"===t)return void this.Uh({leftPriceScale:i});if("right"===t)return void this.Uh({rightPriceScale:i});const s=this.Gc(t);null!==s&&(s.Ot.Uh(i),this.Bc.m())}Gc(t){for(const i of this.Tc){const s=i.M_(t);if(null!==s)return{Ut:i,Ot:s}}return null}kt(){return this.Cl}Jc(){return this.Tc}Qc(){return this.Nc}td(){return this.vt}sd(){return this.Ac}nd(t,i){t.Lo(i),this.$u()}C_(t){this.c_=t,this.Cl.C_(this.c_),this.Tc.forEach((i=>i.C_(t))),this.$u()}Fc(t){if(void 0!==t)if(t>this.Tc.length)for(let i=this.Tc.length;i<t;i++)this.Fc(i);else if(t<this.Tc.length)return this.Tc[t];const i=void 0===t?this.Tc.length-1+1:t,s=new ps(this.Cl,this,i);void 0!==t?this.Tc.splice(t,0,s):this.Tc.push(s),this.ed();const n=lt.ln();return n.js(i,{Hs:0,$s:!0}),this.$c(n),s}rd(t){if(0===t)return;if(this.Tc[t].qo().forEach((t=>{t instanceof Yi&&this.hd(t)})),this.Ec=!0,t!==this.Tc.length-1)for(let i=t+1;i<this.Tc.length;i++){this.Tc[i].qo().forEach((t=>{t instanceof Yi&&t.Uh({pane:i-1})}))}this.Tc.splice(t,1),this.Ec=!1,this.ed();const i=new lt(3);this.$c(i)}ld(t,i){const s=this.Tc[t],n=this.Tc[i];this.Ec=!0,s.qo().forEach((t=>{t instanceof Yi&&t.Uh({pane:i})})),n.qo().forEach((i=>{i instanceof Yi&&i.Uh({pane:t})})),this.Tc[t]=n,this.Tc[i]=s,this.Ec=!1,this.ed(),this.$c(new lt(3))}E_(t,i,s){t.E_(i,s)}V_(t,i,s){t.V_(i,s),this.ta(),this.$c(this.ad(t,2))}I_(t,i){t.I_(i),this.$c(this.ad(t,2))}z_(t,i,s){i.Bo()||t.z_(i,s)}L_(t,i,s){i.Bo()||(t.L_(i,s),this.ta(),this.$c(this.ad(t,2)))}N_(t,i){i.Bo()||(t.N_(i),this.$c(this.ad(t,2)))}W_(t,i){t.W_(i),this.$c(this.ad(t,2))}od(t){this.Cl.Jo(t)}_d(t,i){const s=this.kt();if(s.Wi()||0===i)return;const n=s.Ui();t=Math.max(1,Math.min(t,n)),s.Gu(t,i),this.$u()}ud(t){this.dd(0),this.fd(t),this.vd()}pd(t){this.Cl.Qo(t),this.$u()}md(){this.Cl.t_(),this.qh()}dd(t){this.Cl.i_(t)}fd(t){this.Cl.s_(t),this.$u()}vd(){this.Cl.n_(),this.qh()}wt(){return this.Dc}bd(t,i,s,n,e){this.vt.Ss(t,i);let r=NaN,h=this.Cl.ju(t);const l=this.Cl.Zn();null!==l&&(h=Math.min(Math.max(l.An(),h),l.ci()));const a=n.bs(),o=a.Pt();null!==o&&(r=a.ws(i,o)),r=this.Lc.Ea(r,h,n),this.vt.Ps(h,r,n),this.ua(),e||this.Ac.m(this.vt.St(),{x:t,y:i},s)}wd(t,i,s){const n=s.bs(),e=n.Pt(),r=n.Dt(t,v(e)),h=this.Cl.Aa(i,!0),l=this.Cl.It(v(h));this.bd(l,r,null,s,!0)}gd(t){this.td().Rs(),this.ua(),t||this.Ac.m(null,null,null)}ta(){const t=this.vt.Ut();if(null!==t){const i=this.vt.ys(),s=this.vt.Cs();this.bd(i,s,null,t)}this.vt.Es()}Md(t,i,s){const n=this.Cl.gs(0);void 0!==i&&void 0!==s&&this.Cl.bt(i,s);const e=this.Cl.gs(0),r=this.Cl.Wu(),h=this.Cl.Zn();if(null!==h&&null!==n&&null!==e){const i=h.Gr(r),l=this.K_.key(n)>this.K_.key(e),a=null!==t&&t>r&&!l,o=this.Cl.W().allowShiftVisibleRangeOnWhitespaceReplacement,_=i&&(!(void 0===s)||o)&&this.Cl.W().shiftVisibleRangeOnNewBar;if(a&&!_){const i=t-r;this.Cl.sn(this.Cl.qu()-i)}}this.Cl.Zu(t)}na(t){null!==t&&t.H_()}vr(t){const i=this.Tc.find((i=>i.qo().includes(t)));return void 0===i?null:i}$u(){this.Nc.Es(),this.Tc.forEach((t=>t.H_())),this.ta()}S(){this.Tc.forEach((t=>t.S())),this.Tc.length=0,this.fs.localization.priceFormatter=void 0,this.fs.localization.percentageFormatter=void 0,this.fs.localization.timeFormatter=void 0}xd(){return this.zc}wr(){return this.zc.W()}x_(){return this.Bc}Sd(t,i,s){const n=i.pane||0;this.Tc.length-1<=n&&this.Fc(n);const e=this.Tc[n],r=this.kd(i,t,e,s);return this.Dc.push(r),1===this.Dc.length?this.Gl():this.qh(),r}hd(t){const i=this.vr(t),s=this.Dc.indexOf(t);d(-1!==s,"Series not found"),this.Dc.splice(s,1),v(i).Ko(t),t.S&&t.S()}Zl(t,i){const s=v(this.vr(t));s.Ko(t);const n=this.Gc(i);if(null===n){const n=t.Gi();s.Yo(t,i,null===n?void 0:n)}else{const e=n.Ut===s?t.Gi():void 0;n.Ut.Yo(t,i,null===e?void 0:e)}}Jl(t,i,s){if(s===i||this.Ec)return;t.W().pane!==s&&t.Uh({pane:s});const n=this.vr(t);null==n||n.Ko(t);const e=this.Fc(s);this.yd(t,e)}oc(){const t=lt.hn();t.Ys(),this.$c(t)}Cd(t){const i=lt.hn();i.Zs(t),this.$c(i)}Qs(){const t=lt.hn();t.Qs(),this.$c(t)}tn(t){const i=lt.hn();i.tn(t),this.$c(i)}sn(t){const i=lt.hn();i.sn(t),this.$c(i)}Gs(t){const i=lt.hn();i.Gs(t),this.$c(i)}Xs(){const t=lt.hn();t.Xs(),this.$c(t)}Pd(){return this.fs.rightPriceScale.visible?"right":"left"}Td(){return this.Hc}q(){return this.Wc}Et(t){const i=this.Hc,s=this.Wc;if(i===s)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.Vc||this.Vc.Rn!==s||this.Vc.Dn!==i)this.Vc={Rn:s,Dn:i,Rd:new Map};else{const i=this.Vc.Rd.get(t);if(void 0!==i)return i}const n=function(t,i,s){const[n,e,r,h]=k(t),[l,a,o,_]=k(i),u=[b(n+s*(l-n)),b(e+s*(a-e)),b(r+s*(o-r)),w(h+s*(_-h))];return`rgba(${u[0]}, ${u[1]}, ${u[2]}, ${u[3]})`}(s,i,t/100);return this.Vc.Rd.set(t,n),n}ad(t,i){const s=new lt(i);if(null!==t){const n=this.Tc.indexOf(t);s.js(n,{Hs:i})}return s}Uc(t,i){return void 0===i&&(i=2),this.ad(this.vr(t),i)}$c(t){this.Ic&&this.Ic(t),this.Tc.forEach((t=>{t.q_().Yh().bt()}))}kd(t,i,s,n){const e=new Yi(this,t,i,s,n);return this.yd(e,s),e}yd(t,i){const s=t.W().priceScaleId,n=void 0!==s?s:this.Pd();i.Yo(t,n),ht(n)||t.Uh(t.W())}jc(t){const i=this.fs.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color}ed(){this.Rc.clear();for(let t=0;t<this.Tc.length;t++)this.Rc.set(this.Tc[t],t)}}function Es(t){return!T(t)&&!D(t)}function Vs(t){return T(t)}exports.LastPriceAnimationMode=void 0,(Rs=exports.LastPriceAnimationMode||(exports.LastPriceAnimationMode={}))[Rs.Disabled=0]="Disabled",Rs[Rs.Continuous=1]="Continuous",Rs[Rs.OnDataUpdate=2]="OnDataUpdate",exports.PriceLineSource=void 0,(Ds=exports.PriceLineSource||(exports.PriceLineSource={}))[Ds.LastBar=0]="LastBar",Ds[Ds.LastVisible=1]="LastVisible",exports.ColorType=void 0,(Os=exports.ColorType||(exports.ColorType={})).Solid="solid",Os.VerticalGradient="gradient",exports.TickMarkType=void 0,(Bs=exports.TickMarkType||(exports.TickMarkType={}))[Bs.Year=0]="Year",Bs[Bs.Month=1]="Month",Bs[Bs.DayOfMonth=2]="DayOfMonth",Bs[Bs.Time=3]="Time",Bs[Bs.TimeWithSeconds=4]="TimeWithSeconds";const Is=t=>t.getUTCFullYear();function zs(t,i,s){return i.replace(/yyyy/g,(t=>ot(Is(t),4))(t)).replace(/yy/g,(t=>ot(Is(t)%100,2))(t)).replace(/MMMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"}))(t,s)).replace(/MMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"}))(t,s)).replace(/MM/g,(t=>ot((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>ot((t=>t.getUTCDate())(t),2))(t))}class Ls{constructor(t="yyyy-MM-dd",i="default"){this.Dd=t,this.Od=i}Z_(t){return zs(t,this.Dd,this.Od)}}class Ns{constructor(t){this.Bd=t||"%h:%m:%s"}Z_(t){return this.Bd.replace("%h",ot(t.getUTCHours(),2)).replace("%m",ot(t.getUTCMinutes(),2)).replace("%s",ot(t.getUTCSeconds(),2))}}const Fs={Ad:"yyyy-MM-dd",Ed:"%h:%m:%s",Vd:" ",Id:"default"};class Ws{constructor(t={}){const i=Object.assign(Object.assign({},Fs),t);this.zd=new Ls(i.Ad,i.Id),this.Ld=new Ns(i.Ed),this.Nd=i.Vd}Z_(t){return`${this.zd.Z_(t)}${this.Nd}${this.Ld.Z_(t)}`}}function js(t){return 60*t*60*1e3}function Hs(t){return 60*t*1e3}const $s=[{Fd:(Us=1,1e3*Us),Wd:10},{Fd:Hs(1),Wd:20},{Fd:Hs(5),Wd:21},{Fd:Hs(30),Wd:22},{Fd:js(1),Wd:30},{Fd:js(3),Wd:31},{Fd:js(6),Wd:32},{Fd:js(12),Wd:33}];var Us;function qs(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(let s=$s.length-1;s>=0;--s)if(Math.floor(i.getTime()/$s[s].Fd)!==Math.floor(t.getTime()/$s[s].Fd))return $s[s].Wd;return 0}function Ys(t){let i=t;if(D(t)&&(i=Ks(t)),!Es(i))throw new Error("time must be of type BusinessDay");const s=new Date(Date.UTC(i.year,i.month-1,i.day,0,0,0,0));return{jd:Math.round(s.getTime()/1e3),Hd:i}}function Xs(t){if(!Vs(t))throw new Error("time must be of type isUTCTimestamp");return{jd:t}}function Ks(t){const i=new Date(t);if(isNaN(i.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function Zs(t){D(t.time)&&(t.time=Ks(t.time))}class Gs{options(){return this.fs}setOptions(t){this.fs=t,this.updateFormatter(t.localization)}preprocessData(t){Array.isArray(t)?function(t){t.forEach(Zs)}(t):Zs(t)}createConverterToInternalObj(t){return v(function(t){return 0===t.length?null:Es(t[0].time)||D(t[0].time)?Ys:Xs}(t))}key(t){return"object"==typeof t&&"jd"in t?t.jd:this.key(this.convertHorzItemToInternal(t))}cacheKey(t){const i=t;return void 0===i.Hd?new Date(1e3*i.jd).getTime():new Date(Date.UTC(i.Hd.year,i.Hd.month-1,i.Hd.day)).getTime()}convertHorzItemToInternal(t){return Vs(i=t)?Xs(i):Es(i)?Ys(i):Ys(Ks(i));var i}updateFormatter(t){if(!this.fs)return;const i=t.dateFormat;this.fs.timeScale.timeVisible?this.$d=new Ws({Ad:i,Ed:this.fs.timeScale.secondsVisible?"%h:%m:%s":"%h:%m",Vd:"   ",Id:t.locale}):this.$d=new Ls(i,t.locale)}formatHorzItem(t){const i=t;return this.$d.Z_(new Date(1e3*i.jd))}formatTickmark(t,i){const s=function(t,i,s){switch(t){case 0:case 10:return i?s?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.weight,this.fs.timeScale.timeVisible,this.fs.timeScale.secondsVisible),n=this.fs.timeScale;if(void 0!==n.tickMarkFormatter){const e=n.tickMarkFormatter(t.originalTime,s,i.locale);if(null!==e)return e}return function(t,i,s){const n={};switch(i){case 0:n.year="numeric";break;case 1:n.month="short";break;case 2:n.day="numeric";break;case 3:n.hour12=!1,n.hour="2-digit",n.minute="2-digit";break;case 4:n.hour12=!1,n.hour="2-digit",n.minute="2-digit",n.second="2-digit"}const e=void 0===t.Hd?new Date(1e3*t.jd):new Date(Date.UTC(t.Hd.year,t.Hd.month-1,t.Hd.day));return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()).toLocaleString(s,n)}(t.time,s,i.locale)}maxTickMarkWeight(t){let i=t.reduce(xs,t[0]).weight;return i>30&&i<50&&(i=30),i}fillWeightsForPoints(t,i){!function(t,i=0){if(0===t.length)return;let s=0===i?null:t[i-1].time.jd,n=null!==s?new Date(1e3*s):null,e=0;for(let r=i;r<t.length;++r){const i=t[r],h=new Date(1e3*i.time.jd);null!==n&&(i.timeWeight=qs(h,n)),e+=i.time.jd-(s||i.time.jd),s=i.time.jd,n=h}if(0===i&&t.length>1){const i=Math.ceil(e/(t.length-1)),s=new Date(1e3*(t[0].time.jd-i));t[0].timeWeight=qs(new Date(1e3*t[0].time.jd),s)}}(t,i)}static Ud(t){return P({localization:{dateFormat:"dd MMM 'yy"}},null!=t?t:{})}}const Js="undefined"!=typeof window;function Qs(){return!!Js&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function tn(){return!!Js&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function sn(t){return t+t%2}function nn(t){Js&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1}))}class en{constructor(t,i,s){this.qd=0,this.Yd=null,this.Xd={st:Number.NEGATIVE_INFINITY,nt:Number.POSITIVE_INFINITY},this.Kd=0,this.Zd=null,this.Gd={st:Number.NEGATIVE_INFINITY,nt:Number.POSITIVE_INFINITY},this.Jd=null,this.Qd=!1,this.tf=null,this.if=null,this.sf=!1,this.nf=!1,this.ef=!1,this.rf=null,this.hf=null,this.lf=null,this.af=null,this._f=null,this.uf=null,this.cf=null,this.df=0,this.ff=!1,this.vf=!1,this.pf=!1,this.mf=0,this.bf=null,this.wf=!tn(),this.gf=t=>{this.Mf(t)},this.xf=t=>{if(this.Sf(t)){const i=this.kf(t);if(++this.Kd,this.Zd&&this.Kd>1){const{yf:s}=this.Cf(ln(t),this.Gd);s<30&&!this.ef&&this.Pf(i,this.Rf.Tf),this.Df()}}else{const i=this.kf(t);if(++this.qd,this.Yd&&this.qd>1){const{yf:s}=this.Cf(ln(t),this.Xd);s<5&&!this.nf&&this.Of(i,this.Rf.Bf),this.Af()}}},this.Ef=t,this.Rf=i,this.fs=s,this.Vf()}S(){null!==this.rf&&(this.rf(),this.rf=null),null!==this.hf&&(this.hf(),this.hf=null),null!==this.af&&(this.af(),this.af=null),null!==this._f&&(this._f(),this._f=null),null!==this.uf&&(this.uf(),this.uf=null),null!==this.lf&&(this.lf(),this.lf=null),this.If(),this.Af()}zf(t){this.af&&this.af();const i=this.Lf.bind(this);if(this.af=()=>{this.Ef.removeEventListener("mousemove",i)},this.Ef.addEventListener("mousemove",i),this.Sf(t))return;const s=this.kf(t);this.Of(s,this.Rf.Nf),this.wf=!0}Af(){null!==this.Yd&&clearTimeout(this.Yd),this.qd=0,this.Yd=null,this.Xd={st:Number.NEGATIVE_INFINITY,nt:Number.POSITIVE_INFINITY}}Df(){null!==this.Zd&&clearTimeout(this.Zd),this.Kd=0,this.Zd=null,this.Gd={st:Number.NEGATIVE_INFINITY,nt:Number.POSITIVE_INFINITY}}Lf(t){if(this.pf||null!==this.if)return;if(this.Sf(t))return;const i=this.kf(t);this.Of(i,this.Rf.Ff),this.wf=!0}Wf(t){const i=on(t.changedTouches,v(this.bf));if(null===i)return;if(this.mf=an(t),null!==this.cf)return;if(this.vf)return;this.ff=!0;const s=this.Cf(ln(i),v(this.if)),{jf:n,Hf:e,yf:r}=s;if(this.sf||!(r<5)){if(!this.sf){const t=.5*n,i=e>=t&&!this.fs.$f(),s=t>e&&!this.fs.Uf();i||s||(this.vf=!0),this.sf=!0,this.ef=!0,this.If(),this.Df()}if(!this.vf){const s=this.kf(t,i);this.Pf(s,this.Rf.qf),hn(t)}}}Yf(t){if(0!==t.button)return;const i=this.Cf(ln(t),v(this.tf)),{yf:s}=i;if(s>=5&&(this.nf=!0,this.Af()),this.nf){const i=this.kf(t);this.Of(i,this.Rf.Xf)}}Cf(t,i){const s=Math.abs(i.st-t.st),n=Math.abs(i.nt-t.nt);return{jf:s,Hf:n,yf:s+n}}Kf(t){let i=on(t.changedTouches,v(this.bf));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null===i)return;this.bf=null,this.mf=an(t),this.If(),this.if=null,this.uf&&(this.uf(),this.uf=null);const s=this.kf(t,i);if(this.Pf(s,this.Rf.Zf),++this.Kd,this.Zd&&this.Kd>1){const{yf:t}=this.Cf(ln(i),this.Gd);t<30&&!this.ef&&this.Pf(s,this.Rf.Tf),this.Df()}else this.ef||(this.Pf(s,this.Rf.Gf),this.Rf.Gf&&hn(t));0===this.Kd&&hn(t),0===t.touches.length&&this.Qd&&(this.Qd=!1,hn(t))}Mf(t){if(0!==t.button)return;const i=this.kf(t);if(this.tf=null,this.pf=!1,this._f&&(this._f(),this._f=null),Qs()){this.Ef.ownerDocument.documentElement.removeEventListener("mouseleave",this.gf)}if(!this.Sf(t))if(this.Of(i,this.Rf.Jf),++this.qd,this.Yd&&this.qd>1){const{yf:s}=this.Cf(ln(t),this.Xd);s<5&&!this.nf&&this.Of(i,this.Rf.Bf),this.Af()}else this.nf||this.Of(i,this.Rf.Qf)}If(){null!==this.Jd&&(clearTimeout(this.Jd),this.Jd=null)}tv(t){if(null!==this.bf)return;const i=t.changedTouches[0];this.bf=i.identifier,this.mf=an(t);const s=this.Ef.ownerDocument.documentElement;this.ef=!1,this.sf=!1,this.vf=!1,this.if=ln(i),this.uf&&(this.uf(),this.uf=null);{const i=this.Wf.bind(this),n=this.Kf.bind(this);this.uf=()=>{s.removeEventListener("touchmove",i),s.removeEventListener("touchend",n)},s.addEventListener("touchmove",i,{passive:!1}),s.addEventListener("touchend",n,{passive:!1}),this.If(),this.Jd=setTimeout(this.iv.bind(this,t),240)}const n=this.kf(t,i);this.Pf(n,this.Rf.sv),this.Zd||(this.Kd=0,this.Zd=setTimeout(this.Df.bind(this),500),this.Gd=ln(i))}nv(t){if(0!==t.button)return;const i=this.Ef.ownerDocument.documentElement;Qs()&&i.addEventListener("mouseleave",this.gf),this.nf=!1,this.tf=ln(t),this._f&&(this._f(),this._f=null);{const t=this.Yf.bind(this),s=this.Mf.bind(this);this._f=()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",s)},i.addEventListener("mousemove",t),i.addEventListener("mouseup",s)}if(this.pf=!0,this.Sf(t))return;const s=this.kf(t);this.Of(s,this.Rf.ev),this.Yd||(this.qd=0,this.Yd=setTimeout(this.Af.bind(this),500),this.Xd=ln(t))}Vf(){this.Ef.addEventListener("mouseenter",this.zf.bind(this)),this.Ef.addEventListener("touchcancel",this.If.bind(this));{const t=this.Ef.ownerDocument,i=t=>{this.Rf.rv&&(t.composed&&this.Ef.contains(t.composedPath()[0])||t.target&&this.Ef.contains(t.target)||this.Rf.rv())};this.hf=()=>{t.removeEventListener("touchstart",i)},this.rf=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}tn()&&(this.lf=()=>{this.Ef.removeEventListener("dblclick",this.xf)},this.Ef.addEventListener("dblclick",this.xf)),this.Ef.addEventListener("mouseleave",this.hv.bind(this)),this.Ef.addEventListener("touchstart",this.tv.bind(this),{passive:!0}),nn(this.Ef),this.Ef.addEventListener("mousedown",this.nv.bind(this)),this.lv(),this.Ef.addEventListener("touchmove",(()=>{}),{passive:!1})}lv(){void 0===this.Rf.av&&void 0===this.Rf.ov&&void 0===this.Rf._v||(this.Ef.addEventListener("touchstart",(t=>this.uv(t.touches)),{passive:!0}),this.Ef.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this.cf&&void 0!==this.Rf.ov){const i=rn(t.touches[0],t.touches[1])/this.df;this.Rf.ov(this.cf,i),hn(t)}}),{passive:!1}),this.Ef.addEventListener("touchend",(t=>{this.uv(t.touches)})))}uv(t){1===t.length&&(this.ff=!1),2!==t.length||this.ff||this.Qd?this.cv():this.dv(t)}dv(t){const i=this.Ef.getBoundingClientRect()||{left:0,top:0};this.cf={st:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,nt:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.df=rn(t[0],t[1]),void 0!==this.Rf.av&&this.Rf.av(),this.If()}cv(){null!==this.cf&&(this.cf=null,void 0!==this.Rf._v&&this.Rf._v())}hv(t){if(this.af&&this.af(),this.Sf(t))return;if(!this.wf)return;const i=this.kf(t);this.Of(i,this.Rf.fv),this.wf=!tn()}iv(t){const i=on(t.touches,v(this.bf));if(null===i)return;const s=this.kf(t,i);this.Pf(s,this.Rf.vv),this.ef=!0,this.Qd=!0}Sf(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:an(t)<this.mf+500}Pf(t,i){i&&i.call(this.Rf,t)}Of(t,i){i&&i.call(this.Rf,t)}kf(t,i){const s=i||t,n=this.Ef.getBoundingClientRect()||{left:0,top:0};return{clientX:s.clientX,clientY:s.clientY,pageX:s.pageX,pageY:s.pageY,screenX:s.screenX,screenY:s.screenY,localX:s.clientX-n.left,localY:s.clientY-n.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,pv:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,mv:t.type,bv:s.target,wv:t.view,gv:()=>{"touchstart"!==t.type&&hn(t)}}}}function rn(t,i){const s=t.clientX-i.clientX,n=t.clientY-i.clientY;return Math.sqrt(s*s+n*n)}function hn(t){t.cancelable&&t.preventDefault()}function ln(t){return{st:t.pageX,nt:t.pageY}}function an(t){return t.timeStamp||performance.now()}function on(t,i){for(let s=0;s<t.length;++s)if(t[s].identifier===i)return t[s];return null}class _n{constructor(t,i,s,n){if(this.Mv=0,this.xv=0,this.Sv=0,this.kv=0,this.yv=0,this.Cv=0,this.Pv=0,this.Tv=!1,this.Rv="lwc-separator-handle",this.Dv="lwc-separator-handle--active",this.Ov=t,this.Bv=t.Av()[i],this.Ev=t.Av()[s],this.Vv=document.createElement("tr"),this.Vv.style.height="1px",this.Iv=document.createElement("td"),this.Iv.style.position="relative",this.Iv.style.padding="0",this.Iv.style.margin="0",this.Iv.setAttribute("colspan","3"),this.zv(),this.Vv.appendChild(this.Iv),n)this.Lv=null,this.Nv=null;else{this.Lv=document.createElement("div"),this.Lv.classList.add(this.Rv),this.Lv.style.position="absolute",this.Lv.style.zIndex="50",this.Lv.style.top="-4px",this.Lv.style.height="9px",this.Lv.style.width="100%",this.Lv.style.backgroundColor="",this.Lv.style.cursor="row-resize",this.Iv.appendChild(this.Lv);const t={Nf:this.Fv.bind(this),fv:this.Wv.bind(this),ev:this.jv.bind(this),sv:this.jv.bind(this),Xf:this.Hv.bind(this),qf:this.Hv.bind(this),Jf:this.$v.bind(this),Zf:this.$v.bind(this)};this.Nv=new en(this.Lv,t,{$f:()=>!1,Uf:()=>!0})}}S(){null!==this.Nv&&this.Nv.S()}Uv(){return this.Vv}qv(){return t.size({width:this.Bv.qv().width,height:1})}Yv(){return t.size({width:this.Bv.Yv().width,height:1*window.devicePixelRatio})}Xv(t,i,s){const n=this.Yv();t.fillStyle=this.Ov.W().timeScale.borderColor,t.fillRect(i,s,n.width,n.height)}bt(){this.zv()}zv(){this.Iv.style.background=this.Ov.W().timeScale.borderColor}Fv(t){null!==this.Lv&&(this.Lv.style.backgroundColor="hsla(225,8%,72%,.2)")}Wv(t){null===this.Lv||this.Tv||(this.Lv.style.backgroundColor="")}jv(t){var i;this.Mv=t.pageY,this.xv=0,this.Sv=this.Bv.qv().height+this.Ev.qv().height,this.kv=this.Bv.S_()+this.Ev.S_();const s=this.Bv.Kv().y_(),n=this.Ev.Kv().y_();this.yv=s,this.Cv=this.Sv-n,this.Pv=this.kv/this.Sv,this.Tv=!0,null===(i=this.Lv)||void 0===i||i.classList.add(this.Dv)}Hv(t){this.xv=t.pageY-this.Mv;const i=this.Bv.qv().height,s=gt(i+this.xv,this.yv,this.Cv)*this.Pv,n=this.kv-s;this.Bv.k_(s),this.Ev.k_(n),this.Ov.Zv(),this.Ov.$t().Gl(),this.Bv.qv().height!==i&&(this.Mv=t.pageY),this.Ov.$t().Gl()}$v(t){var i;this.Mv=0,this.xv=0,this.Sv=0,this.kv=0,this.yv=0,this.Cv=0,this.Pv=0,this.Tv=!1,null===(i=this.Lv)||void 0===i||i.classList.remove(this.Dv),this.Wv(t)}}function un(t,i){return t.Gv-i.Gv}function cn(t,i,s){const n=(t.Gv-i.Gv)/(t.ot-i.ot);return Math.sign(n)*Math.min(Math.abs(n),s)}class dn{constructor(t,i,s,n){this.Jv=null,this.Qv=null,this.tp=null,this.ip=null,this.sp=null,this.np=0,this.ep=0,this.rp=t,this.hp=i,this.lp=s,this.an=n}ap(t,i){if(null!==this.Jv){if(this.Jv.ot===i)return void(this.Jv.Gv=t);if(Math.abs(this.Jv.Gv-t)<this.an)return}this.ip=this.tp,this.tp=this.Qv,this.Qv=this.Jv,this.Jv={ot:i,Gv:t}}Br(t,i){if(null===this.Jv||null===this.Qv)return;if(i-this.Jv.ot>50)return;let s=0;const n=cn(this.Jv,this.Qv,this.hp),e=un(this.Jv,this.Qv),r=[n],h=[e];if(s+=e,null!==this.tp){const t=cn(this.Qv,this.tp,this.hp);if(Math.sign(t)===Math.sign(n)){const i=un(this.Qv,this.tp);if(r.push(t),h.push(i),s+=i,null!==this.ip){const t=cn(this.tp,this.ip,this.hp);if(Math.sign(t)===Math.sign(n)){const i=un(this.tp,this.ip);r.push(t),h.push(i),s+=i}}}}let l=0;for(let t=0;t<r.length;++t)l+=h[t]/s*r[t];Math.abs(l)<this.rp||(this.sp={Gv:t,ot:i},this.ep=l,this.np=function(t,i){const s=Math.log(i);return Math.log(1*s/-t)/s}(Math.abs(l),this.lp))}ec(t){const i=v(this.sp),s=t-i.ot;return i.Gv+this.ep*(Math.pow(this.lp,s)-1)/Math.log(this.lp)}nc(t){return null===this.sp||this.op(t)===this.np}op(t){const i=t-v(this.sp).ot;return Math.min(i,this.np)}}function fn(i,s){const n=v(i.ownerDocument).createElement("canvas");i.appendChild(n);const e=t.bindCanvasElementBitmapSizeTo(n,{type:"device-pixel-content-box",options:{allowResizeObserver:!1},transform:(t,i)=>({width:Math.max(t.width,i.width),height:Math.max(t.height,i.height)})});return e.resizeCanvasElement(s),e}function vn(t){var i;t.width=1,t.height=1,null===(i=t.getContext("2d"))||void 0===i||i.clearRect(0,0,1,1)}function pn(t,i,s,n){t.Ml&&t.Ml(i,s,n)}function mn(t,i,s,n){t.K(i,s,n)}function bn(t,i,s,n){const e=t(s,n);for(const t of e){const s=t.gt(n);null!==s&&i(s)}}function wn(t){return{Xc:t.Xc,_p:{Mr:t.up.externalId},cp:t.up.cursorStyle}}function gn(t,i,s,n){for(const e of i){const i=e.gt(t);if(null!==i&&i.gr){const t=i.gr(s,n);if(null!==t)return{wv:e,_p:t}}}return null}function Mn(t,i){return s=>{var n,e,r,h;return(null!==(e=null===(n=s.Ot())||void 0===n?void 0:n.ba())&&void 0!==e?e:"")!==i?[]:null!==(h=null===(r=s.va)||void 0===r?void 0:r.call(s,t))&&void 0!==h?h:[]}}function xn(t,i,s,n){if(!t.length)return;let e=0;const r=t[0].Vt(n,!0);let h=1===i?s/2-(t[0].Ai()-r/2):t[0].Ai()-r/2-s/2;h=Math.max(0,h);for(let r=1;r<t.length;r++){const l=t[r],a=t[r-1],o=a.Vt(n,!1),_=l.Ai(),u=a.Ai();if(1===i?_>u-o:_<u+o){const n=u-o*i;l.Ei(n);const r=n-i*o/2;if((1===i?r<0:r>s)&&h>0){const n=1===i?-1-r:r-s,l=Math.min(n,h);for(let s=e;s<t.length;s++)t[s].Ei(t[s].Ai()+i*l);h-=l}}else e=r,h=1===i?u-o-_:_-(u+o)}}class Sn{constructor(i,s,n,e){this.Ni=null,this.dp=null,this.fp=!1,this.vp=new Jt(200),this.th=null,this.pp=0,this.mp=!1,this.bp=()=>{this.mp||this.ns.wp().$t().qh()},this.gp=()=>{this.mp||this.ns.wp().$t().qh()},this.ns=i,this.fs=s,this.yo=s.layout,this.zc=n,this.Mp="left"===e,this.xp=Mn("normal",e),this.Sp=Mn("top",e),this.kp=Mn("bottom",e),this.Iv=document.createElement("div"),this.Iv.style.height="100%",this.Iv.style.overflow="hidden",this.Iv.style.width="25px",this.Iv.style.left="0",this.Iv.style.position="relative",this.yp=fn(this.Iv,t.size({width:16,height:16})),this.yp.subscribeSuggestedBitmapSizeChanged(this.bp);const r=this.yp.canvasElement;r.style.position="absolute",r.style.zIndex="1",r.style.left="0",r.style.top="0",this.Cp=fn(this.Iv,t.size({width:16,height:16})),this.Cp.subscribeSuggestedBitmapSizeChanged(this.gp);const h=this.Cp.canvasElement;h.style.position="absolute",h.style.zIndex="2",h.style.left="0",h.style.top="0";const l={ev:this.jv.bind(this),sv:this.jv.bind(this),Xf:this.Hv.bind(this),qf:this.Hv.bind(this),rv:this.Pp.bind(this),Jf:this.$v.bind(this),Zf:this.$v.bind(this),Bf:this.Tp.bind(this),Tf:this.Tp.bind(this),Nf:this.Rp.bind(this),fv:this.Wv.bind(this)};this.Nv=new en(this.Cp.canvasElement,l,{$f:()=>!this.fs.handleScroll.vertTouchDrag,Uf:()=>!0})}S(){this.Nv.S(),this.Cp.unsubscribeSuggestedBitmapSizeChanged(this.gp),vn(this.Cp.canvasElement),this.Cp.dispose(),this.yp.unsubscribeSuggestedBitmapSizeChanged(this.bp),vn(this.yp.canvasElement),this.yp.dispose(),null!==this.Ni&&this.Ni.Go().p(this),this.Ni=null}Uv(){return this.Iv}T(){return this.yo.fontSize}Dp(){const t=this.zc.W();return this.th!==t.R&&(this.vp.nr(),this.th=t.R),t}Op(){if(null===this.Ni)return 0;let t=0;const i=this.Dp(),s=v(this.yp.canvasElement.getContext("2d"));s.save();const n=this.Ni.$a();s.font=this.Bp(),n.length>0&&(t=Math.max(this.vp.Si(s,n[0].eo),this.vp.Si(s,n[n.length-1].eo)));const e=this.Ap();for(let i=e.length;i--;){const n=this.vp.Si(s,e[i].Gt());n>t&&(t=n)}const r=this.Ni.Pt();if(null!==r&&null!==this.dp){const i=this.Ni.ws(1,r),n=this.Ni.ws(this.dp.height-2,r);t=Math.max(t,this.vp.Si(s,this.Ni.ji(Math.floor(Math.min(i,n))+.11111111111111,r)),this.vp.Si(s,this.Ni.ji(Math.ceil(Math.max(i,n))-.11111111111111,r)))}s.restore();const h=t||34;return sn(Math.ceil(i.C+i.P+i.V+i.I+5+h))}Ep(i){null!==this.dp&&t.equalSizes(this.dp,i)||(this.dp=i,this.mp=!0,this.yp.resizeCanvasElement(i),this.Cp.resizeCanvasElement(i),this.mp=!1,this.Iv.style.width=`${i.width}px`,this.Iv.style.height=`${i.height}px`)}Vp(){return v(this.dp).width}Qi(t){this.Ni!==t&&(null!==this.Ni&&this.Ni.Go().p(this),this.Ni=t,t.Go().l(this.vo.bind(this),this))}Ot(){return this.Ni}nr(){const t=this.ns.Kv();this.ns.wp().$t().W_(t,v(this.Ot()))}Ip(i){if(null===this.dp)return;if(1!==i){this.zp(),this.yp.applySuggestedBitmapSize();const i=t.tryCreateCanvasRenderingTarget2D(this.yp);null!==i&&(i.useBitmapCoordinateSpace((t=>{this.Lp(t),this.Ie(t)})),this.ns.Np(i,this.kp),this.Fp(i),this.ns.Np(i,this.xp),this.Wp(i))}this.Cp.applySuggestedBitmapSize();const s=t.tryCreateCanvasRenderingTarget2D(this.Cp);null!==s&&(s.useBitmapCoordinateSpace((({context:t,bitmapSize:i})=>{t.clearRect(0,0,i.width,i.height)})),this.jp(s),this.ns.Np(s,this.Sp))}Yv(){return this.yp.bitmapSize}Xv(t,i,s){const n=this.Yv();n.width>0&&n.height>0&&t.drawImage(this.yp.canvasElement,i,s)}bt(){var t;null===(t=this.Ni)||void 0===t||t.$a()}jv(t){if(null===this.Ni||this.Ni.Wi()||!this.fs.handleScale.axisPressedMouseMove.price)return;const i=this.ns.wp().$t(),s=this.ns.Kv();this.fp=!0,i.E_(s,this.Ni,t.localY)}Hv(t){if(null===this.Ni||!this.fs.handleScale.axisPressedMouseMove.price)return;const i=this.ns.wp().$t(),s=this.ns.Kv(),n=this.Ni;i.V_(s,n,t.localY)}Pp(){if(null===this.Ni||!this.fs.handleScale.axisPressedMouseMove.price)return;const t=this.ns.wp().$t(),i=this.ns.Kv(),s=this.Ni;this.fp&&(this.fp=!1,t.I_(i,s))}$v(t){if(null===this.Ni||!this.fs.handleScale.axisPressedMouseMove.price)return;const i=this.ns.wp().$t(),s=this.ns.Kv();this.fp=!1,i.I_(s,this.Ni)}Tp(t){this.fs.handleScale.axisDoubleClickReset.price&&this.nr()}Rp(t){if(null===this.Ni)return;!this.ns.wp().$t().W().handleScale.axisPressedMouseMove.price||this.Ni.xh()||this.Ni.Ao()||this.Hp(1)}Wv(t){this.Hp(0)}Ap(){const t=[],i=null===this.Ni?void 0:this.Ni;return(s=>{for(let n=0;n<s.length;++n){const e=s[n].Bs(this.ns.Kv(),i);for(let i=0;i<e.length;i++)t.push(e[i])}})(this.ns.Kv().qo()),t}Lp({context:t,bitmapSize:i}){const{width:s,height:n}=i,e=this.ns.Kv().$t(),r=e.q(),h=e.Td();r===h?Y(t,0,0,s,n,r):Z(t,0,0,s,n,r,h)}Ie({context:t,bitmapSize:i,horizontalPixelRatio:s}){if(null===this.dp||null===this.Ni||!this.Ni.W().borderVisible)return;t.fillStyle=this.Ni.W().borderColor;const n=Math.max(1,Math.floor(this.Dp().C*s));let e;e=this.Mp?i.width-n:0,t.fillRect(e,0,n,i.height)}Fp(t){if(null===this.dp||null===this.Ni)return;const i=this.Ni.$a(),s=this.Ni.W(),n=this.Dp(),e=this.Mp?this.dp.width-n.P:0;s.borderVisible&&s.ticksVisible&&t.useBitmapCoordinateSpace((({context:t,horizontalPixelRatio:r,verticalPixelRatio:h})=>{t.fillStyle=s.borderColor;const l=Math.max(1,Math.floor(h)),a=Math.floor(.5*h),o=Math.round(n.P*r);t.beginPath();for(const s of i)t.rect(Math.floor(e*r),Math.round(s.Na*h)-a,o,l);t.fill()})),t.useMediaCoordinateSpace((({context:t})=>{var r;t.font=this.Bp(),t.fillStyle=null!==(r=s.textColor)&&void 0!==r?r:this.yo.textColor,t.textAlign=this.Mp?"right":"left",t.textBaseline="middle";const h=this.Mp?Math.round(e-n.V):Math.round(e+n.P+n.V),l=i.map((i=>this.vp.xi(t,i.eo)));for(let s=i.length;s--;){const n=i[s];t.fillText(n.eo,h,n.Na+l[s])}}))}zp(){if(null===this.dp||null===this.Ni)return;let t=this.dp.height/2;const i=[],s=this.Ni.qo().slice(),n=this.ns.Kv(),e=this.Dp(),r=this.Ni.xt()[0],h=this.Ni;s.forEach((s=>{const e=s.Bs(n,h);e.forEach((t=>{t.Ei(null),t.Vi()&&i.push(t)})),r===s&&e.length>0&&(t=e[0].yi())})),i.forEach((t=>t.Ei(t.yi())));this.Ni.W().alignLabels&&this.$p(i,e,t)}$p(t,i,s){if(null===this.dp)return;const n=t.filter((t=>t.yi()<=s)),e=t.filter((t=>t.yi()>s));n.sort(((t,i)=>i.yi()-t.yi())),n.length&&e.length&&e.push(n[0]),e.sort(((t,i)=>t.yi()-i.yi()));for(const s of t){const t=Math.floor(s.Vt(i)/2),n=s.yi();n>-t&&n<t&&s.Ei(t),n>this.dp.height-t&&n<this.dp.height+t&&s.Ei(this.dp.height-t)}xn(n,1,this.dp.height,i),xn(e,-1,this.dp.height,i)}Wp(t){if(null===this.dp)return;const i=this.Ap(),s=this.Dp(),n=this.Mp?"right":"left";i.forEach((i=>{if(i.Ii()){i.gt(v(this.Ni)).K(t,s,this.vp,n)}}))}jp(t){if(null===this.dp||null===this.Ni)return;const i=this.ns.wp().$t(),s=[],n=this.ns.Kv(),e=i.td().Bs(n,this.Ni);e.length&&s.push(e);const r=this.Dp(),h=this.Mp?"right":"left";s.forEach((i=>{i.forEach((i=>{i.gt(v(this.Ni)).K(t,r,this.vp,h)}))}))}Hp(t){this.Iv.style.cursor=1===t?"ns-resize":"default"}vo(){const t=this.Op();this.pp<t&&this.ns.wp().$t().Gl(),this.pp=t}Bp(){return I(this.yo.fontSize,this.yo.fontFamily)}}function kn(t,i){var s,n;return null!==(n=null===(s=t.da)||void 0===s?void 0:s.call(t,i))&&void 0!==n?n:[]}function yn(t,i){var s,n;return null!==(n=null===(s=t.Os)||void 0===s?void 0:s.call(t,i))&&void 0!==n?n:[]}function Cn(t,i){var s,n;return null!==(n=null===(s=t.ts)||void 0===s?void 0:s.call(t,i))&&void 0!==n?n:[]}function Pn(t,i){var s,n;return null!==(n=null===(s=t._a)||void 0===s?void 0:s.call(t,i))&&void 0!==n?n:[]}class Tn{constructor(i,s){this.dp=t.size({width:0,height:0}),this.Up=null,this.qp=null,this.Yp=null,this.Xp=!1,this.Kp=new C,this.Zp=new C,this.Gp=new C,this.Jp=new C,this.Qp=0,this.tm=!1,this.im=null,this.sm=!1,this.nm=null,this.rm=null,this.mp=!1,this.bp=()=>{this.mp||null===this.hm||this.qi().qh()},this.gp=()=>{this.mp||null===this.hm||this.qi().qh()},this.lm=i,this.hm=s,this.hm.U_().l(this.am.bind(this),this,!0),this.om=document.createElement("td"),this.om.style.padding="0",this.om.style.position="relative";const n=document.createElement("div");n.style.width="100%",n.style.height="100%",n.style.position="relative",n.style.overflow="hidden",this._m=document.createElement("td"),this._m.style.padding="0",this.um=document.createElement("td"),this.um.style.padding="0",this.om.appendChild(n),this.yp=fn(n,t.size({width:16,height:16})),this.yp.subscribeSuggestedBitmapSizeChanged(this.bp);const e=this.yp.canvasElement;e.style.position="absolute",e.style.zIndex="1",e.style.left="0",e.style.top="0",this.Cp=fn(n,t.size({width:16,height:16})),this.Cp.subscribeSuggestedBitmapSizeChanged(this.gp);const r=this.Cp.canvasElement;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0",this.Vv=document.createElement("tr"),this.Vv.appendChild(this._m),this.Vv.appendChild(this.om),this.Vv.appendChild(this.um),this.dm(),this.Nv=new en(this.Cp.canvasElement,this,{$f:()=>null===this.im&&!this.lm.W().handleScroll.vertTouchDrag,Uf:()=>null===this.im&&!this.lm.W().handleScroll.horzTouchDrag})}S(){null!==this.Up&&this.Up.S(),null!==this.qp&&this.qp.S(),this.Cp.unsubscribeSuggestedBitmapSizeChanged(this.gp),vn(this.Cp.canvasElement),this.Cp.dispose(),this.yp.unsubscribeSuggestedBitmapSizeChanged(this.bp),vn(this.yp.canvasElement),this.yp.dispose(),null!==this.hm&&this.hm.U_().p(this),this.Nv.S()}Kv(){return v(this.hm)}fm(t){null!==this.hm&&this.hm.U_().p(this),this.hm=t,null!==this.hm&&this.hm.U_().l(Tn.prototype.am.bind(this),this,!0),this.dm()}wp(){return this.lm}Uv(){return this.Vv}dm(){if(null!==this.hm&&(this.vm(),0!==this.qi().wt().length)){if(null!==this.Up){const t=this.hm.B_();this.Up.Qi(v(t))}if(null!==this.qp){const t=this.hm.A_();this.qp.Qi(v(t))}}}pm(){null!==this.Up&&this.Up.bt(),null!==this.qp&&this.qp.bt()}S_(){return null!==this.hm?this.hm.S_():0}k_(t){this.hm&&this.hm.k_(t)}Nf(t){if(!this.hm)return;this.bm();const i=t.localX,s=t.localY;this.wm(i,s,t)}ev(t){this.bm(),this.gm(),this.wm(t.localX,t.localY,t),this.Mm(t)}Ff(t){var i;if(!this.hm)return;this.bm();const s=t.localX,n=t.localY;this.wm(s,n,t);const e=this.gr(s,n);this.lm.xm(null!==(i=null==e?void 0:e.cp)&&void 0!==i?i:null),this.qi().Yc(e&&{Xc:e.Xc,_p:e._p})}Qf(t){null!==this.hm&&(this.bm(),this.Sm(t))}Bf(t){null!==this.hm&&this.km(this.Jp,t)}Tf(t){this.Bf(t)}Xf(t){this.bm(),this.ym(t),this.wm(t.localX,t.localY,t)}Jf(t){null!==this.hm&&(this.bm(),this.tm=!1,this.Cm(t),this.Pm(t))}Gf(t){null!==this.hm&&this.Sm(t)}vv(t){if(this.tm=!0,null===this.im){const i={x:t.localX,y:t.localY};this.Tm(i,i,t)}}fv(t){null!==this.hm&&(this.bm(),this.hm.$t().Yc(null),this.Rm())}Dm(){return this.Kp}Om(){return this.Jp}Bm(){return this.Zp}Am(){return this.Gp}av(){this.Qp=1,this.qi().Xs()}ov(t,i){if(!this.lm.W().handleScale.pinch)return;const s=5*(i-this.Qp);this.Qp=i,this.qi()._d(t.st,s)}sv(t){this.tm=!1,this.sm=null!==this.im,this.gm();const i=this.qi().td();null!==this.im&&i.Ct()&&(this.nm={x:i.Xt(),y:i.Kt()},this.im={x:t.localX,y:t.localY})}qf(t){if(null===this.hm)return;const i=t.localX,s=t.localY;if(null===this.im)this.ym(t);else{this.sm=!1;const n=v(this.nm),e=n.x+(i-this.im.x),r=n.y+(s-this.im.y);this.wm(e,r,t)}}Zf(t){0===this.wp().W().trackingMode.exitMode&&(this.sm=!0),this.Em(),this.Cm(t)}gr(t,i){const s=this.hm;return null===s?null:function(t,i,s){const n=t.qo(),e=function(t,i,s){var n,e;let r,h;for(const o of t){const t=null!==(e=null===(n=o.ma)||void 0===n?void 0:n.call(o,i,s))&&void 0!==e?e:[];for(const i of t)l=i.zOrder,(!(a=null==r?void 0:r.zOrder)||"top"===l&&"top"!==a||"normal"===l&&"bottom"===a)&&(r=i,h=o)}var l,a;return r&&h?{up:r,Xc:h}:null}(n,i,s);if("top"===(null==e?void 0:e.up.zOrder))return wn(e);for(const r of n){if(e&&e.Xc===r&&"bottom"!==e.up.zOrder&&!e.up.isBackground)return wn(e);const n=gn(t,r.Os(t),i,s);if(null!==n)return{Xc:r,wv:n.wv,_p:n._p};if(e&&e.Xc===r&&"bottom"!==e.up.zOrder&&e.up.isBackground)return wn(e)}return(null==e?void 0:e.up)?wn(e):null}(s,t,i)}Vm(i,s){v("left"===s?this.Up:this.qp).Ep(t.size({width:i,height:this.dp.height}))}qv(){return this.dp}Ep(i){t.equalSizes(this.dp,i)||(this.dp=i,this.mp=!0,this.yp.resizeCanvasElement(i),this.Cp.resizeCanvasElement(i),this.mp=!1,this.om.style.width=i.width+"px",this.om.style.height=i.height+"px")}Im(){const t=v(this.hm);t.O_(t.B_()),t.O_(t.A_());for(const i of t.xt())if(t.pr(i)){const s=i.Ot();null!==s&&t.O_(s),i.Es()}}Yv(){return this.yp.bitmapSize}Xv(t,i,s){const n=this.Yv();n.width>0&&n.height>0&&t.drawImage(this.yp.canvasElement,i,s)}Ip(i){if(0===i)return;if(null===this.hm)return;if(i>1&&this.Im(),null!==this.Up&&this.Up.Ip(i),null!==this.qp&&this.qp.Ip(i),1!==i){this.yp.applySuggestedBitmapSize();const i=t.tryCreateCanvasRenderingTarget2D(this.yp);null!==i&&(i.useBitmapCoordinateSpace((t=>{this.Lp(t)})),this.hm&&(this.zm(i,kn),this.Lm(i),this.Nm(i),this.zm(i,yn),this.zm(i,Cn)))}this.Cp.applySuggestedBitmapSize();const s=t.tryCreateCanvasRenderingTarget2D(this.Cp);null!==s&&(s.useBitmapCoordinateSpace((({context:t,bitmapSize:i})=>{t.clearRect(0,0,i.width,i.height)})),this.Fm(s),this.zm(s,Pn))}Wm(){return this.om}jm(){return this.Up}Hm(){return this.qp}Np(t,i){this.zm(t,i)}am(){null!==this.hm&&this.hm.U_().p(this),this.hm=null}Sm(t){this.km(this.Kp,t)}Mm(t){this.km(this.Zp,t)}Pm(t){this.km(this.Gp,t)}km(t,i){const s=i.localX,n=i.localY;if(t.M()){const e=this.qi().Kc(v(this.hm));t.m(this.qi().kt().ju(s),{x:s,y:n,$m:e},i)}}Lp({context:t,bitmapSize:i}){const{width:s,height:n}=i,e=this.qi(),r=e.q(),h=e.Td();r===h?Y(t,0,0,s,n,h):Z(t,0,0,s,n,r,h)}Lm(t){const i=v(this.hm),s=i.q_().Yh().gt(i);null!==s&&s.K(t,!1)}Nm(t){const i=this.qi().Qc();this.Um(t,yn,pn,i),this.Um(t,yn,mn,i)}Fm(t){this.Um(t,yn,mn,this.qi().td())}zm(t,i){const s=v(this.hm).qo();for(const n of s)this.Um(t,i,pn,n);for(const n of s)this.Um(t,i,mn,n)}Um(t,i,s,n){const e=v(this.hm),r=e.$t().qc(),h=null!==r&&r.Xc===n,l=null!==r&&h&&void 0!==r._p?r._p.Sr:void 0;bn(i,(i=>s(i,t,h,l)),n,e)}vm(){if(null===this.hm)return;const t=this.lm,i=this.hm.B_().W().visible,s=this.hm.A_().W().visible;i||null===this.Up||(this._m.removeChild(this.Up.Uv()),this.Up.S(),this.Up=null),s||null===this.qp||(this.um.removeChild(this.qp.Uv()),this.qp.S(),this.qp=null);const n=t.$t().xd();i&&null===this.Up&&(this.Up=new Sn(this,t.W(),n,"left"),this._m.appendChild(this.Up.Uv())),s&&null===this.qp&&(this.qp=new Sn(this,t.W(),n,"right"),this.um.appendChild(this.qp.Uv()))}qm(t){return t.pv&&this.tm||null!==this.im}Ym(t){return Math.max(0,Math.min(t,this.dp.width-1))}Xm(t){return Math.max(0,Math.min(t,this.dp.height-1))}wm(t,i,s){this.qi().bd(this.Ym(t),this.Xm(i),s,v(this.hm))}Rm(){this.qi().gd()}Em(){this.sm&&(this.im=null,this.Rm())}Tm(t,i,s){this.im=t,this.sm=!1,this.wm(i.x,i.y,s);const n=this.qi().td();this.nm={x:n.Xt(),y:n.Kt()}}qi(){return this.lm.$t()}Cm(t){if(!this.Xp)return;const i=this.qi(),s=this.Kv();if(i.N_(s,s.bs()),this.Yp=null,this.Xp=!1,i.vd(),null!==this.rm){const t=performance.now(),s=i.kt();this.rm.Br(s.qu(),t),this.rm.nc(t)||i.Gs(this.rm)}}bm(){this.im=null}gm(){if(!this.hm)return;if(this.qi().Xs(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)v(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}!this.hm.bs().Wi()&&this.qi().kt().Wi()}ym(t){if(null===this.hm)return;const i=this.qi(),s=i.kt();if(s.Wi())return;const n=this.lm.W(),e=n.handleScroll,r=n.kineticScroll;if((!e.pressedMouseMove||t.pv)&&(!e.horzTouchDrag&&!e.vertTouchDrag||!t.pv))return;const h=this.hm.bs(),l=performance.now();if(null!==this.Yp||this.qm(t)||(this.Yp={x:t.clientX,y:t.clientY,jd:l,Km:t.localX,Zm:t.localY}),null!==this.Yp&&!this.Xp&&(this.Yp.x!==t.clientX||this.Yp.y!==t.clientY)){if(t.pv&&r.touch||!t.pv&&r.mouse){const t=s.ae();this.rm=new dn(.2/t,7/t,.997,15/t),this.rm.ap(s.qu(),this.Yp.jd)}else this.rm=null;h.Wi()||i.z_(this.hm,h,t.localY),i.dd(t.localX),this.Xp=!0}this.Xp&&(h.Wi()||i.L_(this.hm,h,t.localY),i.fd(t.localX),null!==this.rm&&this.rm.ap(s.qu(),l))}}class Rn{constructor(i,s,n,e,r){this.Ri=!0,this.dp=t.size({width:0,height:0}),this.bp=()=>this.Ip(3),this.Mp="left"===i,this.zc=n.xd,this.fs=s,this.Gm=e,this.Jm=r,this.Iv=document.createElement("div"),this.Iv.style.width="25px",this.Iv.style.height="100%",this.Iv.style.overflow="hidden",this.yp=fn(this.Iv,t.size({width:16,height:16})),this.yp.subscribeSuggestedBitmapSizeChanged(this.bp)}S(){this.yp.unsubscribeSuggestedBitmapSizeChanged(this.bp),vn(this.yp.canvasElement),this.yp.dispose()}Uv(){return this.Iv}qv(){return this.dp}Ep(i){t.equalSizes(this.dp,i)||(this.dp=i,this.yp.resizeCanvasElement(i),this.Iv.style.width=`${i.width}px`,this.Iv.style.height=`${i.height}px`,this.Ri=!0)}Ip(i){if(i<3&&!this.Ri)return;if(0===this.dp.width||0===this.dp.height)return;this.Ri=!1,this.yp.applySuggestedBitmapSize();const s=t.tryCreateCanvasRenderingTarget2D(this.yp);null!==s&&s.useBitmapCoordinateSpace((t=>{this.Lp(t),this.Ie(t)}))}Yv(){return this.yp.bitmapSize}Xv(t,i,s){const n=this.Yv();n.width>0&&n.height>0&&t.drawImage(this.yp.canvasElement,i,s)}Ie({context:t,bitmapSize:i,horizontalPixelRatio:s,verticalPixelRatio:n}){if(!this.Gm())return;t.fillStyle=this.fs.timeScale.borderColor;const e=Math.floor(this.zc.W().C*s),r=Math.floor(this.zc.W().C*n),h=this.Mp?i.width-e:0;t.fillRect(h,0,e,r)}Lp({context:t,bitmapSize:i}){Y(t,0,0,i.width,i.height,this.Jm())}}function Dn(t){return i=>{var s,n;return null!==(n=null===(s=i.pa)||void 0===s?void 0:s.call(i,t))&&void 0!==n?n:[]}}const On=Dn("normal"),Bn=Dn("top"),An=Dn("bottom");class En{constructor(i,s){this.Qm=null,this.tb=null,this.k=null,this.Zp=!1,this.dp=t.size({width:0,height:0}),this.ib=new C,this.vp=new Jt(5),this.mp=!1,this.bp=()=>{this.mp||this.lm.$t().qh()},this.gp=()=>{this.mp||this.lm.$t().qh()},this.lm=i,this.K_=s,this.fs=i.W().layout,this.sb=document.createElement("tr"),this.nb=document.createElement("td"),this.nb.style.padding="0",this.eb=document.createElement("td"),this.eb.style.padding="0",this.Iv=document.createElement("td"),this.Iv.style.height="25px",this.Iv.style.padding="0",this.rb=document.createElement("div"),this.rb.style.width="100%",this.rb.style.height="100%",this.rb.style.position="relative",this.rb.style.overflow="hidden",this.Iv.appendChild(this.rb),this.yp=fn(this.rb,t.size({width:16,height:16})),this.yp.subscribeSuggestedBitmapSizeChanged(this.bp);const n=this.yp.canvasElement;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.Cp=fn(this.rb,t.size({width:16,height:16})),this.Cp.subscribeSuggestedBitmapSizeChanged(this.gp);const e=this.Cp.canvasElement;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0",this.sb.appendChild(this.nb),this.sb.appendChild(this.Iv),this.sb.appendChild(this.eb),this.hb(),this.lm.$t().x_().l(this.hb.bind(this),this),this.Nv=new en(this.Cp.canvasElement,this,{$f:()=>!0,Uf:()=>!this.lm.W().handleScroll.horzTouchDrag})}S(){this.Nv.S(),null!==this.Qm&&this.Qm.S(),null!==this.tb&&this.tb.S(),this.Cp.unsubscribeSuggestedBitmapSizeChanged(this.gp),vn(this.Cp.canvasElement),this.Cp.dispose(),this.yp.unsubscribeSuggestedBitmapSizeChanged(this.bp),vn(this.yp.canvasElement),this.yp.dispose()}Uv(){return this.sb}lb(){return this.Qm}ab(){return this.tb}ev(t){if(this.Zp)return;this.Zp=!0;const i=this.lm.$t();!i.kt().Wi()&&this.lm.W().handleScale.axisPressedMouseMove.time&&i.od(t.localX)}sv(t){this.ev(t)}rv(){const t=this.lm.$t();!t.kt().Wi()&&this.Zp&&(this.Zp=!1,this.lm.W().handleScale.axisPressedMouseMove.time&&t.md())}Xf(t){const i=this.lm.$t();!i.kt().Wi()&&this.lm.W().handleScale.axisPressedMouseMove.time&&i.pd(t.localX)}qf(t){this.Xf(t)}Jf(){this.Zp=!1;const t=this.lm.$t();t.kt().Wi()&&!this.lm.W().handleScale.axisPressedMouseMove.time||t.md()}Zf(){this.Jf()}Bf(){this.lm.W().handleScale.axisDoubleClickReset.time&&this.lm.$t().Qs()}Tf(){this.Bf()}Nf(){this.lm.$t().W().handleScale.axisPressedMouseMove.time&&this.Hp(1)}fv(){this.Hp(0)}qv(){return this.dp}ob(){return this.ib}_b(i,s,n){t.equalSizes(this.dp,i)||(this.dp=i,this.mp=!0,this.yp.resizeCanvasElement(i),this.Cp.resizeCanvasElement(i),this.mp=!1,this.Iv.style.width=`${i.width}px`,this.Iv.style.height=`${i.height}px`,this.ib.m(i)),null!==this.Qm&&this.Qm.Ep(t.size({width:s,height:i.height})),null!==this.tb&&this.tb.Ep(t.size({width:n,height:i.height}))}ub(){const t=this.cb();return Math.ceil(t.C+t.P+t.T+t.L+t.A+t.fb)}bt(){this.lm.$t().kt().$a()}Yv(){return this.yp.bitmapSize}Xv(t,i,s){const n=this.Yv();n.width>0&&n.height>0&&t.drawImage(this.yp.canvasElement,i,s)}Ip(i){if(0===i)return;if(1!==i){this.yp.applySuggestedBitmapSize();const s=t.tryCreateCanvasRenderingTarget2D(this.yp);null!==s&&(s.useBitmapCoordinateSpace((t=>{this.Lp(t),this.Ie(t),this.pb(s,An)})),this.Fp(s),this.pb(s,On)),null!==this.Qm&&this.Qm.Ip(i),null!==this.tb&&this.tb.Ip(i)}this.Cp.applySuggestedBitmapSize();const s=t.tryCreateCanvasRenderingTarget2D(this.Cp);null!==s&&(s.useBitmapCoordinateSpace((({context:t,bitmapSize:i})=>{t.clearRect(0,0,i.width,i.height)})),this.mb([...this.lm.$t().wt(),this.lm.$t().td()],s),this.pb(s,Bn))}pb(t,i){const s=this.lm.$t().wt();for(const n of s)bn(i,(i=>pn(i,t,!1,void 0)),n,void 0);for(const n of s)bn(i,(i=>mn(i,t,!1,void 0)),n,void 0)}Lp({context:t,bitmapSize:i}){Y(t,0,0,i.width,i.height,this.lm.$t().Td())}Ie({context:t,bitmapSize:i,verticalPixelRatio:s}){if(this.lm.W().timeScale.borderVisible){t.fillStyle=this.bb();const n=Math.max(1,Math.floor(this.cb().C*s));t.fillRect(0,0,i.width,n)}}Fp(t){const i=this.lm.$t().kt(),s=i.$a();if(!s||0===s.length)return;const n=this.K_.maxTickMarkWeight(s),e=this.cb(),r=i.W();r.borderVisible&&r.ticksVisible&&t.useBitmapCoordinateSpace((({context:t,horizontalPixelRatio:i,verticalPixelRatio:n})=>{t.strokeStyle=this.bb(),t.fillStyle=this.bb();const r=Math.max(1,Math.floor(i)),h=Math.floor(.5*i);t.beginPath();const l=Math.round(e.P*n);for(let n=s.length;n--;){const e=Math.round(s[n].coord*i);t.rect(e-h,0,r,l)}t.fill()})),t.useMediaCoordinateSpace((({context:t})=>{const i=e.C+e.P+e.L+e.T/2;t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.$(),t.font=this.Bp();for(const e of s)if(e.weight<n){const s=e.needAlignCoordinate?this.wb(t,e.coord,e.label):e.coord;t.fillText(e.label,s,i)}this.lm.W().timeScale.allowBoldLabels&&(t.font=this.gb());for(const e of s)if(e.weight>=n){const s=e.needAlignCoordinate?this.wb(t,e.coord,e.label):e.coord;t.fillText(e.label,s,i)}}))}wb(t,i,s){const n=this.vp.Si(t,s),e=n/2,r=Math.floor(i-e)+.5;return r<0?i+=Math.abs(0-r):r+n>this.dp.width&&(i-=Math.abs(this.dp.width-(r+n))),i}mb(t,i){const s=this.cb();for(const n of t)for(const t of n.ss())t.gt().K(i,s)}bb(){return this.lm.W().timeScale.borderColor}$(){return this.fs.textColor}j(){return this.fs.fontSize}Bp(){return I(this.j(),this.fs.fontFamily)}gb(){return I(this.j(),this.fs.fontFamily,"bold")}cb(){null===this.k&&(this.k={C:1,N:NaN,L:NaN,A:NaN,$i:NaN,P:5,T:NaN,R:"",Hi:new Jt,fb:0});const t=this.k,i=this.Bp();if(t.R!==i){const s=this.j();t.T=s,t.R=i,t.L=3*s/12,t.A=3*s/12,t.$i=9*s/12,t.N=0,t.fb=4*s/12,t.Hi.nr()}return this.k}Hp(t){this.Iv.style.cursor=1===t?"ew-resize":"default"}hb(){const t=this.lm.$t(),i=t.W();i.leftPriceScale.visible||null===this.Qm||(this.nb.removeChild(this.Qm.Uv()),this.Qm.S(),this.Qm=null),i.rightPriceScale.visible||null===this.tb||(this.eb.removeChild(this.tb.Uv()),this.tb.S(),this.tb=null);const s={xd:this.lm.$t().xd()},n=()=>i.leftPriceScale.borderVisible&&t.kt().W().borderVisible,e=()=>t.Td();i.leftPriceScale.visible&&null===this.Qm&&(this.Qm=new Rn("left",i,s,n,e),this.nb.appendChild(this.Qm.Uv())),i.rightPriceScale.visible&&null===this.tb&&(this.tb=new Rn("right",i,s,n,e),this.eb.appendChild(this.tb.Uv()))}}const Vn=!!Js&&!!navigator.userAgentData&&navigator.userAgentData.brands.some((t=>t.brand.includes("Chromium")))&&!!Js&&((null===(In=null===navigator||void 0===navigator?void 0:navigator.userAgentData)||void 0===In?void 0:In.platform)?"Windows"===navigator.userAgentData.platform:navigator.userAgent.toLowerCase().indexOf("win")>=0);var In;class zn{constructor(t,i,s){var n;this.Mb=[],this.xb=[],this.Sb=0,this.lo=0,this.c_=0,this.kb=0,this.yb=0,this.Cb=null,this.Pb=!1,this.Kp=new C,this.Zp=new C,this.Gp=new C,this.Jp=new C,this.Ac=new C,this.Tb=null,this.Rb=null,this.Db=t,this.fs=i,this.K_=s,this.sb=document.createElement("div"),this.sb.classList.add("tv-lightweight-charts"),this.sb.style.overflow="hidden",this.sb.style.direction="ltr",this.sb.style.width="100%",this.sb.style.height="100%",(n=this.sb).style.userSelect="none",n.style.webkitUserSelect="none",n.style.msUserSelect="none",n.style.MozUserSelect="none",n.style.webkitTapHighlightColor="transparent",this.Ob=document.createElement("table"),this.Ob.setAttribute("cellspacing","0"),this.sb.appendChild(this.Ob),this.Bb=this.Ab.bind(this),Ln(this.fs)&&this.Eb(!0),this.qi=new As(this.Ic.bind(this),this.fs,s),this.$t().sd().l(this.Vb.bind(this),this),this.Ib=new En(this,this.K_),this.Ob.appendChild(this.Ib.Uv());const e=i.autoSize&&this.zb();let r=this.fs.width,h=this.fs.height;if(e||0===r||0===h){const i=t.getBoundingClientRect();r=r||i.width,h=h||i.height}this.Lb(r,h),this.Nb(),t.appendChild(this.sb),this.Fb(),this.qi.kt().lc().l(this.qi.Gl.bind(this.qi),this),this.qi.x_().l(this.qi.Gl.bind(this.qi),this)}$t(){return this.qi}W(){return this.fs}Av(){return this.Mb}Wb(){return this.Ib}S(){this.Eb(!1),0!==this.Sb&&window.cancelAnimationFrame(this.Sb),this.qi.sd().p(this),this.qi.kt().lc().p(this),this.qi.x_().p(this),this.qi.S();for(const t of this.Mb)this.Ob.removeChild(t.Uv()),t.Dm().p(this),t.Om().p(this),t.Bm().p(this),t.Am().p(this),t.S();this.Mb=[];for(const t of this.xb)this.jb(t);this.xb=[],v(this.Ib).S(),null!==this.sb.parentElement&&this.sb.parentElement.removeChild(this.sb),this.Ac.S(),this.Kp.S(),this.Jp.S(),this.Zp.S(),this.Gp.S(),this.Hb()}Lb(i,s,n=!1){if(this.lo===s&&this.c_===i)return;const e=function(i){const s=Math.floor(i.width),n=Math.floor(i.height),e=s-s%2,r=n-n%2;return t.size({width:e,height:r})}(t.size({width:i,height:s}));this.lo=e.height,this.c_=e.width;const r=this.lo+"px",h=this.c_+"px";v(this.sb).style.height=r,v(this.sb).style.width=h,this.Ob.style.height=r,this.Ob.style.width=h,n?this.$b(lt.ln(),performance.now()):this.qi.Gl()}Ip(t){void 0===t&&(t=lt.ln());for(let i=0;i<this.Mb.length;i++)this.Mb[i].Ip(t.qs(i).Hs);this.fs.timeScale.visible&&this.Ib.Ip(t.Us())}Uh(t){const i=Ln(this.fs);this.qi.Uh(t);const s=Ln(this.fs);s!==i&&this.Eb(s),this.Fb(),this.Ub(t)}Dm(){return this.Kp}Om(){return this.Jp}sd(){return this.Ac}Bm(){return this.Zp}Am(){return this.Gp}qb(){null!==this.Cb&&(this.$b(this.Cb,performance.now()),this.Cb=null);const t=this.Yb(null),i=document.createElement("canvas");i.width=t.width,i.height=t.height;const s=v(i.getContext("2d"));return this.Yb(s),i}Xb(t){if("left"===t&&!this.Kb())return 0;if("right"===t&&!this.Zb())return 0;if(0===this.Mb.length)return 0;return v("left"===t?this.Mb[0].jm():this.Mb[0].Hm()).Vp()}Gb(){return this.fs.autoSize&&null!==this.Tb}Jb(){return this.sb}xm(t){this.Rb=t,this.Rb?this.Jb().style.setProperty("cursor",t):this.Jb().style.removeProperty("cursor")}Qb(){return this.Rb}tw(){return f(this.Mb[0]).qv()}Zv(){this.iw()}Ub(t){(void 0!==t.autoSize||!this.Tb||void 0===t.width&&void 0===t.height)&&(t.autoSize&&!this.Tb&&this.zb(),!1===t.autoSize&&null!==this.Tb&&this.Hb(),t.autoSize||void 0===t.width&&void 0===t.height||this.Lb(t.width||this.c_,t.height||this.lo))}Yb(i){let s=0,n=0;const e=this.Mb[0],r=(t,s)=>{let n=0;for(let e=0;e<this.Mb.length;e++){const r=this.Mb[e],h=v("left"===t?r.jm():r.Hm()),l=h.Yv();if(null!==i&&h.Xv(i,s,n),n+=l.height,e<this.Mb.length-1){const t=this.xb[e],r=t.Yv();null!==i&&t.Xv(i,s,n),n+=r.height}}};if(this.Kb()){r("left",0);s+=v(e.jm()).Yv().width}for(let t=0;t<this.Mb.length;t++){const e=this.Mb[t],r=e.Yv();if(null!==i&&e.Xv(i,s,n),n+=r.height,t<this.Mb.length-1){const e=this.xb[t],r=e.Yv();null!==i&&e.Xv(i,s,n),n+=r.height}}if(s+=e.Yv().width,this.Zb()){r("right",s);s+=v(e.Hm()).Yv().width}const h=(t,s,n)=>{v("left"===t?this.Ib.lb():this.Ib.ab()).Xv(v(i),s,n)};if(this.fs.timeScale.visible){const t=this.Ib.Yv();if(null!==i){let s=0;this.Kb()&&(h("left",s,n),s=v(e.jm()).Yv().width),this.Ib.Xv(i,s,n),s+=t.width,this.Zb()&&h("right",s,n)}n+=t.height}return t.size({width:s,height:n})}iw(){var i;let s=0,n=0,e=0;n=sn(n),e=sn(e);const r=this.c_,h=this.lo,l=1*this.xb.length,a=this.fs.timeScale.visible;let o=a?Math.max(this.Ib.ub(),this.fs.timeScale.minimumHeight):0;var _;o=(_=o)+_%2;const u=l+o,c=h<u?0:h-u;for(const t of this.Mb){this.Kb()&&(n=Math.max(n,v(t.jm()).Op(),this.fs.leftPriceScale.minimumWidth)),this.Zb()&&(e=Math.max(e,v(t.Hm()).Op(),this.fs.rightPriceScale.minimumWidth));const i=c/t.Kv().y_();s+=Math.max(t.S_(),i)}const d=c/s,f=Math.max(r-n-e,0);let p=0;const m=(null===(i=document.body.ownerDocument.defaultView)||void 0===i?void 0:i.devicePixelRatio)||1;for(let i=0;i<this.Mb.length;++i){const s=this.Mb[i];s.fm(this.qi.Jc()[i]);let r=0,h=0;h=i===this.Mb.length-1?Math.ceil((c-p)*m)/m:Math.round(s.S_()*d*m)/m,r=Math.max(h,2),p+=r,s.Ep(t.size({width:f,height:r})),this.Kb()&&s.Vm(n,"left"),this.Zb()&&s.Vm(e,"right"),s.Kv()&&this.qi.nd(s.Kv(),r)}this.Ib._b(t.size({width:a?f:0,height:o}),a?n:0,a?e:0),this.qi.C_(f),this.kb!==n&&(this.kb=n),this.yb!==e&&(this.yb=e)}Eb(t){t?this.sb.addEventListener("wheel",this.Bb,{passive:!1}):this.sb.removeEventListener("wheel",this.Bb)}sw(t){switch(t.deltaMode){case t.DOM_DELTA_PAGE:return 120;case t.DOM_DELTA_LINE:return 32}return Vn?1/window.devicePixelRatio:1}Ab(t){if(!(0!==t.deltaX&&this.fs.handleScroll.mouseWheel||0!==t.deltaY&&this.fs.handleScale.mouseWheel))return;const i=this.sw(t),s=i*t.deltaX/100,n=-i*t.deltaY/100;if(t.cancelable&&t.preventDefault(),0!==n&&this.fs.handleScale.mouseWheel){const i=Math.sign(n)*Math.min(1,Math.abs(n)),s=t.clientX-this.sb.getBoundingClientRect().left;this.$t()._d(s,i)}0!==s&&this.fs.handleScroll.mouseWheel&&this.$t().ud(-80*s)}$b(t,i){var s;const n=t.Us();3===n&&this.nw(),3!==n&&2!==n||(this.ew(t),this.rw(t,i),this.Ib.bt(),this.Mb.forEach((t=>{t.pm()})),3===(null===(s=this.Cb)||void 0===s?void 0:s.Us())&&(this.Cb.en(t),this.nw(),this.ew(this.Cb),this.rw(this.Cb,i),t=this.Cb,this.Cb=null)),this.Ip(t)}rw(t,i){for(const s of t.nn())this.rn(s,i)}ew(t){const i=this.qi.Jc();for(let s=0;s<i.length;s++)t.qs(s).$s&&i[s].j_()}rn(t,i){const s=this.qi.kt();switch(t.Ks){case 0:s.oc();break;case 1:s._c(t.Bt);break;case 2:s.tn(t.Bt);break;case 3:s.sn(t.Bt);break;case 4:s.Ku();break;case 5:t.Bt.nc(i)||s.sn(t.Bt.ec(i))}}Ic(t){null!==this.Cb?this.Cb.en(t):this.Cb=t,this.Pb||(this.Pb=!0,this.Sb=window.requestAnimationFrame((t=>{if(this.Pb=!1,this.Sb=0,null!==this.Cb){const i=this.Cb;this.Cb=null,this.$b(i,t);for(const s of i.nn())if(5===s.Ks&&!s.Bt.nc(t)){this.$t().Gs(s.Bt);break}}})))}nw(){this.Nb()}jb(t){this.Ob.removeChild(t.Uv()),t.S()}Nb(){const t=this.qi.Jc(),i=t.length,s=this.Mb.length;for(let t=i;t<s;t++){const t=f(this.Mb.pop());this.Ob.removeChild(t.Uv()),t.Dm().p(this),t.Om().p(this),t.Bm().p(this),t.Am().p(this),t.S();const i=this.xb.pop();void 0!==i&&this.jb(i)}for(let n=s;n<i;n++){const i=new Tn(this,t[n]);if(i.Dm().l(this.hw.bind(this),this),i.Om().l(this.lw.bind(this),this),i.Bm().l(this.aw.bind(this),this),i.Am().l(this.ow.bind(this),this),this.Mb.push(i),n>=1){const t=!this.fs.layout.resizePanes,i=new _n(this,n-1,n,t);this.xb.push(i),this.Ob.insertBefore(i.Uv(),this.Ib.Uv())}this.Ob.insertBefore(i.Uv(),this.Ib.Uv())}for(let s=0;s<i;s++){const i=t[s],n=this.Mb[s];n.Kv()!==i?n.fm(i):n.dm()}this.Fb(),this.iw()}_w(t,i,s){var n,e;const r=new Map;if(null!==t){this.qi.wt().forEach((i=>{const s=i.Ls().al(t);null!==s&&r.set(i,s)}))}let h;if(null!==t){const i=null===(n=this.qi.kt().Yi(t))||void 0===n?void 0:n.originalTime;void 0!==i&&(h=i)}const l=this.$t().qc(),a=null!==l&&l.Xc instanceof Yi?l.Xc:void 0,o=null!==l&&void 0!==l._p?l._p.Mr:void 0;return{uw:h,re:null!=t?t:void 0,cw:null!=i?i:void 0,$m:null!==(e=null==i?void 0:i.$m)&&void 0!==e?e:void 0,dw:a,fw:r,pw:o,mw:null!=s?s:void 0}}hw(t,i,s){this.Kp.m((()=>this._w(t,i,s)))}lw(t,i,s){this.Jp.m((()=>this._w(t,i,s)))}Vb(t,i,s){this.Ac.m((()=>this._w(t,i,s)))}aw(t,i,s){this.Zp.m((()=>this._w(t,i,s)))}ow(t,i,s){this.Gp.m((()=>this._w(t,i,s)))}Fb(){const t=this.fs.timeScale.visible?"":"none";this.Ib.Uv().style.display=t}Kb(){return this.Mb[0].Kv().B_().W().visible}Zb(){return this.Mb[0].Kv().A_().W().visible}zb(){return"ResizeObserver"in window&&(this.Tb=new ResizeObserver((t=>{const i=t.find((t=>t.target===this.Db));i&&this.Lb(i.contentRect.width,i.contentRect.height)})),this.Tb.observe(this.Db,{box:"border-box"}),!0)}Hb(){null!==this.Tb&&this.Tb.disconnect(),this.Tb=null}}function Ln(t){return Boolean(t.handleScroll.mouseWheel||t.handleScale.mouseWheel)}function Nn(t,i){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&i.indexOf(n)<0&&(s[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(n=Object.getOwnPropertySymbols(t);e<n.length;e++)i.indexOf(n[e])<0&&Object.prototype.propertyIsEnumerable.call(t,n[e])&&(s[n[e]]=t[n[e]])}return s}function Fn(t,i,s,n){const e=s.value,r={re:i,ot:t,Bt:[e,e,e,e],uw:n};return void 0!==s.color&&(r.O=s.color),r}function Wn(t,i,s,n){const e=s.value,r={re:i,ot:t,Bt:[e,e,e,e],uw:n};return void 0!==s.lineColor&&(r.lt=s.lineColor),void 0!==s.topColor&&(r.Rn=s.topColor),void 0!==s.bottomColor&&(r.Dn=s.bottomColor),r}function jn(t,i,s,n){const e=s.value,r={re:i,ot:t,Bt:[e,e,e,e],uw:n};return void 0!==s.topLineColor&&(r.De=s.topLineColor),void 0!==s.bottomLineColor&&(r.Oe=s.bottomLineColor),void 0!==s.topFillColor1&&(r.ye=s.topFillColor1),void 0!==s.topFillColor2&&(r.Ce=s.topFillColor2),void 0!==s.bottomFillColor1&&(r.Pe=s.bottomFillColor1),void 0!==s.bottomFillColor2&&(r.Te=s.bottomFillColor2),r}function Hn(t,i,s,n){const e={re:i,ot:t,Bt:[s.open,s.high,s.low,s.close],uw:n};return void 0!==s.color&&(e.O=s.color),e}function $n(t,i,s,n){const e={re:i,ot:t,Bt:[s.open,s.high,s.low,s.close],uw:n};return void 0!==s.color&&(e.O=s.color),void 0!==s.borderColor&&(e.At=s.borderColor),void 0!==s.wickColor&&(e.Zh=s.wickColor),e}function Un(t,i,s,n,e){const r=f(e)(s),h=Math.max(...r),l=Math.min(...r),a=r[r.length-1],o=[a,h,l,a],_=s,{time:u,color:c}=_;return{re:i,ot:t,Bt:o,uw:n,Ue:Nn(_,["time","color"]),O:c}}function qn(t){return void 0!==t.Bt}function Yn(t,i){return void 0!==i.customValues&&(t.bw=i.customValues),t}function Xn(t){return(i,s,n,e,r,h)=>function(t,i){return i?i(t):void 0===(s=t).open&&void 0===s.value;var s}(n,h)?Yn({ot:i,re:s,uw:e},n):Yn(t(i,s,n,e,r),n)}function Kn(t){return{Candlestick:Xn($n),Bar:Xn(Hn),Area:Xn(Wn),Baseline:Xn(jn),Histogram:Xn(Fn),Line:Xn(Fn),Custom:Xn(Un)}[t]}function Zn(t){return{re:0,ww:new Map,oa:t}}function Gn(t,i){if(void 0!==t&&0!==t.length)return{gw:i.key(t[0].ot),Mw:i.key(t[t.length-1].ot)}}function Jn(t){let i;return t.forEach((t=>{void 0===i&&(i=t.uw)})),f(i)}class Qn{constructor(t){this.xw=new Map,this.Sw=new Map,this.kw=new Map,this.yw=[],this.K_=t}S(){this.xw.clear(),this.Sw.clear(),this.kw.clear(),this.yw=[]}Cw(t,i){let s=0!==this.xw.size,n=!1;const e=this.Sw.get(t);if(void 0!==e)if(1===this.Sw.size)s=!1,n=!0,this.xw.clear();else for(const i of this.yw)i.pointData.ww.delete(t)&&(n=!0);let r=[];if(0!==i.length){const s=i.map((t=>t.time)),e=this.K_.createConverterToInternalObj(i),h=Kn(t.tl()),l=t.Ra(),a=t.Da();r=i.map(((i,r)=>{const o=e(i.time),_=this.K_.key(o);let u=this.xw.get(_);void 0===u&&(u=Zn(o),this.xw.set(_,u),n=!0);const c=h(o,u.re,i,s[r],l,a);return u.ww.set(t,c),c}))}s&&this.Pw(),this.Tw(t,r);let h=-1;if(n){const t=[];this.xw.forEach((i=>{t.push({timeWeight:0,time:i.oa,pointData:i,originalTime:Jn(i.ww)})})),t.sort(((t,i)=>this.K_.key(t.time)-this.K_.key(i.time))),h=this.Rw(t)}return this.Dw(t,h,function(t,i,s){const n=Gn(t,s),e=Gn(i,s);if(void 0!==n&&void 0!==e)return{sa:n.Mw>=e.Mw&&n.gw>=e.gw}}(this.Sw.get(t),e,this.K_))}hd(t){return this.Cw(t,[])}Ow(t,i){const s=i;!function(t){void 0===t.uw&&(t.uw=t.time)}(s),this.K_.preprocessData(i);const n=this.K_.createConverterToInternalObj([i])(i.time),e=this.kw.get(t);if(void 0!==e&&this.K_.key(n)<this.K_.key(e))throw new Error(`Cannot update oldest data, last time=${e}, new time=${n}`);let r=this.xw.get(this.K_.key(n));const h=void 0===r;void 0===r&&(r=Zn(n),this.xw.set(this.K_.key(n),r));const l=Kn(t.tl()),a=t.Ra(),o=t.Da(),_=l(n,r.re,i,s.uw,a,o);r.ww.set(t,_),this.Bw(t,_);const u={sa:qn(_)};if(!h)return this.Dw(t,-1,u);const c={timeWeight:0,time:r.oa,pointData:r,originalTime:Jn(r.ww)},d=Rt(this.yw,this.K_.key(c.time),((t,i)=>this.K_.key(t.time)<i));this.yw.splice(d,0,c);for(let t=d;t<this.yw.length;++t)te(this.yw[t].pointData,t);return this.K_.fillWeightsForPoints(this.yw,d),this.Dw(t,d,u)}Bw(t,i){let s=this.Sw.get(t);void 0===s&&(s=[],this.Sw.set(t,s));const n=0!==s.length?s[s.length-1]:null;null===n||this.K_.key(i.ot)>this.K_.key(n.ot)?qn(i)&&s.push(i):qn(i)?s[s.length-1]=i:s.splice(-1,1),this.kw.set(t,i.ot)}Tw(t,i){0!==i.length?(this.Sw.set(t,i.filter(qn)),this.kw.set(t,i[i.length-1].ot)):(this.Sw.delete(t),this.kw.delete(t))}Pw(){for(const t of this.yw)0===t.pointData.ww.size&&this.xw.delete(this.K_.key(t.time))}Rw(t){let i=-1;for(let s=0;s<this.yw.length&&s<t.length;++s){const n=this.yw[s],e=t[s];if(this.K_.key(n.time)!==this.K_.key(e.time)){i=s;break}e.timeWeight=n.timeWeight,te(e.pointData,s)}if(-1===i&&this.yw.length!==t.length&&(i=Math.min(this.yw.length,t.length)),-1===i)return-1;for(let s=i;s<t.length;++s)te(t[s].pointData,s);return this.K_.fillWeightsForPoints(t,i),this.yw=t,i}Aw(){if(0===this.Sw.size)return null;let t=0;return this.Sw.forEach((i=>{0!==i.length&&(t=Math.max(t,i[i.length-1].re))})),t}Dw(t,i,s){const n={Ew:new Map,kt:{Wu:this.Aw()}};if(-1!==i)this.Sw.forEach(((i,e)=>{n.Ew.set(e,{Ue:i,Vw:e===t?s:void 0})})),this.Sw.has(t)||n.Ew.set(t,{Ue:[],Vw:s}),n.kt.Iw=this.yw,n.kt.zw=i;else{const i=this.Sw.get(t);n.Ew.set(t,{Ue:i||[],Vw:s})}return n}}function te(t,i){t.re=i,t.ww.forEach((t=>{t.re=i}))}function ie(t){const i={value:t.Bt[3],time:t.uw};return void 0!==t.bw&&(i.customValues=t.bw),i}function se(t){const i=ie(t);return void 0!==t.O&&(i.color=t.O),i}function ne(t){const i=ie(t);return void 0!==t.lt&&(i.lineColor=t.lt),void 0!==t.Rn&&(i.topColor=t.Rn),void 0!==t.Dn&&(i.bottomColor=t.Dn),i}function ee(t){const i=ie(t);return void 0!==t.De&&(i.topLineColor=t.De),void 0!==t.Oe&&(i.bottomLineColor=t.Oe),void 0!==t.ye&&(i.topFillColor1=t.ye),void 0!==t.Ce&&(i.topFillColor2=t.Ce),void 0!==t.Pe&&(i.bottomFillColor1=t.Pe),void 0!==t.Te&&(i.bottomFillColor2=t.Te),i}function re(t){const i={open:t.Bt[0],high:t.Bt[1],low:t.Bt[2],close:t.Bt[3],time:t.uw};return void 0!==t.bw&&(i.customValues=t.bw),i}function he(t){const i=re(t);return void 0!==t.O&&(i.color=t.O),i}function le(t){const i=re(t),{O:s,At:n,Zh:e}=t;return void 0!==s&&(i.color=s),void 0!==n&&(i.borderColor=n),void 0!==e&&(i.wickColor=e),i}function ae(t){return{Area:ne,Line:se,Baseline:ee,Histogram:se,Bar:he,Candlestick:le,Custom:oe}[t]}function oe(t){const i=t.uw;return Object.assign(Object.assign({},t.Ue),{time:i})}const _e={vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},ue={vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},ce={background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:V,resizePanes:!1,panes:[{stretchFactor:2}]},de={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2},minimumWidth:0},fe={rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,allowShiftVisibleRangeOnWhitespaceReplacement:!1,ticksVisible:!1,uniformDistribution:!1,minimumHeight:0,allowBoldLabels:!0},ve={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:V,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"};function pe(){return{width:0,height:0,autoSize:!1,layout:ce,crosshair:_e,grid:ue,overlayPriceScales:Object.assign({},de),leftPriceScale:Object.assign(Object.assign({},de),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},de),{visible:!0}),nonPrimaryPriceScale:Object.assign(Object.assign({},de),{visible:!0}),timeScale:fe,watermark:ve,localization:{locale:Js?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}}}class me{constructor(t,i){this.Ov=t,this.Lw=i}applyOptions(t){this.Ov.$t().Zc(this.Lw,t)}options(){return this.Ni().W()}width(){return ht(this.Lw)?this.Ov.Xb(this.Lw):0}Ni(){return v(this.Ov.$t().Gc(this.Lw)).Ot}}function be(t,i,s){const n=Nn(t,["time","originalTime"]),e=Object.assign({time:i},n);return void 0!==s&&(e.originalTime=s),e}const we={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:"",axisLabelColor:"",axisLabelTextColor:""};class ge{constructor(t){this.Fh=t}applyOptions(t){this.Fh.Uh(t)}options(){return this.Fh.W()}Nw(){return this.Fh}}class Me{constructor(t,i,s,n,e){this.Fw=new C,this.Nn=t,this.Ww=i,this.jw=s,this.K_=e,this.Hw=n}S(){this.Fw.S()}priceFormatter(){return this.Nn.Ma()}priceToCoordinate(t){const i=this.Nn.Pt();return null===i?null:this.Nn.Ot().Dt(t,i.Bt)}coordinateToPrice(t){const i=this.Nn.Pt();return null===i?null:this.Nn.Ot().ws(t,i.Bt)}barsInLogicalRange(t){if(null===t)return null;const i=new Ms(new bs(t.from,t.to))._u(),s=this.Nn.Ls();if(s.Wi())return null;const n=s.al(i.An(),1),e=s.al(i.ci(),-1),r=v(s.rl()),h=v(s.zs());if(null!==n&&null!==e&&n.re>e.re)return{barsBefore:t.from-r,barsAfter:h-t.to};const l={barsBefore:null===n||n.re===r?t.from-r:n.re-r,barsAfter:null===e||e.re===h?h-t.to:h-e.re};return null!==n&&null!==e&&(l.from=n.uw,l.to=e.uw),l}setData(t){this.K_,this.Nn.tl(),this.Ww.$w(this.Nn,t),this.Uw("full")}update(t){this.Nn.tl(),this.Ww.qw(this.Nn,t),this.Uw("update")}dataByIndex(t,i){const s=this.Nn.Ls().al(t,i);if(null===s)return null;return ae(this.seriesType())(s)}data(){const t=ae(this.seriesType());return this.Nn.Ls().ne().map((i=>t(i)))}subscribeDataChanged(t){this.Fw.l(t)}unsubscribeDataChanged(t){this.Fw.v(t)}setMarkers(t){this.K_;const i=t.map((t=>be(t,this.K_.convertHorzItemToInternal(t.time),t.time)));this.Nn.ea(i)}markers(){return this.Nn.ra().map((t=>be(t,t.originalTime,void 0)))}applyOptions(t){this.Nn.Uh(t)}options(){return B(this.Nn.W())}priceScale(){return this.jw.priceScale(this.Nn.Ot().ba())}createPriceLine(t){const i=P(B(we),t),s=this.Nn.ha(i);return new ge(s)}removePriceLine(t){this.Nn.la(t.Nw())}seriesType(){return this.Nn.tl()}attachPrimitive(t){this.Nn.Pa(t),t.attached&&t.attached({chart:this.Hw,series:this,requestUpdate:()=>this.Nn.$t().Gl()})}detachPrimitive(t){this.Nn.Ta(t),t.detached&&t.detached()}Uw(t){this.Fw.M()&&this.Fw.m(t)}}class xe{constructor(t,i,s){this.Yw=new C,this.gu=new C,this.ib=new C,this.qi=t,this.Cl=t.kt(),this.Ib=i,this.Cl.rc().l(this.Xw.bind(this)),this.Cl.hc().l(this.Kw.bind(this)),this.Ib.ob().l(this.Zw.bind(this)),this.K_=s}S(){this.Cl.rc().p(this),this.Cl.hc().p(this),this.Ib.ob().p(this),this.Yw.S(),this.gu.S(),this.ib.S()}scrollPosition(){return this.Cl.qu()}scrollToPosition(t,i){i?this.Cl.sc(t,1e3):this.qi.sn(t)}scrollToRealTime(){this.Cl.tc()}getVisibleRange(){const t=this.Cl.Eu();return null===t?null:{from:t.from.originalTime,to:t.to.originalTime}}setVisibleRange(t){const i={from:this.K_.convertHorzItemToInternal(t.from),to:this.K_.convertHorzItemToInternal(t.to)},s=this.Cl.Lu(i);this.qi.Cd(s)}getVisibleLogicalRange(){const t=this.Cl.Au();return null===t?null:{from:t.An(),to:t.ci()}}setVisibleLogicalRange(t){d(t.from<=t.to,"The from index cannot be after the to index."),this.qi.Cd(t)}resetTimeScale(){this.qi.Qs()}fitContent(){this.qi.oc()}logicalToCoordinate(t){const i=this.qi.kt();return i.Wi()?null:i.It(t)}coordinateToLogical(t){return this.Cl.Wi()?null:this.Cl.ju(t)}timeToCoordinate(t){const i=this.K_.convertHorzItemToInternal(t),s=this.Cl.Aa(i,!1);return null===s?null:this.Cl.It(s)}coordinateToTime(t){const i=this.qi.kt(),s=i.ju(t),n=i.Yi(s);return null===n?null:n.originalTime}width(){return this.Ib.qv().width}height(){return this.Ib.qv().height}subscribeVisibleTimeRangeChange(t){this.Yw.l(t)}unsubscribeVisibleTimeRangeChange(t){this.Yw.v(t)}subscribeVisibleLogicalRangeChange(t){this.gu.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.gu.v(t)}subscribeSizeChange(t){this.ib.l(t)}unsubscribeSizeChange(t){this.ib.v(t)}applyOptions(t){this.Cl.Uh(t)}options(){return Object.assign(Object.assign({},B(this.Cl.W())),{barSpacing:this.Cl.ae()})}Xw(){this.Yw.M()&&this.Yw.m(this.getVisibleRange())}Kw(){this.gu.M()&&this.gu.m(this.getVisibleLogicalRange())}Zw(t){this.ib.m(t.width,t.height)}}function Se(t){if(void 0===t||"custom"===t.type)return;const i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;let i=0;for(;i<8;i++){const s=Math.round(t);if(Math.abs(s-t)<1e-8)return i;t*=10}return i}(i.minMove))}function ke(t){return function(t){if(O(t.handleScale)){const i=t.handleScale;t.handleScale={axisDoubleClickReset:{time:i,price:i},axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale){const{axisPressedMouseMove:i,axisDoubleClickReset:s}=t.handleScale;O(i)&&(t.handleScale.axisPressedMouseMove={time:i,price:i}),O(s)&&(t.handleScale.axisDoubleClickReset={time:s,price:s})}const i=t.handleScroll;O(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(t),t}class ye{constructor(t,i,s){this.Gw=new Map,this.Jw=new Map,this.Qw=new C,this.tg=new C,this.ig=new C,this.sg=new C,this.ng=new C,this.eg=new Qn(i);const n=void 0===s?B(pe()):P(B(pe()),ke(s));this.K_=i,this.Ov=new zn(t,n,i),this.Ov.Dm().l((t=>{this.Qw.M()&&this.Qw.m(this.rg(t()))}),this),this.Ov.Om().l((t=>{this.tg.M()&&this.tg.m(this.rg(t()))}),this),this.Ov.sd().l((t=>{this.ng.M()&&this.ng.m(this.rg(t()))}),this),this.Ov.Bm().l((t=>{this.ig.M()&&this.ig.m(this.rg(t()))}),this),this.Ov.Am().l((t=>{this.sg.M()&&this.sg.m(this.rg(t()))}),this);const e=this.Ov.$t();this.hg=new xe(e,this.Ov.Wb(),this.K_)}remove(){this.Ov.Dm().p(this),this.Ov.Om().p(this),this.Ov.sd().p(this),this.Ov.Bm().p(this),this.Ov.Am().p(this),this.hg.S(),this.Ov.S(),this.Gw.clear(),this.Jw.clear(),this.Qw.S(),this.tg.S(),this.ng.S(),this.ig.S(),this.sg.S(),this.eg.S()}resize(t,i,s){this.autoSizeActive()||this.Ov.Lb(t,i,s)}addCustomSeries(t,i){const s=p(t),n=Object.assign(Object.assign({},l),s.defaultOptions());return this.lg("Custom",n,i,s)}addAreaSeries(t){return this.lg("Area",e,t)}addBaselineSeries(t){return this.lg("Baseline",r,t)}addBarSeries(t){return this.lg("Bar",s,t)}addCandlestickSeries(t={}){return function(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}(t),this.lg("Candlestick",i,t)}addHistogramSeries(t){return this.lg("Histogram",h,t)}addLineSeries(t){return this.lg("Line",n,t)}removeSeries(t){const i=f(this.Gw.get(t)),s=this.eg.hd(i);this.Ov.$t().hd(i),this.ag(s),this.Gw.delete(t),this.Jw.delete(i)}$w(t,i){this.ag(this.eg.Cw(t,i))}qw(t,i){this.ag(this.eg.Ow(t,i))}subscribeClick(t){this.Qw.l(t)}unsubscribeClick(t){this.Qw.v(t)}subscribeCrosshairMove(t){this.ng.l(t)}unsubscribeCrosshairMove(t){this.ng.v(t)}subscribeDblClick(t){this.tg.l(t)}unsubscribeDblClick(t){this.tg.v(t)}subscribeMouseDown(t){this.ig.l(t)}unsubscribeMouseDown(t){this.ig.v(t)}subscribeMouseUp(t){this.sg.l(t)}unsubscribeMouseUp(t){this.sg.v(t)}priceScale(t){return new me(this.Ov,t)}timeScale(){return this.hg}applyOptions(t){this.Ov.Uh(ke(t))}options(){return this.Ov.W()}takeScreenshot(){return this.Ov.qb()}autoSizeActive(){return this.Ov.Gb()}chartElement(){return this.Ov.Jb()}paneSize(){const t=this.Ov.tw();return{height:t.height,width:t.width}}setCrosshairPosition(t,i,s){const n=this.Gw.get(s);if(void 0===n)return;const e=this.Ov.$t().vr(n);null!==e&&this.Ov.$t().wd(t,i,e)}clearCrosshairPosition(){this.Ov.$t().gd(!0)}removePane(t){this.Ov.$t().rd(t)}swapPane(t,i){this.Ov.$t().ld(t,i)}getPaneElements(){return this.Ov.Av().map((t=>t.Wm()))}lg(t,i,s={},n){Se(s.priceFormat);const e=P(B(a),B(i),s),r=this.Ov.$t().Sd(t,e,n),h=new Me(r,this,this,this,this.K_);return this.Gw.set(h,r),this.Jw.set(r,h),h}ag(t){const i=this.Ov.$t();i.Md(t.kt.Wu,t.kt.Iw,t.kt.zw),t.Ew.forEach(((t,i)=>i.J(t.Ue,t.Vw))),i.$u()}og(t){return f(this.Jw.get(t))}rg(t){const i=new Map;t.fw.forEach(((t,s)=>{const n=s.tl(),e=ae(n)(t);if("Custom"!==n)d(function(t){return void 0!==t.open||void 0!==t.value}(e));else{const t=s.Da();d(!t||!1===t(e))}i.set(this.og(s),e)}));const s=void 0!==t.dw&&this.Jw.has(t.dw)?this.og(t.dw):void 0;return{time:t.uw,logical:t.re,point:t.cw,paneIndex:t.$m,hoveredSeries:s,hoveredObjectId:t.pw,seriesData:i,sourceEvent:t.mw}}}function Ce(t,i,s){let n;if(D(t)){const i=document.getElementById(t);d(null!==i,`Cannot find element in DOM with id=${t}`),n=i}else n=t;const e=new ye(n,i,s);return i.setOptions(e.options()),e}const Pe=Object.assign(Object.assign({},a),l);exports.createChart=function(t,i){return Ce(t,new Gs,Gs.Ud(i))},exports.createChartEx=Ce,exports.customSeriesDefaultOptions=Pe,exports.defaultHorzScaleBehavior=function(){return Gs},exports.isBusinessDay=Es,exports.isUTCTimestamp=Vs,exports.version=function(){return"4.1.7"};
